"use strict";angular.module("jlogApp.services",[]),angular.module("jlogApp.filters",[]),angular.module("jlogApp.controllers",[]),angular.module("jlogApp.directives",[]),angular.module("jlogApp",["ui.router","jlogApp.controllers","jlogApp.filters","jlogApp.services","jlogApp.directives"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/battle"),a.state("battle",{url:"/battle",views:{"bottom-bar@":{templateUrl:"partials/battle_list_menu.html",controller:"listBottomCtrl"}},data:{}}).state("battle.view",{url:"/view/:index",views:{"page@":{templateUrl:"partials/battle_view.html",controller:"listViewCtrl"},"bottom-bar@":{templateUrl:"partials/battle_view_menu.html",controller:"listViewBottomCtrl"}},data:{}}).state("battle.edit",{url:"/edit/:index",views:{"page@":{templateUrl:"partials/battle_edit.html",controller:"listEditCtrl"},"bottom-bar@":{templateUrl:"partials/battle_edit_menu.html",controller:"listEditBottomCtrl"}},data:{}}).state("filter",{url:"/filter",views:{"page@":{templateUrl:"partials/filter.html",controller:"filterEditCtrl"},"bottom-bar@":{templateUrl:"partials/filter_menu.html",controller:"filterEditBottomCtrl"}},data:{}}).state("stats",{url:"/stats",views:{"page@":{templateUrl:"partials/stats.html",controller:"statsCtrl"},"bottom-bar@":{templateUrl:"partials/stats_menu.html",controller:"statsBottomCtrl"}},data:{}}).state("backup",{url:"/backup",views:{"page@":{templateUrl:"partials/backup.html",controller:"backupCtrl"}}}).state("help",{url:"/help",views:{"page@":{templateUrl:"partials/help.html"}}}).state("info",{url:"/info",views:{"page@":{templateUrl:"partials/info.html"}}})}]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]),angular.module("jlogApp.controllers").controller("backupCtrl",["$scope","$window","textImport","fileImport","igParser","textExport","fileExport","server","battles","filter",function(a,b,c,d,e,f,g,h,i,j){function k(){var b=(new Date).getTime();a.backup={text:f.generate("json",a.battles.list),url:g.generate("json",a.battles.list),name:"jlog_"+b+".json"}}e.init(),a.$watch("battles.list",function(a){_.isEmpty(a)||k()}),a.read_text=null,a.read_result={},a.doReadFile=function(b,c){a.read_result[b]=["Loading file..."],a.$digest(),d.read(b,c).then(function(c){var d=c[0],e=c[1],f=_.isEmpty(e);e.push("imported "+d.length+" battles"),_.isEmpty(d)||a.setBattles(d),a.read_result[b]=e,f&&a.stateGo("battle")},function(c){a.read_result[b]=c})},a.doReadText=function(b,d){_.isString(d)&&!s.isBlank(d)&&(a.read_result[b]=["Reading text..."],c.read(b,d).then(function(c){var d=c[0],e=c[1],f=_.isEmpty(e);e.push("imported "+d.length+" battles"),_.isEmpty(d)||a.setBattles(d),a.read_result[b]=e,f&&a.stateGo("battle")},function(c){a.read_result[b]=c}))},a.upload={id:null,msg:null},a.doUploadData=function(){a.upload={id:null,msg:"Uploading..."},h.upload(a.battles.list).then(function(b){a.upload={id:b[0],msg:b[1]}})},a.download={id:null,msg:null},a.doDownloadData=function(){_.isString(a.download.id)&&!s.isBlank(a.download.id)&&(a.download.msg="Downloading...",h.download(a.download.id).then(function(b){a.download.msg=b[1],_.exists(b[0])&&(a.setBattles(b[0]),a.stateGo("battle"))}))},a.doClearStorage=function(){i.clearStorage(),j.clearStorage()},a.old_data=null,a.doReadOldDatabase=function(){a.old_data=b.localStorage.getItem("jlog_battles")}}]),angular.module("jlogApp.controllers").controller("filterEditCtrl",["$scope",function(){}]).controller("filterEditBottomCtrl",["$scope","$window","filter",function(a,b,c){a.doBack=function(){a.battles.filter.cache=c.clearCache(a.battles.filter.cache),a.battles.filter.active=!0,a.updateBattles(),b.history.back()}}]),angular.module("jlogApp.controllers").controller("listCtrl",["$scope",function(a){a.doViewBattle=function(b){a.stateGo("battle.view",{index:b})}}]).controller("listBottomCtrl",["$scope","battles","fileExport",function(a,b,c){a.doAddBattle=function(){a.stateGo("battle.edit",{index:a.battles.list.length})},a.doSortBy=function(c){a.battles.sort=b.updateSortBy(a.sort_types,a.battles.sort,c),a.updateBattles()},a.exports={},a.doExportOpen=function(){var d=(new Date).getTime();a.exports={json:{name:"battles_"+d+".json",url:c.generate("json",a.battles.sorted_list),label:"JSON"},csv:{name:"battles_"+d+".csv",url:c.generate("csv",b.toTable(a.battles.sorted_list)),label:"CSV"},bb:{name:"battles_"+d+".txt",url:c.generate("bb",b.toTable(a.battles.sorted_list)),label:"BB Code"}}}}]),angular.module("jlogApp.controllers").controller("listEditCtrl",["$scope","$state","$stateParams","prompt","battle","events","opponents","scenarios","tags",function(a,b,c,d,e,f,g,h,i){var j=parseFloat(c.index);a.battle=j<a.battles.list.length?_.snapshot(a.battles.list[j]):e.create({index:j}),b.current.data.index=j,b.current.data.battle=a.battle,b.current.data.save_enable=!1,a.$watch("battle_edit.$valid",function(a){b.current.data.save_enable=a});var k={opponent:g,event:f,scenario:h},l={opponent:["opponent","name"],event:["setup","event"],scenario:["setup","scenario"]};a.doAdd=function(c){d.prompt("prompt","Enter new "+c+" name :").then(function(d){_.exists(d)&&(d=s(d).clean().value(),s.isBlank(d)||(a.battles[c+"s"]=k[c].add(a.battles[c+"s"],d),a.battle=_.setPath(a.battle,d,l[c],{}),b.current.data.battle=a.battle))})},a.doDelete=function(c){var e=_.getPath(a.battle,l[c]);_.exists(e)&&d.prompt("confirm","All references to "+e+" will be deleted.").then(function(){a.battles[c+"s"]=k[c].drop(a.battles[c+"s"],e),a.battle=_.setPath(a.battle,null,l[c],{}),b.current.data.battle=a.battle})},a.doAddTag=function(){d.prompt("prompt","Enter new tag name :").then(function(c){_.exists(c)&&(c=s(c).clean().value(),s.isBlank(c)||(a.battles.tags=i.add(a.battles.tags,c),a.battle=e.addTag(a.battle,c),b.current.data.battle=a.battle))})},a.doDeleteTag=function(){var b=a.battle.tags;_.isEmpty(b)||d.prompt("confirm",'All references to "'+b.join(",")+'" will be deleted.').then(function(){a.battles.tags=i.drop(a.battles.tags,b),a.battle.tags=[]})}}]).controller("listEditBottomCtrl",["$scope","$state","battles","filter",function(a,b,c,d){a.state=b.current.data,a.doSave=function(){a.battles.filter.cache=d.clearCache(a.battles.filter.cache,b.current.data.index),a.setBattles(c.save(a.battles.list,b.current.data.index,b.current.data.battle)),a.doClose()},a.doClose=function(){a.stateGo("battle")}}]),angular.module("jlogApp.controllers").controller("listViewCtrl",["$scope","$stateParams",function(a,b){a.battle=a.battles.list[b.index]}]).controller("listViewBottomCtrl",["$scope","$stateParams","prompt","battles",function(a,b,c,d){a.doEditBattle=function(){a.stateGo("battle.edit",{index:b.index})},a.doDeleteBattle=function(){c.prompt("confirm","You sure you wanna delete this battle ?").then(function(){a.setBattles(d.drop(a.battles.list,parseFloat(b.index))),a.doClose()})},a.doClose=function(){a.stateGo("battle")}}]),angular.module("jlogApp.controllers").controller("mainCtrl",["$scope","$state","$q","$window","$timeout","$location","$anchorScroll","scores","factions","scenarios","battles","events","opponents","tags","filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){_.exists(q)&&(e.cancel(q),q=null);var b=_.chunkAll(a.battles.sorted_list,20);a.battles.display_list=[];var c=function(){a.battles.display_list=_.cat(a.battles.display_list,_.first(b)),b=_.rest(b),_.isEmpty(b)||(q=e(c,200))};q=e(c,200)}a.stateIs=_.bind(b.is,b),a.stateGo=_.bind(b.go,b),a.battles={list:[],sorted_list:[],display_list:[],events:[],opponents:[],scenarios:[],tags:[],sort:{type:"date",reverse:!0},filter:{state:o.init(),active:!1,invert:!1,cache:{}}};var q;a.updateBattles=function(){o.store(a.battles.filter.state);var b=a.battles.filter.active?_.filter(a.battles.list,_.partial(o.match,a.battles.filter.state,_,a.battles.filter.invert,a.battles.filter.cache)):a.battles.list;a.battles.sorted_list=k.sort(b,a.sort_types,a.battles.sort.type,a.battles.sort.reverse),p()},a.setBattles=function(b){a.battles.list=k.buildIndex(b),k.store(a.battles.list),a.battles.opponents=m.fromBattles(a.battles.list),a.battles.events=l.fromBattles(a.battles.list),a.battles.tags=n.fromBattles(a.battles.list),a.battles.scenarios=j.fromBattles(a.battles.list),a.updateBattles()},c.when(h.data()).then(function(b){return a.scores=b,c.when(i.data())}).then(function(b){return a.factions=b,c.when(j.data())}).then(function(){return c.when(k.sortTypes())}).then(function(b){a.sort_types=b}).then(function(){var b=k.init();a.setBattles(b)}),a.doToggleFilterActive=function(){a.battles.filter.active=!a.battles.filter.active,a.updateBattles()},a.doToggleFilterInvert=function(){a.battles.filter.invert=!a.battles.filter.invert,a.updateBattles()},a.doReload=function(){d.location.reload()},a.scrollTo=function(a){f.hash(a),g()}}]),angular.module("jlogApp.controllers").controller("statsCtrl",["$scope","$state","stats",function(a,b,c){c.init(),a.stats={},b.current.data={entry:"result",selector:"total",selector_arg:null,doGenerate:function(){a.stats=c.generate(a.stats,a.battles.sorted_list,this.entry,this.selector,this.selector_arg)}},a.state=b.current.data,a.$watch("battles.sorted_list",function(b){_.isEmpty(b)||a.state.doGenerate()})}]).controller("statsBottomCtrl",["$scope","$state","stats",function(a,b,c){a.SELECTORS=c.SELECTORS,a.ENTRIES=c.ENTRIES,a.state=b.current.data,a.doSetEntry=function(b){a.state.entry=b,a.state.doGenerate()},a.doSetSelector=function(b){a.state.selector_arg=a.state.selector===b?a.state.selector_arg:null,a.state.selector=b,a.state.doGenerate()}}]),angular.module("jlogApp.directives").factory("appCache",["$window","$rootScope",function(a){function b(a){var b="progress"===a.type;c.progress=b?(c.progress+1)%100:0,c.onProgress(b)}var c={progress:0,onProgress:function(){},onUpdateReady:function(){}},d=a.applicationCache;return d.addEventListener("cached",b,!1),d.addEventListener("checking",b,!1),d.addEventListener("downloading",b,!1),d.addEventListener("error",b,!1),d.addEventListener("noupdate",b,!1),d.addEventListener("obsolete",b,!1),d.addEventListener("progress",b,!1),d.addEventListener("updateready",function(a){d.status===d.UPDATEREADY&&c.onUpdateReady(),c.progress=0,c.onProgress(!1)},!1),c}]).directive("appCacheProgressBar",function(){return{restrict:"E",template:'<div class="appcache-progress"     ng-show="appCache.progress != 0">  <div class="appcache-progress-bar"       ng-style="{\'width\': appCache.progress + \'%\' }"></div></div>',controller:["$scope","$window","prompt","appCache",function(a,b,c,d){a.appCache=d,d.onProgress=function(){a.$apply()},d.onUpdateReady=function(){c.prompt("confirm",["A new version of this site is available. Load it?","(You might want to save your battles first, if so click Cancel)"]).then(function(){b.location.reload()})}}],link:function(){}}}),angular.module("jlogApp.directives").controller("barsCtrl",["$scope",function(a){a.$watch("values",function(b){if(_.exists(b)){var c=Math.max.apply(null,_.values(b)),d=30/Math.max(1,_.keys(b).length-1);a.bars=_.chain(b).map(function(b,d){return{k:d,name:s.capitalize(d),width:a.width*b/c,value:b}}).sortBy(function(a){return-a.value}).map(function(b,c){return b.color=_.exists(_.getPath(a.hues,b.k))?"hsl("+_.getPath(a.hues,b.k)[0]+", "+_.getPath(a.hues,b.k)[1]+"%, 52%)":"hsl("+a.hue+", "+a.saturation+"%, "+(35+c*d)+"%)",b}).value()}})}]).directive("bars",[function(){return{restrict:"E",templateUrl:"partials/directives/bars.html",scope:{values:"=barsValues",hues:"=barsHues"},controller:"barsCtrl",link:function(a,b,c){a.width=.7*(b[0].querySelector("table").offsetWidth>>0),a.height=50,a.hue="200",c.$observe("barsHue",function(b){a.hue=_.exists(b)?b:"200"}),a.saturation="75",c.$observe("barsSaturation",function(b){a.saturation=_.exists(b)?b:"75"})}}}]),angular.module("jlogApp.directives").directive("closeAllDropdown",[function(){return{restrict:"A",link:function(a,b){b.on("click",function(){a.$broadcast("close-dropdown")})}}}]).directive("openDropdown",[function(){return{restrict:"A",link:function(a,b,c){var d=c.openDropdown,e=angular.element(document.getElementById(d));_.exists(e)&&(b.on("click",function(a){e.toggleClass("open"),a.stopPropagation()}),a.$on("close-dropdown",function(){e.removeClass("open")}))}}}]),angular.module("jlogApp.directives").directive("eaFile",function(){return{restrict:"A",scope:{eaFile:"&"},controller:["$scope",function(){}],link:function(a,b){b[0].onchange=function(){a.eaFile({file:b[0].files[0]})}}}}),angular.module("jlogApp.directives").controller("pieChartCtrl",["$scope",function(a){a.$watch("values",function(b){if(a.center={x:a.width/2,y:a.height/2},a.radius=Math.min(a.width,a.height)/2*.95,_.exists(b)){a.legends=_.chain(b.legends).map(function(a,c){return{label:a,count:"#"+b.values[c],color:b.colors[c]}}).filter(function(a,c){return b.values[c]>0}).value(),a.total=_.reduce(b.values,function(a,b){return a+b},0);var c=0;a.paths=_.chain(b.values).map(function(d,e){var f=2*Math.PI*c/a.total,g=2*Math.PI*(c+d)/a.total,h=Math.min(2*Math.PI*.999,Math.abs(g-f));g=f+h;var i=h>Math.PI?1:0;return c+=d,{large:i,start:{x:a.center.x+a.radius*Math.sin(f),y:a.center.y-a.radius*Math.cos(f)},end:{x:a.center.x+a.radius*Math.sin(g),y:a.center.y-a.radius*Math.cos(g)},color:b.colors[e]}}).filter(function(a,c){return b.values[c]>0}).value()}})}]).directive("pieChart",[function(){return{restrict:"E",templateUrl:"partials/directives/pieChart.html",scope:{values:"=pieValues"},controller:"pieChartCtrl",link:function(a,b){a.width=b[0].querySelector(".pie-container").offsetWidth>>0,a.height=a.width}}}]),angular.module("jlogApp.directives").factory("prompt",["$q",function(a){function b(){if(_.exists(c))return c;var b=a.defer();return e.push(b),b.promise}var c,d,e=[];return{register:function(a){c=a,c.active=!1,c.message=null,c.type="alert",c.input=null,c.doValidate=function(){c.close(),d.resolve(c.input),d=null},c.doCancel=function(){c.close(),d.reject(),d=null},_.each(e,function(a){a.resolve(c)}),e=[]},prompt:function(c,e){return d=a.defer(),a.when(b()).then(function(a){a.type=c,a.message=_.isString(e)?[e]:e,a.input=null,a.open()}),d.promise}}}]).controller("promptCtrl",["$scope","prompt",function(a,b){b.register(a)}]).directive("prompt",["$timeout",function(a){return{restrict:"E",templateUrl:"partials/directives/prompt.html",scope:!0,controller:"promptCtrl",link:function(b,c){var d=c[0].querySelector("input");b.open=function(){b.active=!0,a(function(){d.focus()},200)},b.close=function(){b.active=!1}}}}]),angular.module("jlogApp.directives").controller("stackGraphsCtrl",["$scope",function(a){a.$watch("values",function(b){if(_.exists(b)){var c=a.width/(b.values.length-1);a.legends=_.chain(b.legends).map(function(a,c){return{label:a,color:b.colors[c]}}).value(),a.polygons=_.chain(b.values).map(function(a){return _.reductions(a,function(a,b){return a+b},0)}).apply(function(d){var e=d[0].length;return _.chain(e).range().map(function(a){return _.map(d,function(b){return[_.nth(b,a),_.last(b)]})}).map(function(b){return _.map(b,function(b,d){return[d*c,a.height*(1-b[0]/b[1])]})}).map(function(c,d){return{color:b.colors[d],points:"0,"+a.height+" "+c.join(" ")+" "+a.width+","+a.height}}).value()}).reverse().value()}})}]).directive("stackGraphs",[function(){return{restrict:"E",templateUrl:"partials/directives/stackGraphs.html",scope:{values:"=gphValues"},controller:"stackGraphsCtrl",link:function(a,b){a.width=b[0].querySelector(".gph-container").offsetWidth>>0,a.height=a.width/2}}}]),angular.module("jlogApp.directives").controller("stacksCtrl",["$scope",function(a){a.$watch("values",function(b){if(_.exists(b)){var c=_.reduce(b.values,function(a,b,c){return a[c]=_.reduce(b,function(a,b){return a+b},0),a},{});a.stacks=_.map(b.values,function(d,e){var f=0;return{name:e,layers:_.map(d,function(g,h){var i=0<c[e]?a.width*g/c[e]:a.width/d.length,j={x:f,width:i,color:b.colors[h],value:g};return f+=i,j})}})}})}]).directive("stacks",[function(){return{restrict:"E",templateUrl:"partials/directives/stacks.html",scope:{values:"=stacksValues"},controller:"stacksCtrl",link:function(a,b){a.width=.7*(b[0].querySelector("table").offsetWidth>>0),a.height=50}}}]),angular.module("jlogApp.filters").filter("battle",["filter",function(a){return function(b,c,d){return c&&_.isArray(b)?b.filter(function(b){return a.match(b,d)}):b}}]),angular.module("jlogApp.filters").filter("capitalise",[function(){return function(a){return"string"==typeof a?a.charAt(0).toUpperCase()+a.slice(1):a}}]),angular.module("jlogApp.filters").filter("initiative",[function(){return function(a){if(!angular.isObject(a)||"string"!=typeof a.won_roll||"string"!=typeof a.started)return"nil";var b="";return b+="true"===a.won_roll?"Won roll, ":"Lost roll, ",b+="true"===a.started?"started game":"chose side"}}]),angular.module("jlogApp.filters").filter("scoreResultColor",[function(){return function(a){return"string"!=typeof a?"":"victory"==a?"text-success":"defeat"==a?"text-danger":"text-warning"}}]).filter("scoreResultClass",[function(){return function(a){var b;switch(a){case"victory":b="text-success";break;case"draw":b="text-warning";break;case"defeat":b="text-danger"}return b}}]).filter("scoreTypeLetter",[function(){return function(a){return"string"==typeof a?a.charAt(0).toUpperCase():a}}]).filter("scoreType",[function(){return function(a){switch(a){case"va":return"Assassination Victory";case"vs":return"Scenario Victory";case"vc":return"Clock Victory";case"vt":return"Tiebreaker Victory";case"dd":return"Dice-down Draw";case"da":return"Assassination Defeat";case"ds":return"Scenario Defeat";case"dc":return"Clock Defeat";case"dt":return"Tiebreaker Defeat"}return""}}]),angular.module("jlogApp.filters").filter("battle",["battle",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("factions",["factions",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("scenarios",["scenarios",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("scores",["scores",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]),_.mixin({apply:function(a,b){var c=_.rest(_.rest(arguments));return b.apply(null,_.cons(a,c))}}),_.mixin({deepExtend:function a(b,c){return _.each(c,function(c,d){void 0!==c&&(!_.isObject(c)||_.isArray(c)||_.isFunction(c)||!_.isObject(b[d])||_.isArray(b[d])||_.isFunction(b[d])?b[d]=c:a(b[d],c))}),b}}),_.mixin({mapWith:function(a,b){var c=_.rest(_.rest(arguments)),d=_.partial.apply(null,_.cat([b,_],c));return _.map(a,d)}}),_.mixin({spy:function(a){var b=_.rest(arguments);return console.log.apply(console,_.cat(b,[a])),a}}),angular.module("jlogApp.services").factory("battle",[function(){var a={create:function(a){a=_.exists(a)?a:{};var b=new Date;return _.deepExtend({index:0,date:{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate()},my_army:{faction:null,caster:null},opponent:{name:null,faction:null,caster:null},setup:{size:null,scenario:null,event:null,initiative:{won_roll:null,started:null}},score:null,points:{my_army:{scenario:null,army:null,kill:null},opponent:{scenario:null,army:null,kill:null}},tags:[],comment:null},a)},test:function(a,b,c,d){var e=_.chain(b).shuffle().first().value(),f=_.chain(b).shuffle().first().value();return{index:a,date:{year:_.chain([2012,2014,2013]).shuffle().first().value(),month:_.chain([4,8,9]).shuffle().first().value(),day:_.chain([5,12,19]).shuffle().first().value()},my_army:{faction:e.key,caster:_.chain(e.casters).shuffle().first().value().key},opponent:{name:_.chain(["wood","kevin","fred"]).shuffle().first().value(),faction:f.key,caster:_.chain(f.casters).shuffle().first().value().key},setup:{size:_.chain([15,25,35,50]).shuffle().first().value(),scenario:_.chain(d).shuffle().first().value().key,event:_.chain(["master","amical","wtc"]).shuffle().first().value(),initiative:{won_roll:_.chain(["true","false"]).shuffle().first().value(),started:_.chain(["true","false"]).shuffle().first().value()}},score:_.chain(c).keys().shuffle().first().value(),points:{my_army:{scenario:5*Math.random()>>0,army:50*Math.random()>>0,kill:50*Math.random()>>0},opponent:{scenario:5*Math.random()>>0,army:50*Math.random()>>0,kill:50*Math.random()>>0}},tags:["tiers4","raek spam"],comment:"don't panic"}},addTag:function(a,b){return _.chain(a).clone().apply(function(a){return a.tags=_.chain(a.tags).cat(b).uniq().sort().value(),a}).value()},initRollDescFor:function(a){return"true"===_.getPath(a,"setup.initiative.won_roll")?"Won Roll":"Lost Roll"},initStartDescFor:function(a){return"true"===_.getPath(a,"setup.initiative.started")?"Started Game":"Chose Side"}};return a}]).service("battles",["$window","$http","$q","battle","orderByFilter","jsonStringifier",function(a,b,c,d,e,f){function g(a){return _.chain(a).apply(s.chars).map(function(a){return a.charCodeAt(0)}).reduce(function(a,b){return a=(a<<5)-a+b,a&=a},0).value()}var h,i={date:function(a){return a.date.year+"-"+a.date.month+"-"+a.date.day},my_faction:"my_army.faction",my_caster:"my_army.caster",opponent:"opponent.name",opponent_faction:"opponent.faction",opponent_caster:"opponent.caster",size:"setup.size",scenario:"setup.scenario",event:"setup.event",initiative:function(a){return("true"===a.setup.initiative.won_roll?"wonRoll":"lostRoll")+"-"+("true"===a.setup.initiative.started?"startedGame":"choseSide")},result:"score",my_cp:"points.my_army.scenario",my_ap:"points.my_army.army",my_kp:"points.my_army.kill",opponent_cp:"points.opponent.scenario",opponent_ap:"points.opponent.army",opponent_kp:"points.opponent.kill",tags:function(a){return a.tags.join("|")},comment:"comment"},j={init:function(){var b,c=a.localStorage.getItem("jlog_battles_v2");if(_.isString(c))try{if(b=JSON.parse(c),_.isArray(b))return b}catch(d){}if(c=a.localStorage.getItem("jlog_battles"),_.isString(c))try{if(b=JSON.parse(c),_.isArray(b))return b}catch(d){}return[]},store:function(b){a.localStorage.setItem("jlog_battles_v2",f.stringify(b))},clearStorage:function(){a.localStorage.removeItem("jlog_battles_v2"),a.localStorage.removeItem("jlog_battles")},buildIndex:function(a){return _.each(a,function(a,b){a.index=b,a.hash=g(f.stringify(a))})},save:function(a,b,c){var d=_.clone(a);return d.splice(b,1,c),d},drop:function(a,b){var c=_.clone(a);return c.splice(b,1),c},test:function(a,b,c,e){return _.chain(a).range().map(_.partial(d.test,_,b,c,e)).value()},sortTypes:function(){return _.exists(h)?h:b.get("data/sorts.json").then(function(a){return h=a.data},function(a){return c.reject(a)})},updateSortBy:function(a,b,c){if(!_.exists(a[c]))return b;var d=_.clone(b);return d.type===c?d.reverse=!d.reverse:(d.type=c,d.reverse=a[c].reverse),d},sort:function(a,b,c,d){return e(a,b[c].key,d)},toTable:function(a){return _.cat([_.keys(i)],_.chain(a).map(function(a){return _.reduce(i,function(b,c){return b.push(_.isFunction(c)?c(a):_.getPath(a,c)),b},[])}).value())}};return j}]),angular.module("jlogApp.services").factory("bbStringifier",[function(){function a(a,b){return"["+b+"]"+a+"[/"+b+"]"}var b="\r\n",c={stringify:function(c){return _.chain(c).map(function(b,c){return _.chain(b).map(function(b){return 0===c?a(b,"b"):b}).mapWith(a,"td").join("").apply(a,"tr").value()}).join(b).apply(a,"table").value()}};return c}]),angular.module("jlogApp.services").factory("csvStringifier",[function(){var a="\r\n",b={stringify:function(b){return _.chain(b).map(function(a){return a.join(",")}).join(a).value()}};return b}]),angular.module("jlogApp.services").service("events",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"setup.event").without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without(a,b)}};return a}]),angular.module("jlogApp.services").factory("factions",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/factions.json").then(function(a){return c=_.chain(a.data).map(function(a,b){return{key:b,name:a.name,icon:a.icon,hue:a.hue,casters:_.map(a.casters,function(a,b){var c=d.normaliseCaster(b);return{key:c,name:a.name}})}}).value()},function(a){return b.reject(a)})},normaliseCaster:function(a){if(!_.isString(a)||s.isBlank(a))return null;var b=a.charAt(a.length-1);return("0">b||b>"9")&&(a+="1"),a.toLowerCase()},keyForName:function(a,b){return _.chain(a).where({name:b}).first().getPath("key").value()},nameFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("name").value()},iconFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("icon").apply(function(a){return _.exists(a)?"data/img/"+a:a}).value()},hueFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("hue").value()},castersFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("casters").value()},casterNameFor:function(a,b,c){return _.chain(a).where({key:b}).first().getPath("casters").where({key:c}).first().getPath("name").value()}};return d}]),angular.module("jlogApp.services").factory("jsonStringifier",[function(){var a={stringify:function(a){return JSON.stringify(a,function(a,b){return s.startsWith(a,"$$")?void 0:b})}};return a}]).factory("textExport",["$window","csvStringifier","bbStringifier","jsonStringifier",function(a,b,c,d){a.URL=a.URL||a.webkitURL;var e={csv:b,bb:c,json:d};return{generate:function(a,b){return _.chain(b).apply(e[a].stringify).value()}}}]).factory("fileExport",["$window","csvStringifier","bbStringifier","jsonStringifier",function(a,b,c,d){a.URL=a.URL||a.webkitURL;var e={csv:b,bb:c,json:d};return{generate:function(b,c){return _.chain(c).apply(e[b].stringify).apply(function(b){return new a.Blob([b],{type:"text/plain"})}).apply(a.URL.createObjectURL).value()},cleanup:function(b){_.exists(b)&&a.URL.revokeObjectURL(b)}}}]),angular.module("jlogApp.services").factory("jsonParser",[function(){return{parse:function(a){return[JSON.parse(a),[]]}}}]).factory("textImport",["$window","$q","jsonParser","igParser",function(a,b,c,d){var e={json:c,ig:d};return{read:function(a,c){var d,f=b.defer();try{d=e[a].parse(c),f.resolve(d)}catch(g){f.reject(["invalid text : "+g.message])}return f.promise}}}]).factory("fileImport",["$window","$q","jsonParser","igParser",function(a,b,c,d){var e={json:c,ig:d};return{read:function(c,d){var f=new a.FileReader,g=b.defer();return f.onload=function(a){var b;try{b=e[c].parse(a.target.result),g.resolve(b)}catch(d){g.reject(["invalid file : "+d.message])}},f.onerror=function(){g.reject(["error reading file"])},f.onabort=function(){g.reject(["abort reading file"])},f.readAsText(d),g.promise}}}]),angular.module("jlogApp.services").factory("filterMatchSimple",[function(){var a={create:function(a){return _.extend({active:!1,is:"true",value:[]},a)},match:function(a,b,c){var d=_.getPath(b,c),e=_.isEmpty(a.value)||0<=_.indexOf(a.value,d);return"true"===a.is?e:!e}};return a}]).factory("compareDate",[function(){return function(a,b){return a.year>b.year?1:a.year<b.year?-1:a.month>b.month?1:a.month<b.month?-1:a.day>b.day?1:a.day<b.day?-1:0}}]).factory("filterMatchComp",[function(){function a(a,b){switch(a){case"==":return 0===b;case"!=":return 0!==b;case">":return-1===b;case">=":return 1!==b;case"<":return 1===b;case"<=":return-1!==b}return!1}var b={create:function(a,b){return _.deepExtend({active:!1,is:"==",value:b()},a)},match:function(b,c,d,e){var f=_.getPath(c,d),g=e(b.value,f),h=a(b.is,g);return h}};return b}]).factory("filterMatchCaster",[function(){var a={create:function(a){return _.deepExtend({active:!1,is:"true",value:{faction:null,caster:[]}},a)},match:function(a,b,c){var d=_.getPath(b,c),e=a.value.faction===d.faction&&(_.isEmpty(a.value.caster)||0<=_.indexOf(a.value.caster,d.caster));return"true"===a.is?e:!e}};return a}]).factory("filterMatchInitiative",[function(){var a={create:function(a){return _.extend({active:!1,is:"true",value:{won_roll:"",started:""}},a)},match:function(a,b){var c=b.setup.initiative,d=(s.isBlank(a.value.won_roll)||a.value.won_roll===c.won_roll)&&(s.isBlank(a.value.started)||a.value.started===c.started);return"true"===a.is?d:!d}};return a}]).factory("filterMatchTags",[function(){var a={create:function(a){return _.extend({active:!1,is:"any",value:[]},a)},match:function(a,b){if(_.isEmpty(a.value))return!0;if(_.isEmpty(b.tags))return"none"===a.is||"not_all"===a.is;var c=_.map(a.value,function(a){return 0<=_.indexOf(b.tags,a)}),d=_.every(c),e=_.some(c);switch(a.is){case"any":return e;case"all":return d;case"not_all":return!d;case"none":return!e;default:return!1}}};return a}]).factory("filter",["$window","jsonStringifier","filterMatchSimple","filterMatchComp","filterMatchCaster","filterMatchInitiative","filterMatchTags","compareDate",function(a,b,c,d,e,f,g,h){function i(){var a=new Date;return{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()}}function j(a){return _.isObject(a)?a:{}}var k=[{key:"date",create:_.partial(d.create,_,i),match:_.partial(d.match,_,_,"date",h)},{key:"my_army",create:e.create,match:_.partial(e.match,_,_,"my_army")},{key:"opp_name",create:c.create,match:_.partial(c.match,_,_,"opponent.name")},{key:"opp_caster",create:e.create,match:_.partial(e.match,_,_,"opponent")},{key:"result",create:c.create,match:_.partial(c.match,_,_,"score")},{key:"scenario",create:c.create,match:_.partial(c.match,_,_,"setup.scenario")},{key:"initiative",create:f.create,match:f.match},{key:"size",create:_.partial(d.create,_,_.always(50)),match:_.partial(d.match,_,_,"setup.size",_.comparator(_.lt))},{key:"event",create:c.create,match:_.partial(c.match,_,_,"setup.event")},{key:"tags",create:g.create,match:g.match}],l={init:function(){var b,c=a.localStorage.getItem("jlog_filter_v2");if(_.isString(c))try{if(b=JSON.parse(c),_.isObject(b))return l.create(b)}catch(d){}return l.create()},store:function(c){a.localStorage.setItem("jlog_filter_v2",b.stringify(c))},clearStorage:function(){a.localStorage.removeItem("jlog_filter"),a.localStorage.removeItem("jlog_filter_v2")},create:function(a){return a=j(a),_.chain(k).reduce(function(b,c){return b[c.key]=c.create(j(a[c.key])),b},{}).value()},match:function(a,b,c,d){return d=_.exists(d)?d:{},_.exists(d[b.index])||(d[b.index]=_.chain(k).filter(function(b){return _.getPath(a,b.key+".active")}).map(function(b){return[b.match,a[b.key]]}).map(function(a){return a[0](a[1],b)}).every().value()),c?!d[b.index]:d[b.index]},clearCache:function(a,b){return _.exists(b)?_.omit(a,""+b):{}}};return l}]),angular.module("jlogApp.services").factory("igParser",["$q","battle","factions","scenarios",function(a,b,c,d){function e(a){if(s.isBlank(a))return[];for(var b=[],c=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\,\\r\\n]*))',"gi"),d=c.exec(a);_.exists(d);){var e;e=d[2]?d[2].replace(/\"\"/g,'"'):d[3],b.push(e),d=c.exec(a)}return b}var f,g,h={0:"dd",1:"va",2:"vs",3:"vt",4:"vt",5:"vt",6:"vt",7:"vc","-1":"da","-2":"ds","-3":"dt","-4":"dt","-5":"dt","-6":"dt","-7":"dc"},i={1:{won_roll:"true",started:"true"},2:{won_roll:"true",started:"false"},3:{won_roll:"false",started:"true"},4:{won_roll:"false",started:"false"}},j={init:function(){a.when(c.data()).then(function(a){f=a}),a.when(d.data()).then(function(a){g=a})},parse:function(a){var j=[],k=_.clone(g),l=_.chain(a).apply(s.lines).mapWith(e).map(function(a,e){if(_.isEmpty(a))return void 0;if(a=_.map(a,function(a){return!_.isString(a)||a.match(/null/i)?"":a}),18!=a.length)return void j.push("line "+(e+1)+": invalid nb of fields ("+a.length+", expected 18)");var g=new Date(parseFloat(a[0])),l=c.keyForName(f,a[1]);_.exists(l)||j.push("line "+(e+1)+": unknown faction "+a[1]);var m=c.keyForName(f,a[4]);_.exists(m)||j.push("line "+(e+1)+": unknown faction "+a[4]);var n=_.getPath(h,a[6]);_.exists(n)||j.push("line "+(e+1)+": unknown score "+a[6]);var o=d.nameFor(k,a[13]);_.exists(o)?o=a[13]:s.isBlank(a[13])?o=null:(k=d.add(k,a[13]),o=a[13]);var p=_.getPath(i,a[16]);return _.exists(p)?p=_.clone(p):(s.isBlank(a[16])||j.push("line "+(e+1)+": unknown initiative "+a[16]),p=void 0),b.create({date:{year:g.getFullYear(),month:g.getMonth()+1,day:g.getDate()},my_army:{faction:l,caster:c.normaliseCaster(a[2])},opponent:{name:a[3],faction:m,caster:c.normaliseCaster(a[5])},score:n,points:{my_army:{scenario:_.isNumeric(a[7])?parseFloat(a[7]):null,army:_.isNumeric(a[8])?parseFloat(a[8]):null,kill:_.isNumeric(a[9])?parseFloat(a[9]):null},opponent:{scenario:_.isNumeric(a[10])?parseFloat(a[10]):null,army:_.isNumeric(a[11])?parseFloat(a[11]):null,kill:_.isNumeric(a[12])?parseFloat(a[12]):null}},setup:{scenario:o,size:_.isNumeric(a[14])?parseFloat(a[14]):null,event:a[15],initiative:p},comment:a[17]})
}).without(void 0).spy("ig battles",j).value();return[l,j]}};return j}]),angular.module("jlogApp.services").service("opponents",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"opponent.name").without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without(a,b)}};return a}]),angular.module("jlogApp.services").service("scenarios",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/scenarios.json").then(function(a){return c=_.chain(a.data).map(function(a,b){return{key:b,name:a.name}}).value(),_.clone(c)},function(a){return b.reject(a)})},fromBattles:function(a){var b=_.clone(c);return _.chain(a).mapWith(_.getPath,"setup.scenario").uniq().without(void 0,null).each(function(a){_.exists(d.nameFor(b,a))||(b=d.add(b,a))}).value(),b},add:function(a,b){return _.chain(a).cat({key:b,name:b}).filter(function(a){return _.exists(_.getPath(a,"key"))}).uniq(!1,_.partial(_.getPath,_,"key")).value()},drop:function(a,b){return _.filter(a,function(a){return a.key!==b})},nameFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("name").value()}};return d}]),angular.module("jlogApp.services").factory("scores",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/scores.json").then(function(a){return c=a.data,a.data},function(a){return b.reject(a)})},letterFor:function(a,b){return _.getPath(a,b+".letter")},typeFor:function(a,b){return _.getPath(a,b+".type")},resultFor:function(a,b){return _.getPath(a,b+".result")},classFor:function(a,b){return _.getPath(a,b+".class")}};return d}]),angular.module("jlogApp.services").factory("server",["$http",function(a){var b={upload:function(b){return a.post("/api/log",{battles:b},{timeout:2e4}).then(function(a){return[a.data.id,"data uploaded"]},function(a){return[null,"upload failure ("+a.status+")"]})},download:function(b){return a.get("/api/log/"+b,{timeout:2e4}).then(function(a){return[a.data.battles,"data downloaded"]},function(a){return[null,"download failure ("+a.status+")"]})}};return b}]),angular.module("jlogApp.services").service("statEntryFaction",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},reduce:function(b,d,e){var f=_.chain(b).countBy(_.partial(_.getPath,_,e)).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value(),g=_.chain(c).reduce(function(a,b){return a[b.name]=b.hue,a},{}).value();return{title:d,hues:g,values:f}}}}]).service("statEntryCaster",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},reduce:function(b,d,e){var f=_.chain(b).groupBy(_.partial(_.getPath,_,e+".faction")).reduce(function(b,d,f){return b[a.nameFor(c,f)]=_.chain(d).countBy(_.partial(_.getPath,_,e+".caster")).value(),b},{}).value(),g=_.chain(c).reduce(function(a,b){return a[b.name]=b.hue,a},{}).value();return{title:d,hues:g,values:f}}}}]).service("statEntrySimple",[function(){return{reduce:function(a,b,c){return{title:b,values:_.chain(a).countBy(c).value()}}}}]).service("statEntryScenario",["scenarios","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},reduce:function(b,d){return{title:d,values:_.chain(b).countBy(_.partial(_.getPath,_,"setup.scenario")).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value()}}}}]).service("statEntryInit",[function(){return{reduce:function(a,b){return{title:b,legends:["Won Roll, Started Game","Won Roll, Chose Side","Lost Roll, Started Game","Lost Roll, Chose Side"],colors:["#4AE34D","#39B03C","#B02817","#E3341D"],values:_.chain(a).reduce(function(a,b){var c=_.getPath(b,"setup.initiative.won_roll"),d=_.getPath(b,"setup.initiative.started");return _.isString(c)&&_.isString(d)&&a[("true"===c?"wr":"lr")+"_"+("true"===d?"sg":"cs")]++,a},{wr_sg:0,wr_cs:0,lr_sg:0,lr_cs:0}).apply(function(a){return[a.wr_sg,a.wr_cs,a.lr_sg,a.lr_cs]}).value()}}}}]).service("statEntryResult",[function(){return{reduce:function(a,b){return{title:b,legends:["Assassination Victory","Clock Victory","Scenario Victory","Tiebreakers Victory","Dice Down Draw","Tiebreakers Defeat","Scenario Defeat","Clock Defeat","Assassination Defeat"],colors:["#91E893","#4AE34D","#39B03C","#3E633F","#E2E345","#63312B","#B02817","#E3341D","#E87263"],values:_.chain(a).reduce(function(a,b){return a[b.score]++,a},{va:0,vc:0,vs:0,vt:0,dd:0,da:0,dc:0,ds:0,dt:0}).apply(function(a){return[a.va,a.vc,a.vs,a.vt,a.dd,a.dt,a.ds,a.dc,a.da]}).value()}}}}]).service("statEntryTimeResult",["battles","$q",function(a,b){var c;return{init:function(){b.when(a.sortTypes()).then(function(a){c=a})},reduce:function(b,d){return{title:d,legends:["Assassination Victory","Clock Victory","Scenario Victory","Tiebreakers Victory","Dice Down Draw","Tiebreakers Defeat","Scenario Defeat","Clock Defeat","Assassination Defeat"],colors:["#91E893","#4AE34D","#39B03C","#3E633F","#E2E345","#63312B","#B02817","#E3341D","#E87263"],values:_.chain(b).apply(a.sort,c,"date",!1).reductions(function(a,b){var c=_.clone(a);return c[b.score]++,c},{va:0,vc:0,vs:0,vt:0,dd:0,da:0,dc:0,ds:0,dt:0}).mapWith(function(a){return[a.va,a.vc,a.vs,a.vt,a.dd,a.dt,a.ds,a.dc,a.da]}).value()}}}}]).service("statEntryPoints",[function(){return{reduce:function(a,b){return{title:b,colors:["#4AE34D","#E3341D"],values:_.chain(a).reduce(function(a,b){return _.isNumber(_.getPath(b,"points.my_army.scenario"))&&_.isNumber(_.getPath(b,"points.opponent.scenario"))&&(a.Scenario[0]+=b.points.my_army.scenario,a.Scenario[1]+=b.points.opponent.scenario,a.Scenario[2]++),_.isNumber(_.getPath(b,"points.my_army.army"))&&_.isNumber(_.getPath(b,"points.opponent.army"))&&(a.Army[0]+=b.points.my_army.army,a.Army[1]+=b.points.opponent.army,a.Army[2]++),_.isNumber(_.getPath(b,"points.my_army.kill"))&&_.isNumber(_.getPath(b,"points.opponent.kill"))&&(a.Kill[0]+=b.points.my_army.kill,a.Kill[1]+=b.points.opponent.kill,a.Kill[2]++),a},{Scenario:[0,0,0],Army:[0,0,0],Kill:[0,0,0]}).reduce(function(a,b,c){return b[2]=0===b[2]?1:b[2],a[c]=[Math.round(b[0]/b[2]*100)/100,Math.round(b[1]/b[2]*100)/100],a},{}).value()}}}}]).service("statEntryTag",["tags",function(a){return{reduce:function(b,c){return{title:c,values:_.chain(b).apply(a.fromBattles).reduce(function(a,c){return a[s.capitalize(c)]=_.filter(b,function(a){return 0<=_.indexOf(a.tags,c)}).length,a},{}).value()}}}}]),angular.module("jlogApp.services").service("statSelectorTotal",[function(){return{sort:function(a){return{Total:a}}}}]).service("statSelectorFaction",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b,d){return _.chain(b).groupBy(_.partial(_.getPath,_,d)).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value()}}}]).service("statSelectorCaster",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b,d,e){return _.exists(d)?_.chain(b).filter(function(a){return _.getPath(a,e+".faction")===d}).groupBy(_.partial(_.getPath,_,e+".caster")).reduce(function(b,e,f){return b[a.casterNameFor(c,d,f)]=e,b},{}).value():[]}}}]).service("statSelectorSimple",[function(){return{sort:function(a,b){return _.chain(a).groupBy(b).reduce(function(a,b,c){return a[s.capitalize(c)]=b,a},{}).value()}}}]).service("statSelectorScenario",["scenarios","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b){return _.chain(b).groupBy(_.partial(_.getPath,_,"setup.scenario")).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value()}}}]).service("statSelectorInit",[function(){return{sort:function(a){return _.chain(a).filter(function(a){return _.exists(_.getPath(a,"setup.initiative.won_roll"))&&_.exists(_.getPath(a,"setup.initiative.started"))}).groupBy(function(a){return("true"===_.getPath(a,"setup.initiative.won_roll")?"Won Roll":"Lost Roll")+", "+("true"===_.getPath(a,"setup.initiative.started")?"Started Game":"Chose Side")}).value()}}}]).service("statSelectorResult",["scores","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b){return _.chain(b).groupBy(_.partial(_.getPath,_,"score")).reduce(function(b,d,e){var f=a.resultFor(c,e),g=a.typeFor(c,e);return _.exists(f)&&_.exists(g)&&(b[s.capitalize(a.resultFor(c,e))+" "+s.capitalize(a.typeFor(c,e))]=d),b},{}).value()}}}]).service("statSelectorTag",["tags",function(a){return{sort:function(b){a.fromBattles(b);return _.chain(b).apply(a.fromBattles).reduce(function(a,c){return a[s.capitalize(c)]=_.filter(b,function(a){return 0<=_.indexOf(a.tags,c)}),a},{}).value()}}}]),angular.module("jlogApp.services").service("stats",["statEntryFaction","statEntryCaster","statEntrySimple","statEntryScenario","statEntryInit","statEntryResult","statEntryTimeResult","statEntryPoints","statEntryTag","statSelectorTotal","statSelectorFaction","statSelectorCaster","statSelectorSimple","statSelectorScenario","statSelectorInit","statSelectorResult","statSelectorTag",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r={ENTRIES:{my_faction:{desc:"My Faction",reduce:_.partial(a.reduce,_,_,"my_army.faction")},my_caster:{desc:"My Caster",reduce:_.partial(b.reduce,_,_,"my_army")},opp_name:{desc:"Opp. Name",reduce:_.partial(c.reduce,_,_,_.partial(_.getPath,_,"opponent.name"))},opp_faction:{desc:"Opp Faction",reduce:_.partial(a.reduce,_,_,"opponent.faction")},opp_caster:{desc:"Opp. Caster",reduce:_.partial(b.reduce,_,_,"opponent")},event:{desc:"Event",reduce:_.partial(c.reduce,_,_,_.partial(_.getPath,_,"setup.event"))},scenario:{desc:"Scenario",reduce:d.reduce},size:{desc:"Size",reduce:_.partial(c.reduce,_,_,function(a){return _.getPath(a,"setup.size")+"pts"})},initiative:{desc:"Initiative",reduce:e.reduce},result:{desc:"Result",reduce:f.reduce},result_time:{desc:"Result Over Time",reduce:g.reduce},points:{desc:"Points",reduce:h.reduce},tag:{desc:"Tag",reduce:i.reduce}},SELECTORS:{total:{desc:"Total",sort:j.sort},my_faction:{desc:"My Faction",sort:_.partial(k.sort,_,"my_army.faction")},my_caster:{desc:"My Caster",sort:_.partial(l.sort,_,_,"my_army")},opp_name:{desc:"Opp. Name",sort:_.partial(m.sort,_,_.partial(_.getPath,_,"opponent.name"))},opp_faction:{desc:"Opp. Faction",sort:_.partial(k.sort,_,"opponent.faction")},opp_caster:{desc:"Opp. Caster",sort:_.partial(l.sort,_,_,"opponent")},event:{desc:"Event",sort:_.partial(m.sort,_,_.partial(_.getPath,_,"setup.event"))},scenario:{desc:"Scenario",sort:n.sort},size:{desc:"Size",sort:_.partial(m.sort,_,function(a){return _.getPath(a,"setup.size")+"pts"})},init:{desc:"Initiative",sort:o.sort},result:{desc:"Result",sort:p.sort},tag:{desc:"Tag",sort:q.sort}},init:function(){a.init(),b.init(),d.init(),g.init(),k.init(),l.init(),n.init(),p.init()},generate:function(a,b,c,d,e){return _.has(r.ENTRIES,c)&&_.has(r.SELECTORS,d)?(a=_.clone(a),a[c]=a[c]||{},a[c][d+"."+e]=_.chain(b).apply(r.SELECTORS[d].sort,e).mapWith(r.ENTRIES[c].reduce).sortBy(_.partial(_.getPath,_,"title")).value(),a):a}};return r}]),angular.module("jlogApp.services").service("tags",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"tags").flatten().without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without.apply(null,_.cat([a],b))}};return a}]);