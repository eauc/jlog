"use strict";angular.module("jlogApp.services",[]),angular.module("jlogApp.filters",[]),angular.module("jlogApp.controllers",[]),angular.module("jlogApp.directives",[]),angular.module("jlogApp",["ui.router","jlogApp.controllers","jlogApp.filters","jlogApp.services","jlogApp.directives"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/battle"),a.state("battle",{url:"/battle",views:{"bottom-bar@":{templateUrl:"partials/battle_list_menu.html",controller:"listBottomCtrl"}},data:{}}).state("battle.view",{url:"/view/:index",views:{"page@":{templateUrl:"partials/battle_view.html",controller:"listViewCtrl"},"bottom-bar@":{templateUrl:"partials/battle_view_menu.html",controller:"listViewBottomCtrl"}},data:{}}).state("battle.edit",{url:"/edit/:index",views:{"page@":{templateUrl:"partials/battle_edit.html",controller:"listEditCtrl"},"bottom-bar@":{templateUrl:"partials/battle_edit_menu.html",controller:"listEditBottomCtrl"}},data:{}}).state("filter",{url:"/filter",views:{"page@":{templateUrl:"partials/filter.html",controller:"filterEditCtrl"},"bottom-bar@":{templateUrl:"partials/filter_menu.html",controller:"filterEditBottomCtrl"}},data:{}}).state("stats",{url:"/stats",views:{"page@":{templateUrl:"partials/stats.html",controller:"statsCtrl"},"bottom-bar@":{templateUrl:"partials/stats_menu.html",controller:"statsBottomCtrl"}},data:{}}).state("backup",{url:"/backup",views:{"page@":{templateUrl:"partials/backup.html",controller:"backupCtrl"}}}).state("help",{url:"/help",views:{"page@":{templateUrl:"partials/help.html"}}}).state("info",{url:"/info",views:{"page@":{templateUrl:"partials/info.html"}}})}]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]),angular.module("jlogApp.controllers").controller("backupCtrl",["$scope","$window","textImport","fileImport","igParser","textExport","fileExport","server","battles","filter",function(a,b,c,d,e,f,g,h,i,j){function k(){var b=(new Date).getTime();a.backup={text:f.generate("json",a.battles.list),url:g.generate("json",a.battles.list),name:"jlog_"+b+".json"}}e.init(),a.$watch("battles.list",function(a){_.isEmpty(a)||k()}),a.read_text=null,a.read_result={},a.doReadFile=function(b,c){a.read_result[b]=["Loading file..."],a.$digest(),d.read(b,c).then(function(c){var d=c[0],e=c[1],f=_.isEmpty(e);e.push("imported "+d.length+" battles"),_.isEmpty(d)||a.setBattles(d),a.read_result[b]=e,f&&a.stateGo("battle")},function(c){a.read_result[b]=c})},a.doReadText=function(b,d){_.isString(d)&&!s.isBlank(d)&&(a.read_result[b]=["Reading text..."],c.read(b,d).then(function(c){var d=c[0],e=c[1],f=_.isEmpty(e);e.push("imported "+d.length+" battles"),_.isEmpty(d)||a.setBattles(d),a.read_result[b]=e,f&&a.stateGo("battle")},function(c){a.read_result[b]=c}))},a.upload={id:null,msg:null},a.doUploadData=function(){a.upload={id:null,msg:"Uploading..."},h.upload(a.battles.list).then(function(b){a.upload={id:b[0],msg:b[1]}})},a.download={id:null,msg:null},a.doDownloadData=function(){_.isString(a.download.id)&&!s.isBlank(a.download.id)&&(a.download.msg="Downloading...",h.download(a.download.id).then(function(b){a.download.msg=b[1],_.exists(b[0])&&(a.setBattles(b[0]),a.stateGo("battle"))}))},a.doClearStorage=function(){i.clearStorage(),j.clearStorage()},a.old_data=null,a.doReadOldDatabase=function(){a.old_data=b.localStorage.getItem("jlog_battles")}}]),angular.module("jlogApp.controllers").controller("filterEditCtrl",["$scope",function(){}]).controller("filterEditBottomCtrl",["$scope","$window","filter",function(a,b,c){a.doBack=function(){a.battles.filter.cache=c.clearCache(a.battles.filter.cache),a.battles.filter.active=!0,a.updateBattles(),b.history.back()}}]),angular.module("jlogApp.controllers").controller("listCtrl",["$scope",function(a){a.doViewBattle=function(b){a.stateGo("battle.view",{index:b})}}]).controller("listBottomCtrl",["$scope","battles","fileExport",function(a,b,c){a.doAddBattle=function(){a.stateGo("battle.edit",{index:a.battles.list.length})},a.doSortBy=function(c){a.battles.sort=b.updateSortBy(a.sort_types,a.battles.sort,c),a.updateBattles()},a.exports={},a.doExportOpen=function(){var d=(new Date).getTime();a.exports={json:{name:"battles_"+d+".json",url:c.generate("json",a.battles.sorted_list),label:"JSON"},csv:{name:"battles_"+d+".csv",url:c.generate("csv",b.toTable(a.battles.sorted_list)),label:"CSV"},bb:{name:"battles_"+d+".txt",url:c.generate("bb",b.toTable(a.battles.sorted_list)),label:"BB Code"}}}}]),angular.module("jlogApp.controllers").controller("listEditCtrl",["$q","$scope","$state","$stateParams","prompt","battle","events","opponents","scenarios","tags",function(a,b,c,d,e,f,g,h,i,j){var k=parseFloat(d.index);a.when(b.ready).then(function(){b.battle=k<b.battles.list.length?_.snapshot(b.battles.list[k]):f.create({index:k}),c.current.data.index=k,c.current.data.battle=b.battle,c.current.data.save_enable=!1,b.$watch("battle_edit.$valid",function(a){c.current.data.save_enable=a})});var l={opponent:h,event:g,scenario:i},m={opponent:["opponent","name"],event:["setup","event"],scenario:["setup","scenario"]};b.doAdd=function(a){e.prompt("prompt","Enter new "+a+" name :").then(function(d){_.exists(d)&&(d=s(d).clean().value(),s.isBlank(d)||(b.battles[a+"s"]=l[a].add(b.battles[a+"s"],d),b.battle=_.setPath(b.battle,d,m[a],{}),c.current.data.battle=b.battle))})},b.doDelete=function(a){var d=_.getPath(b.battle,m[a]);_.exists(d)&&e.prompt("confirm","All references to "+d+" will be deleted.").then(function(){b.battles[a+"s"]=l[a].drop(b.battles[a+"s"],d),b.battle=_.setPath(b.battle,null,m[a],{}),c.current.data.battle=b.battle})},b.doAddTag=function(){e.prompt("prompt","Enter new tag name :").then(function(a){_.exists(a)&&(a=s(a).clean().value(),s.isBlank(a)||(b.battles.tags=j.add(b.battles.tags,a),b.battle=f.addTag(b.battle,a),c.current.data.battle=b.battle))})},b.doDeleteTag=function(){var a=b.battle.tags;_.isEmpty(a)||e.prompt("confirm",'All references to "'+a.join(",")+'" will be deleted.').then(function(){b.battles.tags=j.drop(b.battles.tags,a),b.battle.tags=[]})}}]).controller("listEditBottomCtrl",["$scope","$state","battles","filter",function(a,b,c,d){a.state=b.current.data,a.doSave=function(){a.battles.filter.cache=d.clearCache(a.battles.filter.cache,b.current.data.index),a.setBattles(c.save(a.battles.list,b.current.data.index,b.current.data.battle)),a.doClose()},a.doClose=function(){a.stateGo("battle")}}]),angular.module("jlogApp.controllers").controller("listViewCtrl",["$q","$scope","$stateParams",function(a,b,c){a.when(b.ready).then(function(){b.battle=b.battles.list[c.index]})}]).controller("listViewBottomCtrl",["$scope","$stateParams","prompt","battles",function(a,b,c,d){a.doEditBattle=function(){a.stateGo("battle.edit",{index:b.index})},a.doDeleteBattle=function(){c.prompt("confirm","You sure you wanna delete this battle ?").then(function(){a.setBattles(d.drop(a.battles.list,parseFloat(b.index))),a.doClose()})},a.doClose=function(){a.stateGo("battle")}}]),angular.module("jlogApp.controllers").controller("mainCtrl",["$scope","$state","$q","$window","$timeout","$location","$anchorScroll","scores","factions","scenarios","battles","events","opponents","tags","filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){_.exists(q)&&(e.cancel(q),q=null);var b=_.chunkAll(a.battles.sorted_list,20);a.battles.display_list=[];var c=function(){a.battles.display_list=_.cat(a.battles.display_list,_.first(b)),b=_.rest(b),_.isEmpty(b)||(q=e(c,200))};q=e(c,200)}a.stateIs=_.bind(b.is,b),a.stateGo=_.bind(b.go,b),a.battles={list:[],sorted_list:[],display_list:[],events:[],opponents:[],scenarios:[],tags:[],sort:{type:"date",reverse:!0},filter:{state:o.init(),active:!1,invert:!1,cache:{}}};var q;a.updateBattles=function(){o.store(a.battles.filter.state);var b=a.battles.filter.active?_.filter(a.battles.list,_.partial(o.match,a.battles.filter.state,_,a.battles.filter.invert,a.battles.filter.cache)):a.battles.list;a.battles.sorted_list=k.sort(b,a.sort_types,a.battles.sort.type,a.battles.sort.reverse),p()},a.setBattles=function(b){a.battles.list=k.buildIndex(b),k.store(a.battles.list),a.battles.opponents=m.fromBattles(a.battles.list),a.battles.events=l.fromBattles(a.battles.list),a.battles.tags=n.fromBattles(a.battles.list),a.battles.scenarios=j.fromBattles(a.battles.list),a.updateBattles()},a.ready=c.when(h.data()).then(function(b){return a.scores=b,c.when(i.data())}).then(function(b){return a.factions=b,c.when(j.data())}).then(function(){return c.when(k.sortTypes())}).then(function(b){a.sort_types=b}).then(function(){var b=k.init();a.setBattles(b)}),a.doToggleFilterActive=function(){a.battles.filter.active=!a.battles.filter.active,a.updateBattles()},a.doToggleFilterInvert=function(){a.battles.filter.invert=!a.battles.filter.invert,a.updateBattles()},a.doReload=function(){d.location.reload()},a.scrollTo=function(a){f.hash(a),g()}}]),angular.module("jlogApp.controllers").controller("statsCtrl",["$scope","$state","stats",function(a,b,c){c.init(),a.stats={},b.current.data={entry:"result",selector:"total",selector_arg:null,doGenerate:function(){a.stats=c.generate(a.stats,a.battles.sorted_list,this.entry,this.selector,this.selector_arg)}},a.state=b.current.data,a.$watch("battles.sorted_list",function(b){_.isEmpty(b)||a.state.doGenerate()})}]).controller("statsBottomCtrl",["$scope","$state","stats",function(a,b,c){a.SELECTORS=c.SELECTORS,a.ENTRIES=c.ENTRIES,a.state=b.current.data,a.doSetEntry=function(b){a.state.entry=b,a.state.doGenerate()},a.doSetSelector=function(b){a.state.selector_arg=a.state.selector===b?a.state.selector_arg:null,a.state.selector=b,a.state.doGenerate()}}]),angular.module("jlogApp.directives").directive("appCacheProgressBar",function(){return{restrict:"E",templateUrl:"partials/directives/appCacheProgressBar.html",scope:!0,controller:["$scope","$window","prompt","appCache",function(a,b,c,d){d.subscribe("statusChange",function(d){a.appCache=d,"ready"===d.status&&c.prompt("confirm",["A new version of this site is available. Load it?","(You might want to save your battles first, if so click Cancel)"]).then(function(){b.location.reload()}),a.$digest()})}],link:function(){}}}),angular.module("jlogApp.directives").controller("barsCtrl",["$scope",function(a){a.$watch("values",function(b){if(_.exists(b)){var c=Math.max.apply(null,_.values(b)),d=30/Math.max(1,_.keys(b).length-1);a.bars=_.chain(b).map(function(b,d){return{k:d,name:s.capitalize(d),width:a.width*b/c,value:b}}).sortBy(function(a){return-a.value}).map(function(b,c){return b.color=_.exists(_.getPath(a.hues,b.k))?"hsl("+_.getPath(a.hues,b.k)[0]+", "+_.getPath(a.hues,b.k)[1]+"%, 52%)":"hsl("+a.hue+", "+a.saturation+"%, "+(35+c*d)+"%)",b}).value()}})}]).directive("bars",[function(){return{restrict:"E",templateUrl:"partials/directives/bars.html",scope:{values:"=barsValues",hues:"=barsHues"},controller:"barsCtrl",link:function(a,b,c){a.width=.7*(b[0].querySelector("table").offsetWidth>>0),a.height=50,a.hue="200",c.$observe("barsHue",function(b){a.hue=_.exists(b)?b:"200"}),a.saturation="75",c.$observe("barsSaturation",function(b){a.saturation=_.exists(b)?b:"75"})}}}]),angular.module("jlogApp.directives").directive("openDropdown",[function(){return{restrict:"A",link:function(a,b){var c=b[0].parentElement,d=c.querySelector(".drop-mask");b[0].addEventListener("click",function(){c.classList.toggle("open")}),d.addEventListener("click",function(){c.classList.remove("open")})}}}]),angular.module("jlogApp.directives").directive("eaFile",function(){return{restrict:"A",scope:{eaFile:"&"},controller:["$scope",function(){}],link:function(a,b){b[0].onchange=function(){a.eaFile({file:b[0].files[0]})}}}}),angular.module("jlogApp.directives").directive("onlineIndicator",function(){return{restrict:"A",templateUrl:"partials/directives/onlineIndicator.html",scope:!0,controller:["$scope","$window","appCache",function(a,b,c){c.subscribe("statusChange",function(b){a.appCache=b,a.$digest()}),a.checkOnlineStatus=function(){c.update()}}],link:function(){}}}),angular.module("jlogApp.directives").controller("pieChartCtrl",["$scope",function(a){a.$watch("values",function(b){if(a.center={x:a.width/2,y:a.height/2},a.radius=Math.min(a.width,a.height)/2*.95,_.exists(b)){a.legends=_.chain(b.legends).map(function(a,c){return{label:a,count:"#"+b.values[c],color:b.colors[c]}}).filter(function(a,c){return b.values[c]>0}).value(),a.total=_.reduce(b.values,function(a,b){return a+b},0);var c=0;a.paths=_.chain(b.values).map(function(d,e){var f=2*Math.PI*c/a.total,g=2*Math.PI*(c+d)/a.total,h=Math.min(2*Math.PI*.999,Math.abs(g-f));g=f+h;var i=h>Math.PI?1:0;return c+=d,{large:i,start:{x:a.center.x+a.radius*Math.sin(f),y:a.center.y-a.radius*Math.cos(f)},end:{x:a.center.x+a.radius*Math.sin(g),y:a.center.y-a.radius*Math.cos(g)},color:b.colors[e]}}).filter(function(a,c){return b.values[c]>0}).value()}})}]).directive("pieChart",[function(){return{restrict:"E",templateUrl:"partials/directives/pieChart.html",scope:{values:"=pieValues"},controller:"pieChartCtrl",link:function(a,b){a.width=b[0].querySelector(".pie-container").offsetWidth>>0,a.height=a.width}}}]),angular.module("jlogApp.directives").factory("prompt",["$q",function(a){function b(){if(_.exists(c))return c;var b=a.defer();return e.push(b),b.promise}var c,d,e=[];return{register:function(a){c=a,c.active=!1,c.message=null,c.type="alert",c.input=null,c.doValidate=function(){c.close(),d.resolve(c.input),d=null},c.doCancel=function(){c.close(),d.reject(),d=null},_.each(e,function(a){a.resolve(c)}),e=[]},prompt:function(c,e){return d=a.defer(),a.when(b()).then(function(a){a.type=c,a.message=_.isString(e)?[e]:e,a.input=null,a.open()}),d.promise}}}]).controller("promptCtrl",["$scope","prompt",function(a,b){b.register(a)}]).directive("prompt",["$timeout",function(a){return{restrict:"E",templateUrl:"partials/directives/prompt.html",scope:!0,controller:"promptCtrl",link:function(b,c){var d=c[0].querySelector("input");b.open=function(){b.active=!0,a(function(){d.focus()},200)},b.close=function(){b.active=!1}}}}]),angular.module("jlogApp.directives").controller("stackGraphsCtrl",["$scope",function(a){a.$watch("values",function(b){if(_.exists(b)){var c=a.width/(b.values.length-1);a.legends=_.chain(b.legends).map(function(a,c){return{label:a,color:b.colors[c]}}).value(),a.polygons=_.chain(b.values).map(function(a){return _.reductions(a,function(a,b){return a+b},0)}).apply(function(d){var e=d[0].length;return _.chain(e).range().map(function(a){return _.map(d,function(b){return[_.nth(b,a),_.last(b)]})}).map(function(b){return _.map(b,function(b,d){return[d*c,a.height*(1-b[0]/b[1])]})}).map(function(c,d){return{color:b.colors[d],points:"0,"+a.height+" "+c.join(" ")+" "+a.width+","+a.height}}).value()}).reverse().value()}})}]).directive("stackGraphs",[function(){return{restrict:"E",templateUrl:"partials/directives/stackGraphs.html",scope:{values:"=gphValues"},controller:"stackGraphsCtrl",link:function(a,b){a.width=b[0].querySelector(".gph-container").offsetWidth>>0,a.height=a.width/2}}}]),angular.module("jlogApp.directives").controller("stacksCtrl",["$scope",function(a){a.$watch("values",function(b){if(_.exists(b)){var c=_.reduce(b.values,function(a,b,c){return a[c]=_.reduce(b,function(a,b){return a+b},0),a},{});a.stacks=_.map(b.values,function(d,e){var f=0;return{name:e,layers:_.map(d,function(g,h){var i=0<c[e]?a.width*g/c[e]:a.width/d.length,j={x:f,width:i,color:b.colors[h],value:g};return f+=i,j})}})}})}]).directive("stacks",[function(){return{restrict:"E",templateUrl:"partials/directives/stacks.html",scope:{values:"=stacksValues"},controller:"stacksCtrl",link:function(a,b){a.width=.7*(b[0].querySelector("table").offsetWidth>>0),a.height=50}}}]),angular.module("jlogApp.directives").directive("topMenu",[function(){return{restrict:"A",link:function(a,b){var c=document.querySelector("body"),d=b[0].querySelector("button"),e=b[0].querySelector(".top-menu-mask");d.addEventListener("click",function(){c.classList.add("top-menu-opened")}),e.addEventListener("click",function(){c.classList.remove("top-menu-opened")})}}}]),angular.module("jlogApp.filters").filter("battle",["filter",function(a){return function(b,c,d){return c&&_.isArray(b)?b.filter(function(b){return a.match(b,d)}):b}}]),angular.module("jlogApp.filters").filter("capitalise",[function(){return function(a){return"string"==typeof a?a.charAt(0).toUpperCase()+a.slice(1):a}}]),angular.module("jlogApp.filters").filter("initiative",[function(){return function(a){if(!angular.isObject(a)||"string"!=typeof a.won_roll||"string"!=typeof a.started)return"nil";var b="";return b+="true"===a.won_roll?"Won roll, ":"Lost roll, ",b+="true"===a.started?"started game":"chose side"}}]),angular.module("jlogApp.filters").filter("scoreResultColor",[function(){return function(a){return"string"!=typeof a?"":"victory"==a?"text-success":"defeat"==a?"text-danger":"text-warning"}}]).filter("scoreResultClass",[function(){return function(a){var b;switch(a){case"victory":b="text-success";break;case"draw":b="text-warning";break;case"defeat":b="text-danger"}return b}}]).filter("scoreTypeLetter",[function(){return function(a){return"string"==typeof a?a.charAt(0).toUpperCase():a}}]).filter("scoreType",[function(){return function(a){switch(a){case"va":return"Assassination Victory";case"vs":return"Scenario Victory";case"vc":return"Clock Victory";case"vt":return"Tiebreaker Victory";case"dd":return"Dice-down Draw";case"da":return"Assassination Defeat";case"ds":return"Scenario Defeat";case"dc":return"Clock Defeat";case"dt":return"Tiebreaker Defeat"}return""}}]),angular.module("jlogApp.filters").filter("battle",["battle",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("factions",["factions",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("scenarios",["scenarios",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("scores",["scores",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]),_.mixin({apply:function(a,b){var c=_.rest(_.rest(arguments));return b.apply(null,_.cons(a,c))}}),_.mixin({deepExtend:function a(b,c){return _.each(c,function(c,d){void 0!==c&&(!_.isObject(c)||_.isArray(c)||_.isFunction(c)||!_.isObject(b[d])||_.isArray(b[d])||_.isFunction(b[d])?b[d]=c:a(b[d],c))}),b}}),_.mixin({mapWith:function(a,b){var c=_.rest(_.rest(arguments)),d=_.partial.apply(null,_.cat([b,_],c));return _.map(a,d)}}),_.mixin({spy:function(a){var b=_.rest(arguments);return console.log.apply(console,_.cat(b,[a])),a}}),angular.module("jlogApp.services").factory("appCache",["$window","$rootScope","pubsub",function(a,b,c){function d(a){switch(e.status="checking",e.online="Checking",a.type){case"checking":e.progress=0;break;case"downloading":e.online="Online",e.progress=0;break;case"progress":e.online="Online",e.progress=(e.progress+1)%100;break;case"cached":case"noupdate":case"obsolete":e.online="Online",e.status="done",e.progress=0;break;case"updateready":e.online="Online",e.status="ready",e.progress=0;break;case"error":e.status="error",e.online="Offline",e.progress=0}g.publish("statusChange",_.clone(e))}var e={status:null,online:null,progress:0},f=a.applicationCache,g=c("appCache");return f.addEventListener("cached",d,!1),f.addEventListener("checking",d,!1),f.addEventListener("downloading",d,!1),f.addEventListener("error",d,!1),f.addEventListener("noupdate",d,!1),f.addEventListener("obsolete",d,!1),f.addEventListener("progress",d,!1),f.addEventListener("updateready",d,!1),g.update=function(){f.update()},g}]),angular.module("jlogApp.services").factory("battle",[function(){var a={create:function(a){a=_.exists(a)?a:{};var b=new Date;return _.deepExtend({index:0,date:{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate()},my_army:{faction:null,caster:null},opponent:{name:null,faction:null,caster:null},setup:{size:null,scenario:null,event:null,initiative:{won_roll:null,started:null}},score:null,points:{my_army:{scenario:null,army:null,kill:null},opponent:{scenario:null,army:null,kill:null}},tags:[],comment:null},a)},test:function(a,b,c,d){var e=_.chain(b).shuffle().first().value(),f=_.chain(b).shuffle().first().value();return{index:a,date:{year:_.chain([2012,2014,2013]).shuffle().first().value(),month:_.chain([4,8,9]).shuffle().first().value(),day:_.chain([5,12,19]).shuffle().first().value()},my_army:{faction:e.key,caster:_.chain(e.casters).shuffle().first().value().key},opponent:{name:_.chain(["wood","kevin","fred"]).shuffle().first().value(),faction:f.key,caster:_.chain(f.casters).shuffle().first().value().key},setup:{size:_.chain([15,25,35,50]).shuffle().first().value(),scenario:_.chain(d).shuffle().first().value().key,event:_.chain(["master","amical","wtc"]).shuffle().first().value(),initiative:{won_roll:_.chain(["true","false"]).shuffle().first().value(),started:_.chain(["true","false"]).shuffle().first().value()}},score:_.chain(c).keys().shuffle().first().value(),points:{my_army:{scenario:5*Math.random()>>0,army:50*Math.random()>>0,kill:50*Math.random()>>0},opponent:{scenario:5*Math.random()>>0,army:50*Math.random()>>0,kill:50*Math.random()>>0}},tags:["tiers4","raek spam"],comment:"don't panic"}},addTag:function(a,b){return _.chain(a).clone().apply(function(a){return a.tags=_.chain(a.tags).cat(b).uniq().sort().value(),a}).value()},initRollDescFor:function(a){return"true"===_.getPath(a,"setup.initiative.won_roll")?"Won Roll":"Lost Roll"},initStartDescFor:function(a){return"true"===_.getPath(a,"setup.initiative.started")?"Started Game":"Chose Side"}};return a}]).service("battles",["$window","$http","$q","battle","orderByFilter","jsonStringifier",function(a,b,c,d,e,f){function g(a){return _.chain(a).apply(s.chars).map(function(a){return a.charCodeAt(0)}).reduce(function(a,b){return a=(a<<5)-a+b,a&=a},0).value()}var h,i={date:function(a){return a.date.year+"-"+a.date.month+"-"+a.date.day},my_faction:"my_army.faction",my_caster:"my_army.caster",opponent:"opponent.name",opponent_faction:"opponent.faction",opponent_caster:"opponent.caster",size:"setup.size",scenario:"setup.scenario",event:"setup.event",initiative:function(a){return("true"===a.setup.initiative.won_roll?"wonRoll":"lostRoll")+"-"+("true"===a.setup.initiative.started?"startedGame":"choseSide")},result:"score",my_cp:"points.my_army.scenario",my_ap:"points.my_army.army",my_kp:"points.my_army.kill",opponent_cp:"points.opponent.scenario",opponent_ap:"points.opponent.army",opponent_kp:"points.opponent.kill",tags:function(a){return a.tags.join("|")},comment:"comment"},j={init:function(){var b,c=a.localStorage.getItem("jlog_battles_v2");if(_.isString(c))try{if(b=JSON.parse(c),_.isArray(b))return b}catch(d){}if(c=a.localStorage.getItem("jlog_battles"),_.isString(c))try{if(b=JSON.parse(c),_.isArray(b))return b}catch(d){}return[]},store:function(b){a.localStorage.setItem("jlog_battles_v2",f.stringify(b))},clearStorage:function(){a.localStorage.removeItem("jlog_battles_v2"),a.localStorage.removeItem("jlog_battles")},buildIndex:function(a){return _.each(a,function(a,b){a.index=b,a.hash=g(f.stringify(a))})},save:function(a,b,c){var d=_.clone(a);return d.splice(b,1,c),d},drop:function(a,b){var c=_.clone(a);return c.splice(b,1),c},test:function(a,b,c,e){return _.chain(a).range().map(_.partial(d.test,_,b,c,e)).value()},sortTypes:function(){return _.exists(h)?h:b.get("data/sorts.json").then(function(a){return h=a.data},function(a){return c.reject(a)})},updateSortBy:function(a,b,c){if(!_.exists(a[c]))return b;var d=_.clone(b);return d.type===c?d.reverse=!d.reverse:(d.type=c,d.reverse=a[c].reverse),d},sort:function(a,b,c,d){return e(a,b[c].key,d)},toTable:function(a){return _.cat([_.keys(i)],_.chain(a).map(function(a){return _.reduce(i,function(b,c){return b.push(_.isFunction(c)?c(a):_.getPath(a,c)),b},[])}).value())}};return j}]),angular.module("jlogApp.services").factory("bbStringifier",[function(){function a(a,b){return"["+b+"]"+a+"[/"+b+"]"}var b="\r\n",c={stringify:function(c){return _.chain(c).map(function(b,c){return _.chain(b).map(function(b){return 0===c?a(b,"b"):b}).mapWith(a,"td").join("").apply(a,"tr").value()}).join(b).apply(a,"table").value()}};return c}]),angular.module("jlogApp.services").factory("csvStringifier",[function(){var a="\r\n",b={stringify:function(b){return _.chain(b).map(function(a){return _.map(a,function(a){return _.isString(a)&&(a=a.replace(/\"/g,'""')),a=_.exists(a)?a:"",'"'+a+'"'})}).map(function(a){return a.join(",")}).join(a).value()}};return b}]),angular.module("jlogApp.services").service("events",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"setup.event").without(null,void 0).uniq().sortBy(function(a){return a.toUpperCase()}).value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without(a,b)}};return a}]),angular.module("jlogApp.services").factory("factions",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/factions.json").then(function(a){return c=_.chain(a.data).map(function(a,b){return{key:b,name:a.name,icon:a.icon,hue:a.hue,casters:_.map(a.casters,function(a,b){var c=d.normaliseCaster(b);return{key:c,name:a.name}})}}).sortBy(_.accessor("name")).map(function(a){return a.casters=_.sortBy(a.casters,_.accessor("key")),a}).value()}).catch(function(a){return b.reject(a)})},normaliseCaster:function(a){if(!_.isString(a)||s.isBlank(a))return null;var b=a.charAt(a.length-1);return("0">b||b>"9")&&(a+="1"),a.toLowerCase()},keyForName:function(a,b){return _.chain(a).where({name:b}).first().getPath("key").value()},nameFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("name").value()},iconFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("icon").apply(function(a){return _.exists(a)?"data/img/"+a:a}).value()},hueFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("hue").value()},castersFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("casters").value()},casterNameFor:function(a,b,c){return _.chain(a).where({key:b}).first().getPath("casters").where({key:c}).first().getPath("name").value()}};return d}]),angular.module("jlogApp.services").factory("jsonStringifier",[function(){var a={stringify:function(a){return JSON.stringify(a,function(a,b){return s.startsWith(a,"$$")?void 0:b})}};return a}]).factory("textExport",["$window","csvStringifier","bbStringifier","jsonStringifier",function(a,b,c,d){a.URL=a.URL||a.webkitURL;var e={csv:b,bb:c,json:d};return{generate:function(a,b){return _.chain(b).apply(e[a].stringify).value()}}}]).factory("fileExport",["$window","csvStringifier","bbStringifier","jsonStringifier",function(a,b,c,d){a.URL=a.URL||a.webkitURL;var e={csv:b,bb:c,json:d};return{generate:function(b,c){return _.chain(c).apply(e[b].stringify).apply(function(b){return new a.Blob([b],{type:"text/plain"})}).apply(a.URL.createObjectURL).value()},cleanup:function(b){_.exists(b)&&a.URL.revokeObjectURL(b)}}}]),angular.module("jlogApp.services").factory("jsonParser",[function(){return{parse:function(a){return[JSON.parse(a),[]]}}}]).factory("textImport",["$window","$q","jsonParser","igParser",function(a,b,c,d){var e={json:c,ig:d};return{read:function(a,c){var d,f=b.defer();try{d=e[a].parse(c),f.resolve(d)}catch(g){f.reject(["invalid text : "+g.message])}return f.promise}}}]).factory("fileImport",["$window","$q","jsonParser","igParser",function(a,b,c,d){var e={json:c,ig:d};return{read:function(c,d){var f=new a.FileReader,g=b.defer();return f.onload=function(a){var b;try{b=e[c].parse(a.target.result),g.resolve(b)}catch(d){g.reject(["invalid file : "+d.message])}},f.onerror=function(){g.reject(["error reading file"])},f.onabort=function(){g.reject(["abort reading file"])},f.readAsText(d),g.promise}}}]),angular.module("jlogApp.services").factory("filterMatchSimple",[function(){var a={create:function(a){return _.extend({active:!1,is:"true",value:[]},a)},match:function(a,b,c){var d=_.getPath(b,c),e=_.isEmpty(a.value)||0<=_.indexOf(a.value,d);return"true"===a.is?e:!e}};return a}]).factory("compareDate",[function(){return function(a,b){return a.year>b.year?1:a.year<b.year?-1:a.month>b.month?1:a.month<b.month?-1:a.day>b.day?1:a.day<b.day?-1:0}}]).factory("filterMatchComp",[function(){function a(a,b){switch(a){case"==":return 0===b;case"!=":return 0!==b;case">":return-1===b;case">=":return 1!==b;case"<":return 1===b;case"<=":return-1!==b}return!1}var b={create:function(a,b){return _.deepExtend({active:!1,is:"==",value:b()},a)},match:function(b,c,d,e){var f=_.getPath(c,d),g=e(b.value,f),h=a(b.is,g);return h}};return b}]).factory("filterMatchCaster",[function(){var a={create:function(a){return _.deepExtend({active:!1,is:"true",value:{faction:null,caster:[]}},a)},match:function(a,b,c){var d=_.getPath(b,c),e=a.value.faction===d.faction&&(_.isEmpty(a.value.caster)||0<=_.indexOf(a.value.caster,d.caster));return"true"===a.is?e:!e}};return a}]).factory("filterMatchInitiative",[function(){var a={create:function(a){return _.extend({active:!1,is:"true",value:{won_roll:"",started:""}},a)},match:function(a,b){var c=b.setup.initiative,d=(s.isBlank(a.value.won_roll)||a.value.won_roll===c.won_roll)&&(s.isBlank(a.value.started)||a.value.started===c.started);return"true"===a.is?d:!d}};return a}]).factory("filterMatchTags",[function(){var a={create:function(a){return _.extend({active:!1,is:"any",value:[]},a)},match:function(a,b){if(_.isEmpty(a.value))return!0;if(_.isEmpty(b.tags))return"none"===a.is||"not_all"===a.is;var c=_.map(a.value,function(a){return 0<=_.indexOf(b.tags,a)}),d=_.every(c),e=_.some(c);switch(a.is){case"any":return e;case"all":return d;case"not_all":return!d;case"none":return!e;default:return!1}}};return a}]).factory("filter",["$window","jsonStringifier","filterMatchSimple","filterMatchComp","filterMatchCaster","filterMatchInitiative","filterMatchTags","compareDate",function(a,b,c,d,e,f,g,h){function i(){var a=new Date;return{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()}}function j(a){return _.isObject(a)?a:{}}var k=[{key:"date",create:_.partial(d.create,_,i),match:_.partial(d.match,_,_,"date",h)},{key:"my_army",create:e.create,match:_.partial(e.match,_,_,"my_army")},{key:"opp_name",create:c.create,match:_.partial(c.match,_,_,"opponent.name")},{key:"opp_caster",create:e.create,match:_.partial(e.match,_,_,"opponent")},{key:"result",create:c.create,match:_.partial(c.match,_,_,"score")},{key:"scenario",create:c.create,match:_.partial(c.match,_,_,"setup.scenario")},{key:"initiative",create:f.create,match:f.match},{key:"size",create:_.partial(d.create,_,_.always(50)),match:_.partial(d.match,_,_,"setup.size",_.comparator(_.lt))},{key:"event",create:c.create,match:_.partial(c.match,_,_,"setup.event")},{key:"tags",create:g.create,match:g.match}],l={init:function(){var b,c=a.localStorage.getItem("jlog_filter_v2");if(_.isString(c))try{if(b=JSON.parse(c),_.isObject(b))return l.create(b)}catch(d){}return l.create()},store:function(c){a.localStorage.setItem("jlog_filter_v2",b.stringify(c))},clearStorage:function(){a.localStorage.removeItem("jlog_filter"),a.localStorage.removeItem("jlog_filter_v2")},create:function(a){return a=j(a),_.chain(k).reduce(function(b,c){return b[c.key]=c.create(j(a[c.key])),b},{}).value()},match:function(a,b,c,d){return d=_.exists(d)?d:{},_.exists(d[b.index])||(d[b.index]=_.chain(k).filter(function(b){return _.getPath(a,b.key+".active")}).map(function(b){return[b.match,a[b.key]]}).map(function(a){return a[0](a[1],b)}).every().value()),c?!d[b.index]:d[b.index]},clearCache:function(a,b){return _.exists(b)?_.omit(a,""+b):{}}};return l}]),angular.module("jlogApp.services").factory("igParser",["$q","battle","factions","scenarios",function(a,b,c,d){function e(a){if(s.isBlank(a))return[];for(var b=",",c=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\,\\r\\n]*))',"gi"),d=[[]],e=c.exec(a);e;){var f=e[1];f.length&&f!=b&&d.push([]);var g;g=e[2]?e[2].replace(/\"\"/g,'"'):e[3],_.last(d).push(g),e=c.exec(a)
}return d}var f,g,h={0:"dd",1:"va",2:"vs",3:"vt",4:"vt",5:"vt",6:"vt",7:"vc","-1":"da","-2":"ds","-3":"dt","-4":"dt","-5":"dt","-6":"dt","-7":"dc"},i={1:{won_roll:"true",started:"true"},2:{won_roll:"true",started:"false"},3:{won_roll:"false",started:"true"},4:{won_roll:"false",started:"false"}},j={init:function(){a.when(c.data()).then(function(a){f=a}),a.when(d.data()).then(function(a){g=a})},parse:function(a){var j=[],k=_.clone(g),l=_.chain(a).apply(e).map(function(a,e){if(_.isEmpty(a)||1===_.size(a)&&s.isBlank(a[0]))return void 0;if(a=_.map(a,function(a){return!_.isString(a)||a.match(/null/i)?"":a}),18!=a.length)return void j.push("line "+(e+1)+": invalid nb of fields ("+a.length+", expected 18)");var g=new Date(parseFloat(a[0])),l=c.keyForName(f,a[1]);_.exists(l)||j.push("line "+(e+1)+": unknown faction "+a[1]);var m=c.keyForName(f,a[4]);_.exists(m)||j.push("line "+(e+1)+": unknown faction "+a[4]);var n=_.getPath(h,a[6]);_.exists(n)||j.push("line "+(e+1)+": unknown score "+a[6]);var o=d.nameFor(k,a[13]);_.exists(o)?o=a[13]:s.isBlank(a[13])?o=null:(k=d.add(k,a[13]),o=a[13]);var p=_.getPath(i,a[16]);return _.exists(p)?p=_.clone(p):(s.isBlank(a[16])||j.push("line "+(e+1)+": unknown initiative "+a[16]),p=void 0),b.create({date:{year:g.getFullYear(),month:g.getMonth()+1,day:g.getDate()},my_army:{faction:l,caster:c.normaliseCaster(a[2])},opponent:{name:a[3],faction:m,caster:c.normaliseCaster(a[5])},score:n,points:{my_army:{scenario:_.isNumeric(a[7])?parseFloat(a[7]):null,army:_.isNumeric(a[8])?parseFloat(a[8]):null,kill:_.isNumeric(a[9])?parseFloat(a[9]):null},opponent:{scenario:_.isNumeric(a[10])?parseFloat(a[10]):null,army:_.isNumeric(a[11])?parseFloat(a[11]):null,kill:_.isNumeric(a[12])?parseFloat(a[12]):null}},setup:{scenario:o,size:_.isNumeric(a[14])?parseFloat(a[14]):null,event:a[15],initiative:p},comment:a[17]})}).without(void 0).spy("ig battles",j).value();return[l,j]}};return j}]),angular.module("jlogApp.services").service("opponents",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"opponent.name").without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without(a,b)}};return a}]),angular.module("jlogApp.services").factory("pubsub",[function(){var a="#watch#";return function(b){function c(a,b){f[a]=f[a]||[],f[a].push(b)}function d(a,b){return function(){f[a]=_.without(f[a],b)}}function e(a,b){_.isArray(f[a])&&_.each(f[a],function(a){a.apply(null,b)})}var f={};return{subscribe:function(a,b){return _.isFunction(b)?(c(a,b),d(a,b)):void 0},publish:function(b){var c=Array.prototype.slice.call(arguments,0);e(b,_.rest(c)),e(a,c)}}}}]),angular.module("jlogApp.services").service("scenarios",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/scenarios.json").then(function(a){return c=_.chain(a.data).map(function(a,b){return{key:b,scenars:_.chain(a).map(function(a,b){return{key:b,name:a.name}}).sortBy(_.accessor("name")).value()}}).sortBy(_.accessor("key")).reverse().mapcat(_.accessor("scenars")).value(),_.clone(c)},function(a){return b.reject(a)})},fromBattles:function(a){var b=_.clone(c);return _.chain(a).mapWith(_.getPath,"setup.scenario").uniq().without(void 0,null).sort().each(function(a){_.exists(d.nameFor(b,a))||(b=d.add(b,a))}).value(),b},add:function(a,b){return _.chain(a).cat({key:b,name:b}).filter(function(a){return _.exists(_.getPath(a,"key"))}).uniq(!1,_.partial(_.getPath,_,"key")).value()},drop:function(a,b){return _.filter(a,function(a){return a.key!==b})},nameFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("name").value()}};return d}]),angular.module("jlogApp.services").factory("scores",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/scores.json").then(function(a){return c=a.data,a.data},function(a){return b.reject(a)})},letterFor:function(a,b){return _.getPath(a,b+".letter")},typeFor:function(a,b){return _.getPath(a,b+".type")},resultFor:function(a,b){return _.getPath(a,b+".result")},classFor:function(a,b){return _.getPath(a,b+".class")}};return d}]),angular.module("jlogApp.services").factory("server",["$http",function(a){var b={upload:function(b){return a.post("/api/log",{battles:b},{timeout:2e4}).then(function(a){return[a.data.id,"data uploaded"]},function(a){return[null,"upload failure ("+a.status+")"]})},download:function(b){return a.get("/api/log/"+b,{timeout:2e4}).then(function(a){return[a.data.battles,"data downloaded"]},function(a){return[null,"download failure ("+a.status+")"]})}};return b}]),angular.module("jlogApp.services").service("statEntryFaction",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},reduce:function(b,d,e){var f=_.chain(b).countBy(_.partial(_.getPath,_,e)).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value(),g=_.chain(c).reduce(function(a,b){return a[b.name]=b.hue,a},{}).value();return{title:d,hues:g,values:f}}}}]).service("statEntryCaster",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},reduce:function(b,d,e){var f=_.chain(b).groupBy(_.partial(_.getPath,_,e+".faction")).reduce(function(b,d,f){return b[a.nameFor(c,f)]=_.chain(d).countBy(_.partial(_.getPath,_,e+".caster")).value(),b},{}).value(),g=_.chain(c).reduce(function(a,b){return a[b.name]=b.hue,a},{}).value();return{title:d,hues:g,values:f}}}}]).service("statEntrySimple",[function(){return{reduce:function(a,b,c){return{title:b,values:_.chain(a).countBy(c).value()}}}}]).service("statEntryScenario",["scenarios","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},reduce:function(b,d){return{title:d,values:_.chain(b).countBy(_.partial(_.getPath,_,"setup.scenario")).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value()}}}}]).service("statEntryInit",[function(){return{reduce:function(a,b){return{title:b,legends:["Won Roll, Started Game","Won Roll, Chose Side","Lost Roll, Started Game","Lost Roll, Chose Side"],colors:["#4AE34D","#39B03C","#B02817","#E3341D"],values:_.chain(a).reduce(function(a,b){var c=_.getPath(b,"setup.initiative.won_roll"),d=_.getPath(b,"setup.initiative.started");return _.isString(c)&&_.isString(d)&&a[("true"===c?"wr":"lr")+"_"+("true"===d?"sg":"cs")]++,a},{wr_sg:0,wr_cs:0,lr_sg:0,lr_cs:0}).apply(function(a){return[a.wr_sg,a.wr_cs,a.lr_sg,a.lr_cs]}).value()}}}}]).service("statEntryResult",[function(){return{reduce:function(a,b){return{title:b,legends:["Assassination Victory","Clock Victory","Scenario Victory","Tiebreakers Victory","Dice Down Draw","Tiebreakers Defeat","Scenario Defeat","Clock Defeat","Assassination Defeat"],colors:["#91E893","#4AE34D","#39B03C","#3E633F","#E2E345","#63312B","#B02817","#E3341D","#E87263"],values:_.chain(a).reduce(function(a,b){return a[b.score]++,a},{va:0,vc:0,vs:0,vt:0,dd:0,da:0,dc:0,ds:0,dt:0}).apply(function(a){return[a.va,a.vc,a.vs,a.vt,a.dd,a.dt,a.ds,a.dc,a.da]}).value()}}}}]).service("statEntryTimeResult",["battles","$q",function(a,b){var c;return{init:function(){b.when(a.sortTypes()).then(function(a){c=a})},reduce:function(b,d){return{title:d,legends:["Assassination Victory","Clock Victory","Scenario Victory","Tiebreakers Victory","Dice Down Draw","Tiebreakers Defeat","Scenario Defeat","Clock Defeat","Assassination Defeat"],colors:["#91E893","#4AE34D","#39B03C","#3E633F","#E2E345","#63312B","#B02817","#E3341D","#E87263"],values:_.chain(b).apply(a.sort,c,"date",!1).reductions(function(a,b){var c=_.clone(a);return c[b.score]++,c},{va:0,vc:0,vs:0,vt:0,dd:0,da:0,dc:0,ds:0,dt:0}).mapWith(function(a){return[a.va,a.vc,a.vs,a.vt,a.dd,a.dt,a.ds,a.dc,a.da]}).value()}}}}]).service("statEntryPoints",[function(){return{reduce:function(a,b){return{title:b,colors:["#4AE34D","#E3341D"],values:_.chain(a).reduce(function(a,b){return _.isNumber(_.getPath(b,"points.my_army.scenario"))&&_.isNumber(_.getPath(b,"points.opponent.scenario"))&&(a.Scenario[0]+=b.points.my_army.scenario,a.Scenario[1]+=b.points.opponent.scenario,a.Scenario[2]++),_.isNumber(_.getPath(b,"points.my_army.army"))&&_.isNumber(_.getPath(b,"points.opponent.army"))&&(a.Army[0]+=b.points.my_army.army,a.Army[1]+=b.points.opponent.army,a.Army[2]++),_.isNumber(_.getPath(b,"points.my_army.kill"))&&_.isNumber(_.getPath(b,"points.opponent.kill"))&&(a.Kill[0]+=b.points.my_army.kill,a.Kill[1]+=b.points.opponent.kill,a.Kill[2]++),a},{Scenario:[0,0,0],Army:[0,0,0],Kill:[0,0,0]}).reduce(function(a,b,c){return b[2]=0===b[2]?1:b[2],a[c]=[Math.round(b[0]/b[2]*100)/100,Math.round(b[1]/b[2]*100)/100],a},{}).value()}}}}]).service("statEntryTag",["tags",function(a){return{reduce:function(b,c){return{title:c,values:_.chain(b).apply(a.fromBattles).reduce(function(a,c){return a[s.capitalize(c)]=_.filter(b,function(a){return 0<=_.indexOf(a.tags,c)}).length,a},{}).value()}}}}]),angular.module("jlogApp.services").service("statSelectorTotal",[function(){return{sort:function(a){return{Total:a}}}}]).service("statSelectorFaction",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b,d){return _.chain(b).groupBy(_.partial(_.getPath,_,d)).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value()}}}]).service("statSelectorCaster",["factions","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b,d,e){return _.exists(d)?_.chain(b).filter(function(a){return _.getPath(a,e+".faction")===d}).groupBy(_.partial(_.getPath,_,e+".caster")).reduce(function(b,e,f){return b[a.casterNameFor(c,d,f)]=e,b},{}).value():[]}}}]).service("statSelectorSimple",[function(){return{sort:function(a,b){return _.chain(a).groupBy(b).reduce(function(a,b,c){return a[s.capitalize(c)]=b,a},{}).value()}}}]).service("statSelectorScenario",["scenarios","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b){return _.chain(b).groupBy(_.partial(_.getPath,_,"setup.scenario")).reduce(function(b,d,e){return b[a.nameFor(c,e)]=d,b},{}).value()}}}]).service("statSelectorInit",[function(){return{sort:function(a){return _.chain(a).filter(function(a){return _.exists(_.getPath(a,"setup.initiative.won_roll"))&&_.exists(_.getPath(a,"setup.initiative.started"))}).groupBy(function(a){return("true"===_.getPath(a,"setup.initiative.won_roll")?"Won Roll":"Lost Roll")+", "+("true"===_.getPath(a,"setup.initiative.started")?"Started Game":"Chose Side")}).value()}}}]).service("statSelectorResult",["scores","$q",function(a,b){var c;return{init:function(){b.when(a.data()).then(function(a){c=a})},sort:function(b){return _.chain(b).groupBy(_.partial(_.getPath,_,"score")).reduce(function(b,d,e){var f=a.resultFor(c,e),g=a.typeFor(c,e);return _.exists(f)&&_.exists(g)&&(b[s.capitalize(a.resultFor(c,e))+" "+s.capitalize(a.typeFor(c,e))]=d),b},{}).value()}}}]).service("statSelectorTag",["tags",function(a){return{sort:function(b){a.fromBattles(b);return _.chain(b).apply(a.fromBattles).reduce(function(a,c){return a[s.capitalize(c)]=_.filter(b,function(a){return 0<=_.indexOf(a.tags,c)}),a},{}).value()}}}]),angular.module("jlogApp.services").service("stats",["statEntryFaction","statEntryCaster","statEntrySimple","statEntryScenario","statEntryInit","statEntryResult","statEntryTimeResult","statEntryPoints","statEntryTag","statSelectorTotal","statSelectorFaction","statSelectorCaster","statSelectorSimple","statSelectorScenario","statSelectorInit","statSelectorResult","statSelectorTag",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r={ENTRIES:{my_faction:{desc:"My Faction",reduce:_.partial(a.reduce,_,_,"my_army.faction")},my_caster:{desc:"My Caster",reduce:_.partial(b.reduce,_,_,"my_army")},opp_name:{desc:"Opp. Name",reduce:_.partial(c.reduce,_,_,_.partial(_.getPath,_,"opponent.name"))},opp_faction:{desc:"Opp Faction",reduce:_.partial(a.reduce,_,_,"opponent.faction")},opp_caster:{desc:"Opp. Caster",reduce:_.partial(b.reduce,_,_,"opponent")},event:{desc:"Event",reduce:_.partial(c.reduce,_,_,_.partial(_.getPath,_,"setup.event"))},scenario:{desc:"Scenario",reduce:d.reduce},size:{desc:"Size",reduce:_.partial(c.reduce,_,_,function(a){return _.getPath(a,"setup.size")+"pts"})},initiative:{desc:"Initiative",reduce:e.reduce},result:{desc:"Result",reduce:f.reduce},result_time:{desc:"Result Over Time",reduce:g.reduce},points:{desc:"Points",reduce:h.reduce},tag:{desc:"Tag",reduce:i.reduce}},SELECTORS:{total:{desc:"Total",sort:j.sort},my_faction:{desc:"My Faction",sort:_.partial(k.sort,_,"my_army.faction")},my_caster:{desc:"My Caster",sort:_.partial(l.sort,_,_,"my_army")},opp_name:{desc:"Opp. Name",sort:_.partial(m.sort,_,_.partial(_.getPath,_,"opponent.name"))},opp_faction:{desc:"Opp. Faction",sort:_.partial(k.sort,_,"opponent.faction")},opp_caster:{desc:"Opp. Caster",sort:_.partial(l.sort,_,_,"opponent")},event:{desc:"Event",sort:_.partial(m.sort,_,_.partial(_.getPath,_,"setup.event"))},scenario:{desc:"Scenario",sort:n.sort},size:{desc:"Size",sort:_.partial(m.sort,_,function(a){return _.getPath(a,"setup.size")+"pts"})},init:{desc:"Initiative",sort:o.sort},result:{desc:"Result",sort:p.sort},tag:{desc:"Tag",sort:q.sort}},init:function(){a.init(),b.init(),d.init(),g.init(),k.init(),l.init(),n.init(),p.init()},generate:function(a,b,c,d,e){return _.has(r.ENTRIES,c)&&_.has(r.SELECTORS,d)?(a=_.clone(a),a[c]=a[c]||{},a[c][d+"."+e]=_.chain(b).apply(r.SELECTORS[d].sort,e).mapWith(r.ENTRIES[c].reduce).sortBy(_.partial(_.getPath,_,"title")).value(),a):a}};return r}]),angular.module("jlogApp.services").service("tags",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"tags").flatten().without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without.apply(null,_.cat([a],b))}};return a}]),angular.module("jlogApp.services").run(["$templateCache",function(a){a.put("partials/backup.html","<div class=container id=backup><ul class=\"nav nav-tabs\" ng-init=\"panel='file'\"><li ng-class=\"{ 'active': panel==='file' }\"><a ng-click=\"panel='file'\">File</a></li><li ng-class=\"{ 'active': panel==='online' }\"><a ng-click=\"panel='online'\">Online</a></li><li ng-class=\"{ 'active': panel==='ig' }\"><a ng-click=\"panel='ig'\">IronGrudge</a></li><li ng-class=\"{ 'active': panel==='debug' }\"><a ng-click=\"panel='debug'\">Debug</a></li></ul><div ng-show=\"panel==='file'\"><div class=\"panel panel-info\"><div class=panel-heading><h4 class=panel-title>Save to file</h4></div><div class=panel-body><form><div class=form-group><label>Save backup file</label><a class=form-control ng-show=backup.url ng-href={{backup.url}} download={{backup.name}}>{{backup.name}}</a></div><div class=form-group><label>Or copy JSON text :</label><textarea class=form-control ng-model=backup.text>\n"+'            </textarea></div></form></div></div><div class="panel panel-info"><div class=panel-heading><h4 class=panel-title>Load from File</h4></div><div class=panel-body><form><div class=form-group><label>Choose a JLog json backup file :</label><input class=form-control id=import-file type=file ea-file="doReadFile(\'json\', file)"></div><div class=form-group><div class=text-warning ng-repeat="e in read_result.json">{{::e}}</div></div><div class=form-group><label>Or paste JSON text :</label><textarea class=form-control ng-model=read_text>\n            </textarea></div><button class="btn btn-default" type=button ng-click="doReadText(\'json\', read_text)"><div class="icon-sprite icon-file"></div>Read JSON</button></form></div></div></div><div ng-show="panel===\'online\'"><div class="panel panel-info"><div class=panel-heading><h4 class=panel-title>Sync / Upload</h4></div><div class=panel-body><button class="btn btn-default" type=button ng-click=doUploadData()>Upload current data to server <span class="icon-sprite icon-upload"></span></button><p class=result><strong class="text-{{upload.id === null ? \'warning\' : \'success\'}}">{{upload.msg | capitalise }}</strong></p><p ng-hide=upload.id>You can temporarily upload your current data to the web server. This will generate an Id that you can use in the Sync / Download section on another device to synchronize your data. The generated Id and the uploaded data are not permanent and will be cleared after a given period of time.</p><p ng-show=upload.id><strong>Sync Id :</strong> {{upload.id}}<br>Use this Sync ID on your other device, in the download input below.</p></div></div><div class="panel panel-info"><div class=panel-heading><h4 class=panel-title>Sync / Download</h4></div><div class=panel-body><p>Enter below the Sync ID given to you after uploading from another device.</p><form name=upload ng-submit=doDownloadData()><div class=input-group><input class=form-control ng-model=download.id placeholder="Sync Id..."> <span class=input-group-btn><button style=min-width:30px class="btn btn-default" type=submit><span class="icon-sprite icon-download"></span></button></span></div></form><p class=result><strong class=text-warning>{{download.msg | capitalise}}</strong></p></div></div></div><div ng-show="panel===\'ig\'"><div class="panel panel-info"><div class=panel-heading><h4 class=panel-title>Import IronGrudge</h4></div><div class=panel-body><form ng-submit="doReadText(\'ig\', import_text)"><div class=form-group><label>Choose an IronGrudge CSV file :</label><input class=form-control id=import-ig-file type=file ea-file="doReadFile(\'ig\', file)"></div><div class=text-warning ng-repeat="e in read_result.ig">{{::e}}</div><div class=form-group><label>Or paste CSV text :</label><textarea class=form-control ng-model=import_text>\n            </textarea><button class="btn btn-default" type=submit><span class="icon-sprite icon-file"></span> Read CSV</button></div></form><p>Iron Grudge CSV files are generated by exporting the SQLite backup file from IrongGrudge.</p><p>You can use the SQLite Manager firefox plugin to perform this operation. The SQL query you need to use in order to generate the correct CSV file is :</p><a ng-hide=_show_sql ng-click="_show_sql=true">Click to show SQL query...</a> <code ng-show=_show_sql>SELECT battle.date, my_faction.name, my_caster.shortname, player.name, opp_faction.name, opp_caster.shortname, battle.result, battle.controlPoints, battle.armyPoints, battle.killPoints, battle.opponentControlPoints, battle.opponentArmyPoints, battle.opponentKillPoints, scenario.name, battle.points, event.name, battle.initiative, battle.comment FROM battle LEFT JOIN army my_army ON battle.armyId=my_army._id LEFT JOIN faction my_faction ON my_army.factionId=my_faction._id LEFT JOIN caster my_caster ON my_army.casterId=my_caster._id LEFT JOIN player ON battle.opponentId=player._id LEFT JOIN army opp_army ON battle.opponentArmyId=opp_army._id LEFT JOIN faction opp_faction ON opp_army.factionId=opp_faction._id LEFT JOIN caster opp_caster ON opp_army.casterId=opp_caster._id LEFT JOIN scenario ON battle.scenarioId=scenario._id LEFT JOIN event ON battle.eventId=event._id;</code></div></div></div><div ng-show="panel===\'debug\'"><div class="panel panel-info"><div class=panel-heading><h4 class=panel-title>Debug</h4></div><div class=panel-body><button class="btn btn-default" ng-click=doClearStorage()>Clear Local Storage</button><p>This will clear all data stored in memory. You can then reload the data from a backup file to restart in a clean state.</p></div></div></div></div>'),a.put("partials/battle_edit.html",'<div class=container id=battle-edit><form class=form-horizontal name=battle_edit novalidate><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>My army :</h5></div><div class="panel-body row"><div class=col-xs-2><div class="faction-sprite faction-{{battle.my_army.faction}}"></div></div><div class=col-xs-10><div ng-class="{ \'has-error\':battle_edit.my_army_faction.$invalid }"><select class=form-control name=my_army_faction ng-model=battle.my_army.faction ng-options="f.key as f.name for f in factions" required><option value="" ng-if=!battle.my_army.faction>Please select</option></select></div><div ng-class="{ \'has-error\':battle_edit.my_army_caster.$invalid }"><select class=form-control name=my_army_caster ng-model=battle.my_army.caster ng-options="c.key as c.key | capitalise\n                                for c in factions | factions:\'castersFor\':battle.my_army.faction" required><option value="" ng-if=!battle.my_army.caster>Please select</option></select></div></div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Opponent :</h5></div><div class="panel-body row"><div class=col-xs-12><div class=input-group><span class=input-group-btn><button class="btn btn-default" ng-click="doAdd(\'opponent\')"><div class="icon-sprite icon-add"></div></button></span><div ng-class="{ \'has-error\':battle_edit.opponent_name.$invalid }"><select class=form-control name=opponent_name ng-model=battle.opponent.name ng-options="o as o|capitalise for o in battles.opponents" required><option value="" ng-if=!battle.opponent.name>Please select</option></select></div><span class=input-group-btn><button class="btn btn-default" ng-click="doDelete(\'opponent\')"><div class="icon-sprite icon-remove"></div></button></span></div></div><div class=col-xs-2><div class="faction-sprite faction-{{battle.opponent.faction}}"></div></div><div class=col-xs-10><div ng-class="{ \'has-error\':battle_edit.opponent_faction.$invalid }"><select class=form-control name=opponent_faction ng-model=battle.opponent.faction ng-options="f.key as f.name for f in factions" required><option value="" ng-if=!battle.opponent.faction>Please select</option></select></div><div ng-class="{ \'has-error\':battle_edit.opponent_caster.$invalid }"><select class=form-control name=opponent_caster ng-model=battle.opponent.caster ng-options="c.key as c.key|capitalise\n                                for c in factions | factions:\'castersFor\':battle.opponent.faction" required><option value="" ng-if=!battle.opponent.caster>Please select</option></select></div></div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Settings :</h5></div><div class="panel-body row"><div class="col-xs-2 control-label">Date</div><div class=col-xs-10><input class=form-control style=display:inline-block;width:40%;max-width:6em type=number ng-model=battle.date.year min=1999 max=2050 required> <input class=form-control style=display:inline-block;max-width:25%;max-width:6em type=number ng-model=battle.date.month min=1 max=12 required> <input class=form-control style=display:inline-block;max-width:25%;max-width:6em type=number ng-model=battle.date.day min=1 max=31 required></div><div class="col-xs-2 control-label">Event</div><div class=col-xs-10><div class=input-group><span class=input-group-btn><button class="btn btn-default" ng-click="doAdd(\'event\')"><div class="icon-sprite icon-add"></div></button></span><select class=form-control ng-model=battle.setup.event ng-options="e for e in battles.events"><option value="" ng-if=!battle.setup.event>Please select</option></select><span class=input-group-btn><button class="btn btn-default" ng-click="doDelete(\'event\')"><div class="icon-sprite icon-remove"></div></button></span></div></div><div class="col-xs-2 control-label">Scenario</div><div class=col-xs-10><div class=input-group><span class=input-group-btn><button class="btn btn-default" ng-click="doAdd(\'scenario\')"><div class="icon-sprite icon-add"></div></button></span><select class=form-control ng-model=battle.setup.scenario ng-options="s.key as s.name\n                                for s in battles.scenarios\n                                "><option value="" ng-if=!battle.setup.scenario>Please select</option></select><span class=input-group-btn><button class="btn btn-default" ng-click="doDelete(\'scenario\')"><div class="icon-sprite icon-remove"></div></button></span></div></div><div class="col-xs-2 control-label">Size</div><div class=col-xs-10><input class=form-control style=display:inline-block;width:40%;max-width:6em type=number ng-model="battle.setup.size"></div><div class="col-xs-2 control-label">Initiative</div><div class=col-xs-5><select class=form-control ng-model=battle.setup.initiative.won_roll><option selected value=true>Won roll</option><option selected value=false>Lost roll</option></select></div><div class=col-xs-5><select class=form-control ng-model=battle.setup.initiative.started><option selected value=true>started game</option><option selected value=false>chose side</option></select></div></div></div><div class="panel panel-info"><div class=panel-heading><div class=row><h5 class="col-xs-6 panel-title">Game Result :</h5></div></div><div class="panel-body row"><div class=col-xs-6 ng-class="{ \'has-error\':battle_edit.result.$invalid }"><select class=form-control name=result ng-model=battle.score ng-options="id as s.type|capitalise\n                              group by s.result|capitalise\n                              for (id, s) in scores\n                              " required><option value="" ng-if=!battle.score>Please select</option></select></div><div class="col-xs-6 control-label"><strong class="text-{{scores | scores:\'classFor\':battle.score}}">{{ scores | scores:\'resultFor\':battle.score | capitalise }}</strong></div><div class=clearfix></div><div class="col-xs-2 control-label"></div><div class="col-xs-5 control-label">My Army</div><div class="col-xs-5 control-label">Opponent</div><div class="col-xs-2 control-label">Control</div><div class=col-xs-5><input class=form-control type=number ng-model="battle.points.my_army.scenario"></div><div class=col-xs-5><input class=form-control type=number ng-model="battle.points.opponent.scenario"></div><div class="col-xs-2 control-label">Army</div><div class=col-xs-5><input class=form-control type=number ng-model="battle.points.my_army.army"></div><div class=col-xs-5><input class=form-control type=number ng-model="battle.points.opponent.army"></div><div class="col-xs-2 control-label">Kill</div><div class=col-xs-5><input class=form-control type=number ng-model="battle.points.my_army.kill"></div><div class=col-xs-5><input class=form-control type=number ng-model="battle.points.opponent.kill"></div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Tags :</h5></div><div class=panel-body><div class=input-group><span class=input-group-btn><button class="btn btn-default" ng-click=doAddTag()><div class="icon-sprite icon-add"></div></button></span><select class="form-control multiple" ng-model=battle.tags ng-options="t for t in battles.tags" multiple></select><span class=input-group-btn><button class="btn btn-default" ng-click=doDeleteTag()><div class="icon-sprite icon-remove"></div></button></span></div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Comment :</h5></div><div class=panel-body><textarea class=form-control ng-model=battle.comment></textarea></div></div></form></div>'),a.put("partials/battle_edit_menu.html",'<div><button class="btn btn-default" ng-disabled=!state.save_enable ng-click=doSave()><div class="icon-sprite icon-save"></div><span class=lbl>Save</span></button> <button class="btn btn-default" ng-click=doClose()><div class="icon-sprite icon-close"></div><span class=lbl>Cancel</span></button></div>'),a.put("partials/battle_list.html",'<div class=container ng-controller=listCtrl><div id=battle-list class=table><div class="row text-center table-header"><div class="hidden-xs col-sm-3" sort-by=date>Date</div><div class="col-xs-4 col-sm-4" sort-by=my_caster>My Caster</div><div class="col-xs-3 col-sm-3" sort-by=opponent>Opponent</div><div class="col-xs-4 col-sm-4" sort-by=opp_caster>Caster</div><div class="hidden-xs col-sm-1" sort-by=size>Size</div><div class="hidden-xs col-sm-4" sort-by=scenario>Scenario</div><div class="hidden-xs col-sm-2" sort-by=event>Event</div><div class="col-xs-1 col-sm-1" sort-by=result>R</div></div><div class=table-body><div class="row text-left clickable table-row" ng-repeat="\n           (bi,battle)\n           in battles.display_list\n           track by battle.hash\n           " ng-click=doViewBattle(battle.index)><div class="hidden-xs col-sm-3"><span>{{::battle.date.year+\'-\'+battle.date.month+\'-\'+battle.date.day}}</span></div><div class="col-xs-4 col-sm-4"><div class="faction-sprite faction-{{battle.my_army.faction}} small"></div><span>{{::battle.my_army.caster | capitalise}}</span></div><div class="col-xs-3 col-sm-3"><span>{{::battle.opponent.name | capitalise}}</span></div><div class="col-xs-4 col-sm-4"><div class="faction-sprite faction-{{battle.opponent.faction}} small"></div><span>{{::battle.opponent.caster | capitalise}}</span></div><div class="hidden-xs col-sm-1"><span>{{::battle.setup.size}}</span></div><div class="hidden-xs col-sm-4"><span>{{::battles.scenarios | scenarios:\'nameFor\':battle.setup.scenario}}</span></div><div class="hidden-xs col-sm-2"><span>{{::battle.setup.event}}</span></div><div class="col-xs-1 col-sm-1"><strong class="score-result text-{{::scores | scores:\'classFor\':battle.score}}">{{::scores | scores:\'letterFor\':battle.score}}</strong></div></div></div></div></div>'),a.put("partials/battle_list_menu.html",'<div><button class="btn btn-default" ng-click=doAddBattle()><span class="icon-sprite icon-add"></span> <span class=lbl>Add Battle</span></button><div class=drop><button class=btn ng-class="{\n            \'btn-default\': !battles.filter.active,\n            \'btn-success\': battles.filter.active && !battles.filter.invert,\n            \'btn-primary\': battles.filter.active && battles.filter.invert\n            }" open-dropdown><div class="icon-sprite icon-filter"></div><span class=lbl>Filter</span></button><div class=drop-mask><ul class=drop-menu><li class=dropdown-header>Filter</li><li><a href=#/filter><div class="icon-sprite icon-edit"></div>Edit</a></li><li ng-show="battles.filter.active &&\n                     !battles.filter.invert\n                     "><a ng-click=doToggleFilterInvert()><div class="icon-sprite icon-invert"></div>Invert</a></li><li ng-show="battles.filter.active &&\n                     battles.filter.invert\n                     "><a ng-click=doToggleFilterInvert()><div class="icon-sprite icon-invert"></div>Restore</a></li><li ng-hide=battles.filter.active><a ng-click=doToggleFilterActive()><div class="icon-sprite icon-enable"></div>Enable</a></li><li ng-show=battles.filter.active><a ng-click=doToggleFilterActive()><div class="icon-sprite icon-disable"></div>Disable</a></li></ul></div></div><div class=drop><button class="btn btn-default" open-dropdown><div class="icon-sprite icon-sort"></div><span class=lbl>Sort By</span></button><div class=drop-mask><ul class=drop-menu><li class=dropdown-header>Sort By</li><li ng-repeat="(key, type) in sort_types"><a ng-click=doSortBy(key)><div class=icon-sprite ng-class="{\n                           \'icon-down\': (battles.sort.type === key) && !battles.sort.reverse,\n                           \'icon-up\': (battles.sort.type === key) && battles.sort.reverse\n                           }"></div>{{type.name}}</a></li></ul></div></div><div class=drop><button class="btn btn-default" ng-click=doExportOpen() open-dropdown=drop-list-export><div class="icon-sprite icon-save"></div><span class=lbl>Export</span></button><div class=drop-mask><ul class=drop-menu><li class=dropdown-header>Export to</li><li ng-repeat="(k,v) in exports"><a ng-href={{::v.url}} download={{::v.name}}>{{::v.label}}</a></li></ul></div></div></div>'),a.put("partials/battle_view.html",'<div class=container id=battle-view><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>My army</h5></div><div class="panel-body row"><div class=col-xs-2><div class="faction-sprite faction-{{battle.my_army.faction}}"></div></div><div class="col-xs-10 row"><div class=col-xs-3><em>Faction:</em></div><div class=col-xs-9>{{::factions | factions:\'nameFor\':battle.my_army.faction}}</div><div class=clearfix></div><div class=col-xs-3><em>Caster:</em></div><div class=col-xs-9>{{::factions | factions:\'casterNameFor\':battle.my_army.faction:battle.my_army.caster}}</div></div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Opponent</h5></div><div class="panel-body row"><div class=col-xs-2><div class="faction-sprite faction-{{battle.opponent.faction}}"></div></div><div class="col-xs-10 row"><div class=col-xs-3><em>Name:</em></div><div class=col-xs-9>{{::battle.opponent.name | capitalise}}</div><div class=clearfix></div><div class=col-xs-3><em>Faction:</em></div><div class=col-xs-9>{{::factions | factions:\'nameFor\':battle.opponent.faction}}</div><div class=clearfix></div><div class=col-xs-3><em>Caster:</em></div><div class=col-xs-9>{{::factions | factions:\'casterNameFor\':battle.opponent.faction:battle.opponent.caster}}</div></div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Settings</h5></div><div class="panel-body row"><div class=col-xs-3><em>Date:</em></div><div class=col-xs-9>{{battle.date.year+\'/\'+battle.date.month+\'/\'+battle.date.day}}</div><div class=clearfix></div><div class=col-xs-3><em>Event:</em></div><div class=col-xs-9>{{::battle.setup.event}}</div><div class=clearfix></div><div class=col-xs-3><em>Scenario:</em></div><div class=col-xs-9>{{::battles.scenarios | scenarios:\'nameFor\':battle.setup.scenario}}</div><div class=clearfix></div><div class=col-xs-3><em>Size:</em></div><div class=col-xs-9>{{::battle.setup.size}}</div><div class=clearfix></div><div class=col-xs-3><em>Initiative:</em></div><div class=col-xs-9>{{:: battle | battle:\'initRollDescFor\'}} - {{:: battle | battle:\'initStartDescFor\'}}</div></div></div><div class="panel panel-info"><div class=panel-heading><div class=row><div class=col-xs-5><h5 class=panel-title>Game Result</h5></div><div class=col-xs-7><strong class="text-{{::scores | scores:\'classFor\':battle.score}}">{{::scores | scores:\'typeFor\':battle.score | capitalise}} {{::scores | scores:\'resultFor\':battle.score | capitalise}}</strong></div></div></div><div class="panel-body row"><div class=col-xs-2></div><div class=col-xs-5><em>My Army</em></div><div class=col-xs-5><em>Opponent</em></div><div class=clearfix></div><div class=col-xs-2><em>Control</em></div><div class=col-xs-5>{{::battle.points.my_army.scenario}}</div><div class=col-xs-5>{{::battle.points.opponent.scenario}}</div><div class=clearfix></div><div class=col-xs-2><em>Army</em></div><div class=col-xs-5>{{::battle.points.my_army.army}}</div><div class=col-xs-5>{{::battle.points.opponent.army}}</div><div class=clearfix></div><div class=col-xs-2><em>Kill</em></div><div class=col-xs-5>{{::battle.points.my_army.kill}}</div><div class=col-xs-5>{{::battle.points.opponent.kill}}</div></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Tags</h5></div><div class=panel-body><ul><li ng-repeat="t in ::battle.tags">{{::t}}</li></ul></div></div><div class="panel panel-info"><div class=panel-heading><h5 class=panel-title>Comment</h5></div><div class=panel-body>{{::battle.comment}}</div></div></div>'),a.put("partials/battle_view_menu.html",'<div><button class="btn btn-default" ng-click=doEditBattle()><div class="icon-sprite icon-edit"></div><span class=lbl>Edit</span></button> <button class="btn btn-default" ng-click=doDeleteBattle()><div class="icon-sprite icon-delete"></div><span class=lbl>Delete</span></button> <button class="btn btn-default" ng-click=doClose()><div class="icon-sprite icon-close"></div><span class=lbl>Close</span></button></div>'),a.put("partials/directives/appCacheProgressBar.html","<div class=appcache-progress ng-show=\"appCache.progress != 0\"><div class=appcache-progress-bar ng-style=\"{ 'width': appCache.progress + '%' }\"></div></div>"),a.put("partials/directives/bars.html",'<table class=col-xs-12 style=width:100%><tr ng-repeat="b in ::bars" style="vertical-align:middle;\n      padding:0;\n      margin:0"><td class=text-right style="padding:0 10px 0 0;\n        margin:0">{{::b.name}}</td><td style="padding:0;\n        margin:0;\n        width:{{::width+40}}px"><svg ng-attr-width={{::width+40}}px height=25px><rect x=0 y=0 ng-attr-width={{::b.width}} height=25 style="fill:{{::b.color}};\n              stroke:#000;\n              stroke-width:0.5"><text ng-attr-x={{::b.width+5}} y=20>{{::b.value}}</text></svg></td></tr></table>'),a.put("partials/directives/onlineIndicator.html","<li><a ng-click=checkOnlineStatus()>{{appCache.online}}</a></li>"),a.put("partials/directives/pieChart.html",'<div><div class="col-xs-6 text-right pie-legend"><ul><li ng-repeat="(i,l) in ::legends">{{::l.label}} {{::l.count}} <svg width=10px height=10px><rect x=0 y=0 width=10 height=10 style="stroke-width:1;\n                stroke:#000;\n                fill: {{::l.color}}"></svg></li><li><b>Total #{{::total}}</b> <svg width=10px height=10px><rect x=0 y=0 width=10 height=10 style="fill: white"></svg></li></ul></div><div class="col-xs-6 pie-container"><svg ng-attr-width={{::width}} ng-attr-height={{::height}}><path ng-repeat="(i,p) in ::paths" d="\n            M{{::center.x}},{{::center.y}}\n            L{{::p.start.x}},{{::p.start.y}}\n            A{{::radius}},{{::radius}} 0 {{::p.large}},1 {{::p.end.x}},{{::p.end.y}}\n            L{{::center.x}},{{::center.y}}\n            " style="stroke:#000;\n            stroke-width:0.5;\n            fill: {{::p.color}}"></svg></div></div>'),a.put("partials/directives/prompt.html",'<div ng-show=active><div class=prompt-mask></div><div class="prompt-container text-center"><div class="prompt-panel panel panel-default"><form name=prompt ng-submit=doValidate()><div class=panel-body><p ng-repeat="m in message">{{::m}}</p><input class=form-control ng-model=input ng-show="type===\'prompt\'"></div><div class=panel-footer><button class="btn btn-default" type=button style=width:45% ng-hide="type===\'alert\'" ng-click=doCancel()>Cancel</button> <button class="btn btn-primary" type=submit style=width:45%>Ok</button></div></form></div></div></div>'),a.put("partials/directives/stackGraphs.html",'<div><div class=gph-legend><div style="display:inline-block;margin:0 5px" ng-repeat="(i,l) in ::legends">{{::l.label}} <svg width=10px height=10px><rect x=0 y=0 width=10 height=10 style="stroke-width:1;\n              stroke:#000;\n              fill: {{::l.color}}"></svg></div></div><div class=gph-container><svg ng-attr-width={{::width}} ng-attr-height={{::height}}><polygon ng-repeat="(i,p) in ::polygons" points={{::p.points}} style="stroke:#000;\n               stroke-width:0.5;\n               fill: {{::p.color}}"></svg></div></div>'),a.put("partials/directives/stacks.html",'<table class=col-xs-12 style=width:100%><tr ng-repeat="s in ::stacks" style="vertical-align:middle;\n      padding:0;\n      margin:0"><td class=text-right style="padding:0 10px 0 0;\n        margin:0">{{::s.name}}</td><td style="padding:0;\n        margin:0;\n        width:{{::width+40}}px"><svg ng-attr-width={{::width+40}}px height=25px><rect ng-repeat="l in ::s.layers" ng-attr-x={{::l.x}} y=0 ng-attr-width={{::l.width}} height=25 style="fill:{{::l.color}};\n              stroke:#000;\n              stroke-width:0.5"><text ng-repeat="l in ::s.layers" ng-attr-x={{::l.x+5}} y=20>{{::l.value}}</text></svg></td></tr></table>'),a.put("partials/filter.html",'<div class=container id=filter-edit><form class=form-horizontal name=filter_edit novalidate><div class=title><div class="icon-sprite icon-edit"></div>Edit Filter</div><div class="panel panel-default first"><div class=panel-heading ng-click="battles.filter.state.date.active=!battles.filter.state.date.active" ng-class="{ \'active\': battles.filter.state.date.active }"><div class=icon-sprite ng-class="{ \'icon-checked\':battles.filter.state.date.active,\n                       \'icon-unchecked\':!battles.filter.state.date.active\n                       }"></div><h5 class=panel-title>Date</h5></div><div class="panel-body row" ng-show=battles.filter.state.date.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.date.is><option value="==">==</option><option value="!=">!=</option><option value=&gt;>&gt;</option><option value="&gt;=">&gt;=</option><option value="<">&lt;</option><option value="<=">&lt;=</option></select></div><div class=col-xs-9><input type=number class=form-control style=display:inline-block;width:40%;max-width:6em ng-model="battles.filter.state.date.value.year"> <input type=number class=form-control style=display:inline-block;width:40%;max-width:6em ng-model="battles.filter.state.date.value.month"> <input type=number class=form-control style=display:inline-block;width:40%;max-width:6em ng-model="battles.filter.state.date.value.day"></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.my_army.active=!battles.filter.state.my_army.active" ng-class="{\n                     \'active\': battles.filter.state.my_army.active\n                     }"><div class=icon-sprite ng-class="{ \'icon-checked\':battles.filter.state.my_army.active,\n                        \'icon-unchecked\':!battles.filter.state.my_army.active\n                        }"></div><h5 class=panel-title>My caster</h5></div><div class="panel-body row" ng-show=battles.filter.state.my_army.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.my_army.is><option value=true selected>is</option><option value=false>is not</option></select></div><div class=col-xs-9><select class=form-control ng-model=battles.filter.state.my_army.value.faction ng-options="f.key as f.name for f in factions"><option value="" ng-if=!battles.filter.state.my_army.value.faction>Please select</option></select></div><div class=col-xs-3></div><div class=col-xs-9><select class="form-control multiple" ng-model=battles.filter.state.my_army.value.caster ng-options="c.key as c.key|capitalise\n                              for c in factions |\n                              factions:\'castersFor\':battles.filter.state.my_army.value.faction\n                              " multiple></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.opp_name.active = !battles.filter.state.opp_name.active" ng-class="{\n           \'active\': battles.filter.state.opp_name.active\n           }"><div class=icon-sprite ng-class="{ \'icon-checked\': battles.filter.state.opp_name.active,\n                       \'icon-unchecked\': !battles.filter.state.opp_name.active\n                       }"></div><h5 class=panel-title>Opponent</h5></div><div class="panel-body row" ng-show=battles.filter.state.opp_name.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.opp_name.is><option value=true>is</option><option value=false>is not</option></select></div><div class=col-xs-9><select class="form-control multiple" ng-model=battles.filter.state.opp_name.value ng-options="o as o | capitalise for o in battles.opponents" multiple></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.opp_caster.active=!battles.filter.state.opp_caster.active" ng-class="{ \'active\': battles.filter.state.opp_caster.active\n                     }"><div class=icon-sprite ng-class="{ \'icon-checked\':battles.filter.state.opp_caster.active,\n                        \'icon-unchecked\':!battles.filter.state.opp_caster.active\n                        }"></div><h5 class=panel-title>Opponent Caster</h5></div><div class="panel-body row" ng-show=battles.filter.state.opp_caster.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.opp_caster.is><option value=true selected>is</option><option value=false>is not</option></select></div><div class=col-xs-9><select class=form-control ng-model=battles.filter.state.opp_caster.value.faction ng-options="f.key as f.name for f in factions"><option value="" ng-if=!battles.filter.state.opp_caster.value.faction>Please select</option></select></div><div class=col-xs-3></div><div class=col-xs-9><select class="form-control multiple" ng-model=battles.filter.state.opp_caster.value.caster ng-options="\n                  c.key as c.key|capitalise\n                  for c in factions\n                  | factions:\'castersFor\':battles.filter.state.opp_caster.value.faction" multiple></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.result.active=!battles.filter.state.result.active" ng-class="{\n           \'active\': battles.filter.state.result.active\n           }"><div class=icon-sprite ng-class="{\n              \'icon-checked\':battles.filter.state.result.active,\n              \'icon-unchecked\':!battles.filter.state.result.active\n              }"></div><h5 class=panel-title>Result</h5></div><div class="panel-body row" ng-show=battles.filter.state.result.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.result.is><option value=true>is</option><option value=false>is not</option></select></div><div class=col-xs-9><select class="form-control multiple" ng-model=battles.filter.state.result.value ng-options="\n                  id as s.type | capitalise\n                  group by s.result | capitalise\n                  for (id, s) in scores\n                  " multiple></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.scenario.active=!battles.filter.state.scenario.active" ng-class="{\n           \'active\': battles.filter.state.scenario.active\n           }"><div class=icon-sprite ng-class="{\n              \'icon-checked\':battles.filter.state.scenario.active,\n              \'icon-unchecked\':!battles.filter.state.scenario.active\n              }"></div><h5 class=panel-title>Scenario</h5></div><div class="panel-body row" ng-show=battles.filter.state.scenario.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.scenario.is><option value=true>is</option><option value=false>is not</option></select></div><div class=col-xs-9><select class="form-control multiple" ng-model=battles.filter.state.scenario.value ng-options="\n                  s.key as s.name\n                  for s in battles.scenarios\n                  " multiple></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.size.active=!battles.filter.state.size.active" ng-class="{\n           \'active\': battles.filter.state.size.active\n           }"><div class=icon-sprite ng-class="{\n              \'icon-checked\':battles.filter.state.size.active,\n              \'icon-unchecked\':!battles.filter.state.size.active\n              }"></div><h5 class=panel-title>Size</h5></div><div class="panel-body row" ng-show=battles.filter.state.size.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.size.is><option value="==">==</option><option value="!=">!=</option><option value=&gt;>&gt;</option><option value="&gt;=">&gt;=</option><option value="<">&lt;</option><option value="<=">&lt;=</option></select></div><div class=col-xs-9><input type=number class="form-control filter-input-3" style=max-width:6em ng-model="battles.filter.state.size.value"></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.event.active=!battles.filter.state.event.active" ng-class="{\n           \'active\': battles.filter.state.event.active\n           }"><div class=icon-sprite ng-class="{\n              \'icon-checked\':battles.filter.state.event.active,\n              \'icon-unchecked\':!battles.filter.state.event.active\n              }"></div><h5 class=panel-title>Event</h5></div><div class="panel-body row" ng-show=battles.filter.state.event.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.event.is><option value=true>is</option><option value=false>is not</option></select></div><div class=col-xs-9><select class="form-control multiple" ng-model=battles.filter.state.event.value ng-options="e for e in battles.events" multiple></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.initiative.active=!battles.filter.state.initiative.active" ng-class="{\n           \'active\': battles.filter.state.initiative.active\n           }"><div class=icon-sprite ng-class="{\n              \'icon-checked\':battles.filter.state.initiative.active,\n              \'icon-unchecked\':!battles.filter.state.initiative.active\n              }"></div><h5 class=panel-title>Initiative</h5></div><div class="panel-body row" ng-show=battles.filter.state.initiative.active><div class="col-xs-3 is"><select class=form-control ng-model=battles.filter.state.initiative.is><option value=true>is</option><option value=false>is not</option></select></div><div class=col-xs-4 style=padding-right:5px><select class=form-control ng-model=battles.filter.state.initiative.value.won_roll><option selected value=""></option><option selected value=true>Won roll</option><option selected value=false>Lost roll</option></select></div><div class=col-xs-5 style=padding-right:5px><select class=form-control ng-model=battles.filter.state.initiative.value.started><option selected value=""></option><option selected value=true>started game</option><option selected value=false>chose side</option></select></div></div></div><div class="panel panel-default"><div class=panel-heading ng-click="battles.filter.state.tags.active=!battles.filter.state.tags.active" ng-class="{\n           \'active\': battles.filter.state.tags.active\n           }"><div class=icon-sprite ng-class="{\n              \'icon-checked\':battles.filter.state.tags.active,\n              \'icon-unchecked\':!battles.filter.state.tags.active\n              }"></div><h5 class=panel-title>Tags</h5></div><div class="panel-body row" ng-show=battles.filter.state.tags.active><div class="col-xs-5 is"><select class=form-control ng-model=battles.filter.state.tags.is><option value=any>include any of</option><option value=all>include all of</option><option value=not_all>do not include all of</option><option value=none>include none of</option></select></div><div class=col-xs-7><select class="form-control multiple" ng-model=battles.filter.state.tags.value ng-options="t for t in battles.tags" multiple></select></div></div></div></form></div>'),a.put("partials/filter_menu.html",'<div><button class="btn btn-default" ng-click=doBack()><span>Back</span></button></div>'),a.put("partials/help.html","<div id=help class=container><h4>Table Of Contents</h4><ul><li><a ng-click=\"scrollTo('help-general')\">General</a></li><li><a ng-click=\"scrollTo('help-battle-list')\">Battle List</a></li><li><a ng-click=\"scrollTo('help-battle-view')\">Battle View</a></li><li><a ng-click=\"scrollTo('help-battle-edition')\">Battle Input</a></li><li><a ng-click=\"scrollTo('help-stats')\">Statistics</a></li><li><a ng-click=\"scrollTo('help-filter-edition')\">Filter Configuration</a></li><li><a ng-click=\"scrollTo('help-backup')\">Backup</a></li></ul><div ng-include=\"'partials/help/general.html'\"></div><div ng-include=\"'partials/help/battle_list.html'\"></div><div ng-include=\"'partials/help/battle_view.html'\"></div><div ng-include=\"'partials/help/battle_edition.html'\"></div><div ng-include=\"'partials/help/stats.html'\"></div><div ng-include=\"'partials/help/filter_edition.html'\"></div><div ng-include=\"'partials/help/backup.html'\"></div></div>"),a.put("partials/help/backup.html",'<div id=help-backup style=height:3em></div><div><h3>Backup</h3><img class="img-responsive img-thumbnail hidden-xs" src=data/sample/backup_lg.png style="max-height:400px"> <img class="img-responsive img-thumbnail visible-xs" src=data/sample/backup_sm.png style="max-height:400px"><h4>Where is your data ?</h4><p>The data representing your current battle list is stored <b>in your browser cache</b>.<br>This allows the app to "remember" your battles each time you visit the website.<br>Also, the app can work offline while you are not connected to the internet.<br><b>Your data is NOT stored in the webserver</b>, it is purely local to your device.<br></p><p>The app can be seen as a simple "battle editor".<br>Although it remembers your current battles between each session,<br>it can also open/save files containing all your battles data.<br>Those "backup files" are the primary backup mecanism for your battle list.</p><p>The app is also capable of synchronizing the current battle list<br>between to instances of the app running on to different devices<br>through the web server (of course you need to be online at that time).</p><p>It is recommended to regularly backup your data<br>since a lot of things can go wrong with a browser\'s cache :P</p><p><b>Note for IPhone users :</b> it is strongly recommended to backup your data before a firmware upgrade.</p><h4>Open / Save Backup files</h4><p>The app can be seen as a simple "battle editor", juste like any document editor.<br>You can open and save files to the local filesystem, containing your battles list.</p><p><b>Note for IPhone users :</b> the IPhone does not allow access to its filesystem from the browser.<br>Thus, you cannot Open / Save Backup files from your IPhone.<br>Instead, you can directly copy/paste the JSON text from/to the text inputs,<br>or Synchronize/Upload you IPhone data to a PC.</p><h5>Save file</h5><img class="img-responsive img-thumbnail" src="data/sample/backup_save.png"><p>This section allows you to save a file to the local filesystem, containing a battle list.<br>Click on the file link on the top right.<br>Your browser should open a file manager window to save the file.</p><p>You can also directly copy the JSON text in the text input bellow,<br>then save it somewhere convenient (emails, notes, whatever).</p><h5>Open file</h5><img class="img-responsive img-thumbnail" src="data/sample/backup_open.png"><p>This section allows you to open a file stored on the local filesystem, containing a battle list.<br>Click on the file selection input and choose a file.<br>The app should switch to the Battle List page after loading the new battles.</p><p>You can also directly paste the JSON string into the text input, then click "Read JSON".</p><p><b>Note :</b> if the file is not read correctly, an error message should appear besides the file selector input.<br><b>Note :</b> when you open a backup file, the current battle list is discarded, and all its data are lost !<br></p><h4>Synchronize</h4><p>The app is also capable of synchronizing the current battle list<br>between to instances of the app running on to different devices.<br></p><img class="img-responsive img-thumbnail" src="data/sample/sync.jpeg"><p>Basically, one device (say, a smartphone) can upload its battle list to the server.<br>Then another device (say, a PC) can download this battle list from the server.<br>Of cource, both devices need to visit the app webpage with a web browser :)</p><h5>Upload file</h5><img class="img-responsive img-thumbnail" src="data/sample/backup_upload.png"><p>This section allows you to upload your current battle list to the webserver.<br>Just click on the big nice button.</p><img class="img-responsive img-thumbnail" src="data/sample/backup_upload_ok.png"><p>A <b>Sync ID number</b> should appear when the upload is complete.<br>You\'ll need this Sync ID number to download your data on the other device.</p><p><b>Note :</b> data uploaded to the server is only stored temporarily.<br>The Sync ID number is only valid for a few hours after the upload.<br></p><h5>Download</h5><img class="img-responsive img-thumbnail" src="data/sample/backup_download.png"><p>This section allows you to download a battle list from the server.<br>Type the <b>Sync ID number</b> you got when uploading, then click on the button.<br>The app should switch to the Battle List page after loading the new battles.</p><p><b>Note :</b> if the ID is not correct, an error message should appear besides the input.<br><b>Note :</b> when you download a battle list, the current battle list is discarded, and all its data are lost !<br></p><h4>Import Iron Grudge data</h4><p>The app can import your Iron Grudge data so you don\'t lose your last 2 years of victories !<br>You can also see this app as just a glorified statistics viewer and continue to use Iron Grude.</p><p>The import process is a bit convoluted because the Iron Grudge backup file is a SQLite database.<br>And loading an SQLite data base file directly into a WebApp is not possible AFAIK.<br>So you\'ll need to convert your backup file to a Text-CSV file, before importing it into this app.</p><h5>Converting to CSV file</h5><p>First you need to get an SQLite Manager tool.<br>Personnally I use <a href="https://addons.mozilla.org/en-us/firefox/addon/sqlite-manager/">the Firefox SQLite Manager plugin</a>.</p><p>The plugin is available through Tools > SQLite Manager in FirefoxMenu.<br>In the Manager choose the menu Database > Connect database, choose your Iron Grudge backup file.<br>The tables for the backup file should appear in the tree view on the left.<br>In the panel on the right, choose the Execute SQL tab.<br>Paste the following SQL into the Enter SQL input :</p><code>SELECT battle.date, my_faction.name, my_caster.shortname, player.name, opp_faction.name, opp_caster.shortname, battle.result, battle.controlPoints, battle.armyPoints, battle.killPoints, battle.opponentControlPoints, battle.opponentArmyPoints, battle.opponentKillPoints, scenario.name, battle.points, event.name, battle.initiative, battle.comment FROM battle LEFT JOIN army my_army ON battle.armyId=my_army._id LEFT JOIN faction my_faction ON my_army.factionId=my_faction._id LEFT JOIN caster my_caster ON my_army.casterId=my_caster._id LEFT JOIN player ON battle.opponentId=player._id LEFT JOIN army opp_army ON battle.opponentArmyId=opp_army._id LEFT JOIN faction opp_faction ON opp_army.factionId=opp_faction._id LEFT JOIN caster opp_caster ON opp_army.casterId=opp_caster._id LEFT JOIN scenario ON battle.scenarioId=scenario._id LEFT JOIN event ON battle.eventId=event._id;</code><p>Click on Execute SQL.<br>You should see the following result :</p><img class="img-responsive img-thumbnail" src="data/sample/sqlite_import.png"><p>Click on Actions > Save Result (CSV) to file.<br>And save your CSV file !</p><h5>Import the CSV file</h5><img class="img-responsive img-thumbnail" src="data/sample/backup_import_ig.png"><p>Click on the file selection input and choose your Iron Grudge CSV file (see above).<br>You can also directly paste the CSV text in the input bellow.<br>The app should switch to the Battle List page after loading the new battles.</p><p><b>Note :</b> if the file is not read correctly, an error message should appear besides the file selector input.<br><b>Note :</b> when you import a CSV file, the current battle list is discarded, and all its data are lost !<br></p></div>'),a.put("partials/help/battle_edition.html",'<div id=help-battle-edition style=height:3em></div><div><h3>Battle Input</h3><img class="img-responsive img-thumbnail hidden-xs" src=data/sample/battle_edition_lg.png style="max-height:500px"><br><img class="img-responsive img-thumbnail visible-xs" src="data/sample/battle_edition_sm.png"><br><p>This page allows full modification of a battle information.</p><p><b>Tip :</b> You can get there by clicking on "Edit" button in the <a ng-click="scrollTo(\'help-battle-view\')">Battle View</a> page,<br>or by clicking the "Add Battle" in the <a ng-click="scrollTo(\'help-battle-list\')">Battle List</a> page.</p><p>Available actions :</p><dl class=dl-horizontal><dt><span class="glyphicon glyphicon-save"></span> Save</dt><dd>save/create battle and go back to <a ng-click="scrollTo(\'help-battle-list\')">Battle List</a> page.</dd><dt><span class="glyphicon glyphicon-remove"></span> Close</dt><dd>discard changes and go back to <a ng-click="scrollTo(\'help-battle-list\')">Battle List</a> page.</dd></dl><h5>User Lists</h5><p>When you see an input that looks like this :</p><img class="img-responsive img-thumbnail" src="data/sample/battle_edition_user_list.png"><br><p>it means the value can be selected amongst a list defined by the user (you).</p><p>The <span class="glyphicon glyphicon-plus"></span> button on left allows you to enter a new value for the list.</p><p>The dropbox list in the middle allows the selection of a previously defined value.</p><p>The <span class="glyphicon glyphicon-minus"></span> button on right allows you to delete the currently selected value from the list.</p><p><b>Note :</b> lists are computed from the current battle list.<br>This means that values that are no longer referenced by any battle<br>(either after a battle modification or deletion) will automatically be removed from the list</p><h5>Scenarios</h5><p>The scenario list automatically includes Steam Roller scenarios names</p><h5>Tags</h5><p>Tags are user-defined labels that can be attached to any battle.</p><p>The app extract all tags names from the current battle list, and can use them to filter or compute statistics.</p><h5>Comment</h5><p>Comment is for free text information.</p></div>'),a.put("partials/help/battle_list.html",'<div id=help-battle-list style=height:3em></div><div><h3>Battles List</h3><img class="img-responsive img-thumbnail hidden-xs" src=data/sample/battle_list_lg.png style="max-height:400px"> <img class="img-responsive img-thumbnail visible-xs" src=data/sample/battle_list_sm.png style="max-height:400px"><p>The battles list display all your recorded battles.</p><p><b>Tip :</b> You can get there by clicking on "Battle list" button in the Main Menu.</p><p>The last column display the result of the game :</p><dl class=dl-horizontal><dt>Red</dt><dd>Defeat</dd><dt>Yellow</dt><dd>Draw</dd><dt>Green</dt><dd>Victory</dd><dt>A</dt><dd>by assassination</dd><dt>S</dt><dd>by scenario</dd><dt>C</dt><dd>by clock</dd><dt>T</dt><dd>by tiebreaker</dd><p>Available actions :</p><dl class=dl-horizontal><dt>&lt;click on battle row&gt;</dt><dd>display/edit battle information.</dd><dt><span class="glyphicon glyphicon-plus"></span> Add Battle</dt><dd>enter new battle.</dd><dt><span class="glyphicon glyphicon-filter"></span> Filter</dt><dd>You can filter the displayed battles according to multiple settings.</dd><dt><span class="glyphicon glyphicon-sort"></span> Sort By</dt><dd>You can choose the sort settings for the displayed battles.</dd><dt><span class="glyphicon glyphicon-export"></span> Export</dt><dd>You can export the displayed battle list (ie after filtering and sorting) to various file formats.</dd></dl><h5>Filter Action</h5><img class="img-responsive img-thumbnail" src="data/sample/battle_list_filter.png"><dl class=dl-horizontal style=display:inline-block><dt><span class="glyphicon glyphicon-edit"></span> Edit</dt><dd>Brings you to the <a ng-click="scrollTo(\'help-filter-edition\')">Filter Configuration</a> page.</dd><dt><span class="glyphicon glyphicon-random"></span> Invert</dt><dd>display battles that do NOT match the current filter.</dd><dt><span class="glyphicon glyphicon-refresh"></span> Restore</dt><dd>undo "Invert" filter.</dd><dt><span class="glyphicon glyphicon-ok-circle"></span> Enable</dt><dd>activate filter.</dd><dt><span class="glyphicon glyphicon-ban-circle"></span> Disable</dt><dd>disactivate filter (current filter configuration is not lost, just disabled).</dd></dl><p>The filter button color change depending on the state of the filter :</p><dl class=dl-horizontal><dt>white</dt><dd>filter inactive</dd><dt>green</dt><dd>filter active</dd><dt>blue</dt><dd>filter active and inverted</dd><h5>Sort Action</h5><img class="img-responsive img-thumbnail" src="data/sample/battle_list_sort.png"><p>You can sort the displayed battle according to different criterions</p><p>The active sort is marked with a chevron <span class="glyphicon glyphicon-collapse-down"></span></p><p>The default sort is by "Date, descending" (newest battles at the top).</p><p><b>Tip :</b> You can revert the sort order by clicking on the active criterion. The chevron will change orientation.</p><dl class=dl-horizontal><dt><span class="glyphicon glyphicon-collapse-down"></span></dt><dd>sort ascending</dd><dt><span class="glyphicon glyphicon-collapse-up"></span></dt><dd>sort descending</dd><h5>Export Action</h5><img class="img-responsive img-thumbnail" src="data/sample/battle_list_export.png"><p>You can export the currently displayed battles to different file formats.</p><dl class=dl-horizontal><dt>BB Code</dt><dd>convert to internet forums table</dd><dt>CSV</dt><dd>Comma Separated Values text file, for use in spreadsheet editors</dd><dt>JSon</dt><dd>JSON text file, for use in other web applications</dd><p>The export take into account filtering and sorting, so you can export only the set of battles you want.</p><p><b>Note :</b> this is not the correct way to backup your battle list. Backup options are in the <a ng-click="scrollTo(\'help-backup\')">Backup</a> page.</p></dl></dl></dl></dl></div>'),a.put("partials/help/battle_view.html",'<div id=help-battle-view style=height:3em></div><div><h3>Battle View</h3><img class="img-responsive img-thumbnail hidden-xs" src="data/sample/battle_view_lg.png"><br><img class="img-responsive img-thumbnail visible-xs" src="data/sample/battle_view_sm.png"><br><p>This page displays detailed information about a battle.</p><p><b>Tip :</b> You can get there by clicking on a battle row in the <a ng-click="scrollTo(\'help-battle-list\')">Battle List</a> page.</p><p>Available actions :</p><dl class=dl-horizontal><dt><span class="glyphicon glyphicon-edit"></span> Edit</dt><dd>go to <a ng-click="scrollTo(\'help-battle-edition\')">Battle Input</a> page.</dd><dt><span class="glyphicon glyphicon-trash"></span> Delete</dt><dd>drop the battle from your battle list.</dd><dt><span class="glyphicon glyphicon-remove"></span> Close</dt><dd>go back to <a ng-click="scrollTo(\'help-battle-list\')">Battle List</a> page.</dd></dl></div>'),a.put("partials/help/filter_edition.html",'<div id=help-filter-edition style=height:3em></div><div><h3>Filter Configuration</h3><img class="img-responsive img-thumbnail" src="data/sample/filter_edition.png"><br><p>On this page you can see/edit your current filter settings.</p><p><b>Tip :</b> You can get there through "Filter" menus in the <a ng-click="scrollTo(\'help-battle-list\')">Battle List</a> and <a ng-click="scrollTo(\'help-stats\')">Statistics</a> pages.</p><p>A filter is composed of a list of <b>criterions</b>. Each criterion can be enabled/disabled indepently.<br>In the image above, the "My Caster" criterion is enabled, while all other criterions are disabled.<br>You can <b>enable/disable</b> criterion by <b>clicking on their label line</b>.</p><p>To match the filter, a battle must match <b>ALL</b> active criterions (logical AND).</p><p>Disabled criterions settings are not forgotten, they\'re just, well, disabled when matching battles.</p><p><b>Note :</b> the application remembers the filter state between sessions.</p><h5>Date</h5><img class="img-responsive img-thumbnail" src="data/sample/filter_edition_date.png"><br><p>You can see a select box for the matching criterion, and 3 input boxes for the reference date</p><p>You can filter battles by date relative to the reference date.<ul><li>superior (&gt;),</li><li>superior or equal (&gt;=),</li><li>equal (==),</li><li>not equal (!=),</li><li>inferior or equal (&lt;=),</li><li>inferior (&gt;)</li></ul></p><h5>My Caster / Opp. Caster</h5><img class="img-responsive img-thumbnail" src="data/sample/filter_edition_mycaster.png"><br><p>You can see a select box for the matching criterion, a select box for the faction, and a multiple selection for the caster.</p><p>You can filter battles by your army\'s / your opponent\'s faction / caster.<br>If multiple casters are selected, the filter will match <b>ANY</b> of these (logical OR).<br>If no caster is selected, the filter will match <b>the whole faction</b></p><p><b>Note :</b> the multiple selection for the caster is empty until a faction is selected.</p><h5>Opponent / Result / Scenario / Event</h5><img class="img-responsive img-thumbnail" src="data/sample/filter_edition_opponent.png"><br><p>For all those criterion, you see a select box for the matching criterion, and a multiple selection for the value.</p><p>You can filter battles by your opponent\'s name / the result / the scenario / the event.<br>If multiple values are selected, the filter will match <b>ANY</b> of these (logical OR).<br>If no value is selected, the filter will match any battle (ie, it\'s useless).</p><h5>Size</h5><img class="img-responsive img-thumbnail" src="data/sample/filter_edition_size.png"><br><p>You see a select box for the matching criterion, and an input for the reference size.</p><p>You can filter battles by game size relative to the reference size.<ul><li>superior (&gt;),</li><li>superior or equal (&gt;=),</li><li>equal (==),</li><li>not equal (!=),</li><li>inferior or equal (&lt;=),</li><li>inferior (&gt;)</li></ul></p><h5>Initiative</h5><img class="img-responsive img-thumbnail" src="data/sample/filter_edition_init.png"><br><p>You see a select box for the matching criterion, a select box for the starting roll, and a select box for the first player.</p><p>You can filter battles by intitiative.<br>When both values are selected, the filter match battles with the exact same initiative (logical AND).<br>If no starting roll is selected, the filter match battle with any starting roll, and the selected first player.<br>Idem for the first player.</p><h5>Tags</h5><img class="img-responsive img-thumbnail" src="data/sample/filter_edition_tags.png"><br><p>You see a select box for the matching criterion, and a multiple select box for the tag values.</p><p>You can filter battles by tags.<br><dl class=dl-horizontal><dt>include any of</dt><dd>the filter match battles that include <b>at least one</b> of the selected tags.</dd><dt>include all of</dt><dd>the filter match battles that include <b>all</b> the selected tags (they can include other tags).</dd><dt>do not include all of</dt><dd>the filter match battles that <b>do not</b> include <b>at least one</b> of the selected tags.</dd><dt>include none of</dt><dd>the filter match battles that <b>do not</b> include <b>any</b> of the selected tags.</dd></dl>(fun, right ?)</p></div>'),a.put("partials/help/general.html",'<div id=help-general style=height:3em></div><div><h3>General</h3><h4>Smartphone Installation</h4><p>The app can be installed to smartphones homescreens.<br>This allow the app to run fullscreen without the browser URL bar / menus.</p><a href="http://www.howtogeek.com/196087/how-to-add-websites-to-the-home-screen-on-any-smartphone-or-tablet/">How to add the app to your phone homescreen.</a><h4>Adaptive Display</h4><p>The app display change according to the screen size, button labels are removed on small screen, etc.</p><p>As much as possible, the version corresponding to the current screen size will be presented in this help page.</p><h4>Main Menu</h4><img class="img-responsive img-thumbnail hidden-xs" src="data/sample/main_menu_lg.png"><br><img class="img-responsive img-thumbnail visible-xs" src="data/sample/main_menu_sm.png"><p>The main menu gives you acces to the different parts of the application:</p><dl class=dl-horizontal><dt><span class="glyphicon glyphicon-list"></span> Battle List</dt><dd>the main battle list where you can Add/Edit/Delete/Sort/Export battles.</dd><dt><span class="glyphicon glyphicon-stats"></span> Statistics</dt><dd>the statistics module to compute and display all your results.</dd><dt><span class="glyphicon glyphicon-floppy-disk"></span> Backup</dt><dd>the page where you can save your battles list to a backup file, load previous backup files,<br>sync your battles to another device through the web, import your Iron Grudge Data.</dd><dt><span class="glyphicon glyphicon-question-sign"></span> Help</dt><dt><span class="glyphicon glyphicon-info-sign"></span> Info</dt><dd>legal info.</dd></dl><p>The number under the title is the app version number (here #test)</p><p><strong>Tip :</strong> you can force-reload the app by clicking on the title</p><h4>Bottom Bar</h4><img class="img-responsive img-thumbnail hidden-xs" src="data/sample/bottom_bar_lg.png"><br><img class="img-responsive img-thumbnail visible-xs" src="data/sample/bottom_bar_sm.png"><p>The bottom bar contains page-specific actions (here the battles list page actions).</p><p>When no actions are available for a page it is not displayed.</p></div>'),a.put("partials/help/stats.html",'<div id=help-stats style=height:3em></div><div><h3>Statistics</h3><img class="img-responsive img-thumbnail hidden-xs" src=data/sample/stats_pie_lg.png style="max-height:500px"><br><img class="img-responsive img-thumbnail visible-xs" src="data/sample/stats_sm.png"><br><p>This page allows visualization of battles statistics.</p><p><b>Tip :</b> You can get there by clicking on "Statistics" button in the Main Menu.</p><p>Available actions :</p><dl class=dl-horizontal><dt><span style=font-weight:bold>%</span> &lt;stats criterion&gt;</dt><dd>display the stats type. You can compute various statistics about your battles.</dd><dt><span class="glyphicon glyphicon-sort"></span> &lt;group by criterion&gt;</dt><dd>display the stats groups. You can group the computed statistics by various values.</dd><dt><span class="glyphicon glyphicon-filter"></span> Filter</dt><dd>You can filter the battles used for computing the stats, according to multiple settings.</dd></dl><h5>Statistics Type</h5><p>You can choose which statistic to compute from your battles.<br>Basically, the app is able to count (almost) each of the informations available for battles<br>The default type is "Result".</p><dl class=dl-horizontal><dt>Event</dt><dd>count references to each event (bar graph).</dd><dt>Initiative</dt><dd>count references to each initiative combination (pie chart).</dd><dt>My Caster/Opp. Caster</dt><dd>count references to each caster for all factions (bar graph).</dd><dt>My Faction/Opp. Faction</dt><dd>count references to each faction (bar graph).</dd><dt>Opp. Name</dt><dd>count references to each opponent name (bar graph).</dd><dt>Points</dt><dd>count the mean points scored by you and your opponents (balance graph).</dd><dt>Result</dt><dd>count your victories/defeats (pie chart).</dd><dt>Result Over Time</dt><dd>accumulate your victories/defeats over time (chart).</dd><dt>Scenario</dt><dd>count references to each scenario (bar graph).</dd><dt>Size</dt><dd>count references to each size (bar graph).</dd><dt>Tags</dt><dd>count references to each tag (bar graph).</dd></dl><h5>Statistics Group By</h5><p>You can choose to compute group statistics from your battles.<br>Basically, the app is able to group battles by (almost) each information available<br>The default group is "Total".</p><dl class=dl-horizontal><dt>Event</dt><dd>group battles by event.</dd><dt>Initiative</dt><dd>group battle by each initiative combination.</dd><dt>My Caster/Opp. Caster</dt><dd>group battles by each caster (you must first select a faction a the top of the page).</dd><dt>My Faction/Opp. Faction</dt><dd>group battles by faction.</dd><dt>Opp. Name</dt><dd>group battle by opponent name (bar graph).</dd><dt>Result</dt><dd>group battles by game result.</dd><dt>Scenario</dt><dd>group battles by scenario.</dd><dt>Size</dt><dd>group battles by game size.</dd><dt>Tags</dt><dd>group battles by tag reference.</dd><dt>Total</dt><dd>one group, all battles.</dd></dl><h5>Filter Action</h5><img class="img-responsive img-thumbnail" src="data/sample/battle_list_filter.png"><dl class=dl-horizontal style=display:inline-block><dt><span class="glyphicon glyphicon-edit"></span> Edit</dt><dd>Brings you to the <a ng-click="scrollTo(\'help-filter-edition\')">Filter Configuration</a> page.</dd><dt><span class="glyphicon glyphicon-random"></span> Invert</dt><dd>use battles that do NOT match the current filter.</dd><dt><span class="glyphicon glyphicon-refresh"></span> Restore</dt><dd>undo "Invert" filter.</dd><dt><span class="glyphicon glyphicon-ok-circle"></span> Enable</dt><dd>activate filter.</dd><dt><span class="glyphicon glyphicon-ban-circle"></span> Disable</dt><dd>disactivate filter (current filter configuration is not lost, just disabled).</dd></dl><p>The filter button color change depending on the state of the filter :</p><dl class=dl-horizontal><dt>white</dt><dd>filter inactive</dd><dt>green</dt><dd>filter active</dd><dt>blue</dt><dd>filter active and inverted</dd></dl></div>'),a.put("partials/info.html",'<div id=Info class=container><h3>Legal Information</h3><p>Images originating from the Privateer Press website are &copy; 2001-2014 Privateer Press, Inc. All Rights Reserved.</p><p>Privateer Press&reg;, WARMACHINE&reg;, Cryx&trade;, Cygnar&trade;, Khador&trade;, Protectorate of Menoth&trade;, Retribution of Scyrah&trade;, Convergence of Cyriss&trade;, Warcaster&trade;, HORDES&trade;, Circle Oroboros&trade;, Legion of Everblight&trade;, Skorne&trade;, TrollBloods&trade;, and their logos are trademarks of Privateer Press, Inc.</p><p>Images and trademarks used without permission</p><p>This application is unofficial and is not endorsed by Privateer Press</p><h3>License and Source code <img src="data/img/agplv3.png"></h3><p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.</p></div>'),a.put("partials/stats.html","<div id=stats class=container><form ng-if=\"state.selector==='my_caster' ||\n               state.selector==='opp_caster'\n               \"><select class=form-control ng-model=state.selector_arg ng-options=\"f.key as f.name for f in factions\" ng-change=state.doGenerate()><option value=\"\" ng-if=!state.selector_arg>Please select</option></select></form><div ng-if=\"\n       state.entry==='result' ||\n       state.entry==='initiative'\n       \"><div class=\"panel panel-info\" ng-repeat=\"s in stats[state.entry][state.selector+'.'+state.selector_arg]\"><div class=panel-heading><h4 class=panel-title>{{s.title}}</h4></div><div class=panel-body><pie-chart pie-values=s></pie-chart></div></div></div><div ng-if=\"state.entry==='result_time'\"><div class=\"panel panel-info\" ng-repeat=\"s in stats[state.entry][state.selector+'.'+state.selector_arg]\"><div class=panel-heading><h4 class=panel-title>{{s.title}}</h4></div><div class=panel-body><stack-graphs gph-values=s></stack-graphs></div></div></div><div ng-if=\"state.entry==='opp_name' ||\n              state.entry==='scenario' ||\n              state.entry==='event' ||\n              state.entry==='size' ||\n              state.entry==='tag'\n              \"><div class=\"panel panel-info\" ng-repeat=\"s in stats[state.entry][state.selector+'.'+state.selector_arg]\"><div class=panel-heading><h4 class=panel-title>{{s.title}}</h4></div><div class=panel-body><bars bars-values=s.values></bars></div></div></div><div ng-if=\"state.entry==='my_faction' ||\n              state.entry==='opp_faction'\n              \"><div class=\"panel panel-info\" ng-repeat=\"s in stats[state.entry][state.selector+'.'+state.selector_arg]\"><div class=panel-heading><h4 class=panel-title>{{s.title}}</h4></div><div class=panel-body><bars bars-values=s.values bars-hues=s.hues></bars></div></div></div><div ng-if=\"state.entry==='my_caster' ||\n              state.entry==='opp_caster'\n"+'              "><div class="panel panel-info" ng-repeat="s in stats[state.entry][state.selector+\'.\'+state.selector_arg]"><div class=panel-heading><h4 class=panel-title>{{s.title}}</h4></div><div class=panel-body><div ng-repeat="(f, v) in s.values"><strong>{{::f}}</strong><bars bars-values=v bars-hue={{::s.hues[f][0]}} bars-saturation={{::s.hues[f][1]}}></bars></div></div></div></div><div ng-if="state.entry===\'points\'"><div class="panel panel-info" ng-repeat="s in stats[state.entry][state.selector+\'.\'+state.selector_arg]"><div class=panel-heading><h4 class=panel-title>{{s.title}}</h4></div><div class=panel-body><stacks stacks-values=s></stacks></div></div></div></div>'),a.put("partials/stats_menu.html",'<div><div class="btn-group drop"><button class="btn btn-default" open-dropdown><span style=font-weight:bold>%</span> <span>{{ENTRIES[state.entry].desc}}</span></button><div class=drop-mask><ul class=drop-menu><li class=dropdown-header>Show</li><li ng-repeat="(id, e) in ::ENTRIES"><a ng-click=::doSetEntry(id)>{{::e.desc}}</a></li></ul></div></div><div class="btn-group drop"><button class="btn btn-default" open-dropdown><div class="icon-sprite icon-sort"></div><span>{{SELECTORS[state.selector].desc}}</span></button><div class=drop-mask><ul class=drop-menu><li class=dropdown-header>Sorted By</li><li ng-repeat="(id, s) in ::SELECTORS"><a ng-click=::doSetSelector(id)>{{::s.desc}}</a></li></ul></div></div><div class="btn-group drop"><button class=btn ng-class="{\n            \'btn-default\': !battles.filter.active,\n            \'btn-success\': battles.filter.active && !battles.filter.invert,\n            \'btn-primary\': battles.filter.active && battles.filter.invert\n            }" open-dropdown><div class="icon-sprite icon-filter"></div><span class=lbl>Filter</span></button><div class=drop-mask><ul class="drop-menu text-left"><li class=dropdown-header>Filter</li><li><a href=#/filter><div class="icon-sprite icon-edit"></div>Edit</a></li><li ng-show="battles.filter.active &&\n                     !battles.filter.invert\n                     "><a ng-click=doToggleFilterInvert()><div class="icon-sprite icon-invert"></div>Invert</a></li><li ng-show="battles.filter.active &&\n                     battles.filter.invert\n                     "><a ng-click=doToggleFilterInvert()><div class="icon-sprite icon-invert"></div>Restore</a></li><li ng-hide=battles.filter.active><a ng-click=doToggleFilterActive()><div class="icon-sprite icon-enable"></div>Enable</a></li><li ng-show=battles.filter.active><a ng-click=doToggleFilterActive()><div class="icon-sprite icon-disable"></div>Disable</a></li></ul></div></div></div>')
}]);