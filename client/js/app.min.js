angular.module("jlogApp.services",[]).value("version","0.1");angular.module("jlogApp.filters",[]);angular.module("jlogApp.controllers",[]);angular.module("jlogApp.directives",[]);
angular.module("jlogApp","ui.router pasvaz.bindonce jlogApp.controllers jlogApp.filters jlogApp.services jlogApp.directives".split(" ")).config(["$stateProvider","$urlRouterProvider",function(a,c){c.otherwise("/battle/list");a.state("battle",{url:"/battle",template:"<div ui-view></div>",controller:"listCtrl"}).state("battle.list",{url:"/list",templateUrl:"partials/battle_list.html"}).state("battle.view",{url:"/view",templateUrl:"partials/battle_view.html",controller:"listViewCtrl"}).state("battle.edit",
{url:"/edit",templateUrl:"partials/battle_edit.html",controller:"listEditCtrl"}).state("filter",{url:"/filter",templateUrl:"partials/filter.html"}).state("backup",{url:"/backup",templateUrl:"partials/backup.html",controller:"backupCtrl"}).state("stats",{url:"/stats",templateUrl:"partials/stats.html",controller:"statsCtrl"})}]).config(["$compileProvider",function(a){a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]);angular.module("jlogApp.controllers").controller("backupCtrl",["$scope","backup",function(a,c){console.log("init backupCtrl");a.backup=c;a.readBackupFile=function(b){a.backup.read(b,function(b){a.newBattles(b);c.generate(a.battles);a.$apply("backup.read_result = 'loaded file'")},function(b){a.$apply("backup.read_result = '"+b+"'")})};a.uploadData=function(){a.backup.upload(a.battles)};a.downloadData=function(){a.backup.download(function(b){a.newBattles(b.battles);c.generate(a.battles)},function(a){})};
c.generate(a.battles)}]);angular.module("jlogApp.controllers").controller("listCtrl",["$scope","$state","battle","selection",function(a,c,b,d){console.log("init listCtrl");a.show_list=!0;a.selection=d;a.addBattle=function(){a.battle_index=a.battles.length;a.battle=b.create();c.go("battle.edit")};a.viewBattle=function(b){a.battle_index=b;a.battle=a.battles[b];c.go("battle.view")};a.close=function(){a.show_list=!0;c.go("battle.list")};a.selectionRemove=function(){a.selection.remove(a.battles)&&a.updateBattles()};a.selectionSet=
function(b){a.selection.set(b,a.battles)&&a.updateBattles()};a.selectionUnset=function(b){a.selection.unset(b,a.battles)&&a.updateBattles()};a.$watch("filter_active",function(){a.list_display.reset(a.battles,a.filter,a.filter_active,a.filter_invert,a.sort)});a.$watch("filter_invert",function(){a.list_display.reset(a.battles,a.filter,a.filter_active,a.filter_invert,a.sort)});a.$watch("sort",function(){a.list_display.reset(a.battles,a.filter,a.filter_active,a.filter_invert,a.sort)},!0);a.$watch("list_display.sorted_battles|filter:{selected:true}",
function(a){d.update(a)},!0);a.selection.reset(a.battles)}]);angular.module("jlogApp.controllers").controller("listEditCtrl",["$scope","$state","$window","battle","opponents","events","scenarios","tags",function(a,c,b,d,k,e,p,n){console.log("init listEditCtrl "+a.battle_index);console.log(a.battle);void 0===a.battle&&c.go("battle.list");a.saveBattle=function(){a.battles.length>a.battle_index?a.battles[a.battle_index]=a.battle:a.battles.push(a.battle);a.updateBattles();a.close()};a.addOpponent=function(){var c=b.prompt("Enter new opponent name :"),c=null!=c?
c.trim().toLowerCase():"";0<c.length&&(a.opponents.push(c),a.opponents.sort(),k.store(a.opponents),a.battle.opponent.name=c)};a.addEvent=function(){var c=b.prompt("Enter new event name :"),c=null!=c?c.trim():"";0<c.length&&(a.events.push(c),a.events.sort(),e.store(a.events),a.battle.setup.event=c)};a.addScenario=function(){var c=b.prompt("Enter new scenario name :"),c=null!=c?c.trim():"",e=c.toLowerCase();0<c.length&&(a.scenarios[e]={name:c},p.store(a.scenarios),a.battle.setup.scenario=e)};a.addTag=
function(){var c=b.prompt("Enter new tag name :"),c=null!=c?c.trim():"";0<c.length&&(a.tags.push(c),a.tags.sort(),n.store(a.tags),a.battle.tags=angular.isArray(a.battle.tags)?a.battle.tags:[],a.battle.tags.push(c),a.battle.tags.sort())};var l=function(b,c,e){b=a[c].indexOf(b);0>b||(a[c].splice(b,1),e.store(a[c]))},q={opp:{get:function(a){return a.opponent.name},set:function(a,b){a.opponent.name=b},remove_from_list:function(a){l(a,"opponents",k)}},event:{list:"event",service:e,get:function(a){return a.setup.event},
set:function(a,b){a.setup.event=b},remove_from_list:function(a){l(a,"events",e)}},scenario:{get:function(a){return a.setup.scenario},set:function(a,b){a.setup.scenario=b},remove_from_list:function(b){a.scenarios.hasOwnProperty(b)&&(delete a.scenarios[b],p.store(a.scenarios))}}};a.del=function(c){if(q.hasOwnProperty(c)){var e=q[c].get,p=q[c].set,g=e(a.battle),g=null!=g?g:"";if(!(0>=g.length)&&b.confirm('Forget everything about "'+g+'" ?')){p(a.battle,null);var d;for(d=0;d<a.battles.length;d++)g===
e(a.battles[d])&&p(a.battles[d],null);a.updateBattles();q[c].remove_from_list(g)}}};a.delTag=function(){var c=a.battle.tags;if(angular.isArray(c)&&!(0>=c.length)){var e="Forget everything about these tags ?\r\n",p;for(p=0;p<c.length;p++)e+="\t"+c[p]+"\r\n";if(b.confirm(e)){a.battle.tags=[];var g,d,k;for(p=0;p<c.length;p++)for(d=c[p],g=0;g<a.battles.length;g++)if(k=a.battles[g],angular.isArray(k.tags))for(;0<=(e=k.tags.indexOf(d));)k.tags.splice(e,1);a.updateBattles();for(p=0;p<c.length;p++)for(;0<=
(e=a.tags.indexOf(c[p]));)a.tags.splice(e,1)}}};a.battle=angular.copy(a.battle)}]);angular.module("jlogApp.controllers").controller("listViewCtrl",["$scope","$state",function(a,c){console.log("init listViewCtrl "+a.battle_index);console.log(a.battle);void 0===a.battle&&c.go("battle.list");a.editBattle=function(){c.go("battle.edit")};a.deleteBattle=function(){window.confirm("You sure you wanna delete this battle ?")&&(a.battles.splice(a.battle_index,1),a.updateBattles(),a.close())}}]);angular.module("jlogApp.controllers").controller("mainCtrl",["$scope","factions","opponents","events","scenarios","tags","scores","battles","battle_sort","filter","stats","battle_list_display",function(a,c,b,d,k,e,p,n,l,q,h,f){console.log("init mainCtrl");a.collapse_navbar=!0;a.factions=c;a.scores=p;a.filter_active=!1;a.filter_invert=!1;a.filter=q.init();a.stats=h;a.list_display=f;a.sort=l();var s=function(){a.filter.clearCache();a.list_display.reset(a.battles,a.filter,a.filter_active,a.filter_invert,
a.sort);a.stats.reset()};a.updateBattles=function(){n.update(a.battles);s()};a.newBattles=function(c){a.battles=n.create(c);a.opponents=b.create(a.battles);a.events=d.create(a.battles);a.scenarios=k.create(a.battles)};a.battles=n.init();a.opponents=b.init(a.battles);a.events=d.init(a.battles);a.scenarios=k.init(a.battles);a.tags=e.init(a.battles);s();a.$watch("filter",function(){a.filter.clearCache();a.stats.filtered.reset();a.filter.update()},!0);a.$watch("filter_invert",function(){a.stats.filtered.reset()});
a.toggleFilter=function(){a.filter_active=!a.filter_active};a.invertFilter=function(){a.filter_invert=!a.filter_invert}}]);angular.module("jlogApp.controllers").controller("statsCtrl",["$scope","stats",function(a,c){console.log("init statsCtrl");a.stats.refresh(a.battles,a.filter);a.$watch("stats.show",function(){a.stats.refresh(a.battles,a.filter,a.filter_active,a.filter_invert)},!0);a.$watch("stats.percent",function(){a.stats.refresh(a.battles,a.filter,a.filter_active,a.filter_invert)});a.$watch("filter_active",function(){a.stats.refresh(a.battles,a.filter,a.filter_active,a.filter_invert)});a.$watch("filter_invert",
function(){a.stats.refresh(a.battles,a.filter,a.filter_active,a.filter_invert)})}]);angular.module("jlogApp.directives").directive("collapse",function(){return{restrict:"A",link:function(a,c,b){a.$watch(b.collapse,function(a){a?c.addClass("collapse"):c.removeClass("collapse")})}}});angular.module("jlogApp.directives").directive("exportLink",function(){return{restrict:"A",transclude:!0,scope:{name:"@",type:"@",source:"="},template:'  <a>   </a>   <a class="clickable"      ng-click="exportSource()"      ng-transclude>   </a> ',controller:["$scope",function(a){a.file_url=null;a.file_name=a.name+"."+a.type;a.exportSource=function(){var c=a.source["export"](a.type);console.log("generate "+a.type+" file");var b=a.file_url;a.file_url=null;null!==b&&URL.revokeObjectURL(b);c=new Blob([c],
{type:"text/plain"});window.URL=window.URL||window.webkitURL;c=window.URL.createObjectURL(c);a.file_url=c;a.file_name=a.name+"_"+(new Date).getTime()+"."+a.type;a.launchDownload()}}],link:function(a,c,b){var d=c.find("a")[0];a.launchDownload=function(){d.href=a.file_url;d.download=a.file_name;d.click()}}}});angular.module("jlogApp.directives").directive("sortable",function(){return{restrict:"A",transclude:!0,scope:{type:"@sortable",sort:"="},template:'<span class="clickable" ng-click="sort.sortBy(type)">  <span ng-transclude></span>  <span class="hidden-xs-inline" ng-show="sort.type === type">    <span ng-hide="sort.reverse"          class="glyphicon glyphicon-collapse-down"></span>    <span ng-show="sort.reverse"          class="glyphicon glyphicon-collapse-up"></span>  </span></span>',controller:["$scope",
function(a){}],link:function(a,c,b){}}});angular.module("jlogApp.directives").directive("statBar",function(){return{restrict:"A",scope:{statBar:"=",type:"@",percent:"="},template:'<div class="bar bar-win"      style="width:{{percent.win[type]}}%;">   {{statBar.win[type] ? statBar.win[type] : ""}} </div><div class="bar bar-draw"            style="width:{{percent.draw[type]}}%;">   {{statBar.draw[type] ? statBar.draw[type] : ""}} </div><div class="bar bar-loss"            style="width:{{percent.loss[type]}}%;">   {{statBar.loss[type] ? statBar.loss[type] : ""}} </div> '}});angular.module("jlogApp.directives").directive("whenScrolled",function(){return function(a,c,b){var d=c[0];angular.element(window).bind("scroll load",function(c){console.log("event fired: "+c.type);d.getBoundingClientRect().bottom===window.innerHeight&&a.$apply(b.whenScrolled)})}});angular.module("jlogApp.filters").filter("capitalise",[function(){return function(a){return"string"===typeof a?a.charAt(0).toUpperCase()+a.slice(1):a}}]);angular.module("jlogApp.filters").filter("filterBattle",[function(){return function(a,c,b,d){return b&&angular.isArray(a)?a.filter(function(a){return c.match(a,d)}):a}}]);angular.module("jlogApp.filters").filter("initiative",[function(){return function(a){if(!angular.isObject(a))return"nil";var c;c=""+("true"===a.won_roll?"Won roll, ":"Lost roll, ");return c+="true"===a.started?"started game":"chose side"}}]);angular.module("jlogApp.filters").filter("scoreResultColor",[function(){return function(a){return"string"!==typeof a?a:"victory"==a?"text-success":"defeat"==a?"text-danger":"text-warning"}}]).filter("scoreTypeLetter",[function(){return function(a){return"string"===typeof a?a.charAt(0).toUpperCase():a}}]);angular.module("jlogApp.services").factory("backup",["$http",function(a){return{read_result:null,save_url:null,save_name:"battle_list.txt",read:function(a,b,d){var k="function"===typeof b?b:function(a){console.log(a)},e="function"===typeof d?d:function(a){console.log(a)};this.read_result=null;b=new FileReader;b.onload=function(a){var b;try{b=JSON.parse(a.target.result),k(b)}catch(c){e("invalid file")}};b.onerror=function(a){e("error reading file")};b.onabort=function(a){e("abort reading file")};b.readAsText(a)},
generate:function(a){console.log("generate backup file");var b=this.save_url;this.save_url=null;null!==b&&URL.revokeObjectURL(b);a=JSON.stringify(a);a=new Blob([a],{type:"text/plain"});window.URL=window.URL||window.webkitURL;a=window.URL.createObjectURL(a);this.save_name="battle_list_"+(new Date).getTime()+".txt";this.save_url=a},upload:function(c){var b=this;b.upload_result="";b.download_result="";a.post("api/log",{battles:c}).success(function(a){b.upload_result="uploaded data";console.log(a);b.upload_id=
a.id}).error(function(){b.upload_result="upload failure"})},download:function(c,b){var d=this,k="function"===typeof c?c:function(a){console.log(a)},e="function"===typeof b?b:function(a){console.log(a)};d.upload_result="";d.download_result="";a.get("api/log/"+d.download_id).success(function(a){d.download_result="downloaded data";k(a)}).error(function(a){d.download_result="download failure";e(a)})}}}]);angular.module("jlogApp.services").service("battle",[function(){return{create:function(){var a=new Date;return{date:{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()},opponent:{name:null},setup:{event:null,scenario:null}}}}}]).service("battles",[function(){return{update:function(a){for(var c=0,c=0;c<a.length;c++)a[c].index=c;console.log("save battles in localStorage");localStorage.jlog_battles=JSON.stringify(a)},create:function(a){this.update(a);return a},init:function(){return"string"===
typeof localStorage.jlog_battles?(console.log("load battles from localStorage"),JSON.parse(localStorage.jlog_battles)):this.create([])}}}]);angular.module("jlogApp.services").service("battle_list_display",["filterBattleFilter","orderByFilter","sort_types",function(a,c,b){function d(){console.log("display_battle_list more");var a=this.sorted_battles.slice(this.last_index,this.last_index+this.slice);this.battles=this.battles.concat(a);this.last_index+=this.slice;this.more=this.last_index<this.sorted_battles.length}var k={battles:[],sorted_battles:[],slice:15,last_index:0,reset:function(e,p,k,l,q){this.battles=[];this.sorted_battles=[];
this.slice=15;this.last_index=0;this.more=!1;this.sorted_battles=a(e,p,k,l);this.sorted_battles=c(this.sorted_battles,b[q.type].key,q.reverse);d.call(this)},showMore:function(){console.log("display_battle_list showMore");this.more&&d.call(this)},"export":function(a){var b="";if(0>=k.sorted_battles.length)return b;var c=k.sorted_battles;switch(a){case "csv":a=[];var d=b,b=c[0],q=a,h,f="";for(h in b)if(b.hasOwnProperty(h)&&"$"!==h[0]){switch(h){case "my_army":f+="my_army_faction,";f+="my_army_caster,";
break;case "opponent":f+="opponent_name,";f+="opponent_faction,";f+="opponent_caster,";break;case "points":f+="my_scenario_points,";f+="my_army_points,";f+="opponent_scenario_points,";f+="opponent_army_points,";break;case "setup":f+="size,";f+="scenario,";f+="event,";f+="initiative,";break;case "initiative":f+="init_dice,";f+="init_start,";break;default:f+=h+","}q.push(h)}f=f.slice(0,f.length-1);b=d+(f+"\r\n");for(h=0;h<c.length;h++){for(var d=b,b=c[h],q=a,s=f=void 0,g="",s=0;s<q.length;s++){var f=
q[s],m=b[f];if(void 0!==m)switch(f){case "date":g+=m.year+"/"+m.month+"/"+m.day+",";break;case "opponent":g+=m.name+",";case "my_army":g+=m.faction+",";g+=m.caster+",";break;case "points":g+=m.my_army.scenario+",";g+=m.my_army.army+",";g+=m.opponent.scenario+",";g+=m.opponent.army+",";break;case "setup":g+=m.size+",";g+=m.scenario+",";g+=m.event+",";angular.isObject(m.initiative)?(g+=("true"===m.initiative.won_roll?"Won roll":"Lost roll")+" - ",g+=("true"===m.initiative.started?"Started game":"Chose side")+
","):g+=",";break;case "initiative":g+=m.dice+",";g+=m.start+",";break;default:g+=m+","}}g=g.slice(0,g.length-1);g+="\r\n";b=d+g}break;case "bb":a=[];h=b+"[table]\r\n";b=c[0];q=a;f="[tr]";for(d in b)if(b.hasOwnProperty(d)&&"$"!==d[0]){switch(d){case "my_army":f+="[th]my_army_faction[/th]";f+="[th]my_army_caster[/th]";break;case "opponent":f+="[th]opponent_name[/th]";f+="[th]opponent_faction[/th]";f+="[th]opponent_caster[/th]";break;case "points":f+="[th]my_scenario_points[/th]";f+="[th]my_army_points[/th]";
f+="[th]opponent_scenario_points[/th]";f+="[th]opponent_army_points[/th]";break;case "setup":f+="[th]size[/th]";f+="[th]scenario[/th]";f+="[th]event[/th]";f+="[th]initiative[/th]";break;case "initiative":f+="[th]init_dice[/th]";f+="[th]init_start[/th]";break;default:f+="[th]"+d+"[/th]"}q.push(d)}b=h+(f+"[/tr]\r\n");for(h=0;h<c.length;h++){d=b;b=c[h];q=a;s=f=void 0;g="[tr]";for(s=0;s<q.length;s++)if(f=q[s],m=b[f],void 0!==m)switch(f){case "date":g+="[td]"+m.year+"/"+m.month+"/"+m.day+"[/td]";break;
case "opponent":g+="[td]"+m.name+"[/td]";case "my_army":g+="[td]"+m.faction+"[/td]";g+="[td]"+m.caster+"[/td]";break;case "points":g+="[td]"+m.my_army.scenario+"[/td]";g+="[td]"+m.my_army.army+"[/td]";g+="[td]"+m.opponent.scenario+"[/td]";g+="[td]"+m.opponent.army+"[/td]";break;case "setup":g+="[td]"+m.size+"[/td]";g+="[td]"+m.scenario+"[/td]";g+="[td]"+m.event+"[/td]";angular.isObject(m.initiative)?(g+="[td]"+(m.initiative.won_roll?"Won roll":"Lost roll")+" - ",g+=(m.initiative.started?"Started game":
"Chose side")+"[/td]"):g+="[td][/td]";break;case "initiative":g+="[td]"+m.dice+"[/td]";g+="[td]"+m.start+"[/td]";break;default:g+="[td]"+m+"[/td]"}g+="[/tr]\r\n";b=d+g}b+="[/table]\r\n";break;case "json":b+=JSON.stringify(c);break;default:console.log("displayBattleListExport unknown format "+a)}console.log(b);return b}};return k}]);angular.module("jlogApp.services").service("events",[function(){var a=function(a){console.log("save events in localStorage");localStorage.jlog_events=JSON.stringify(a)};return{create:function(c){var b,d={},k,e=[];for(b=0;b<c.length;b++)d[c[b].setup.event]=!0;for(k in d)e.push(k);c=e.sort();a(c);return c},init:function(a){return"string"===typeof localStorage.jlog_events?(console.log("load events from localStorage"),JSON.parse(localStorage.jlog_events)):this.create(a)},store:a}}]);angular.module("jlogApp.services").value("factions",{cygnar:{name:"Cygnar",casters:{blaize:{name:"Constance Blaize,  Knight of the Prophet"},siege:{name:"Major Markus 'Siege' Brisbane"},caine1:{name:"Lieutenant Allister Caine"},caine2:{name:"Captain Allister Caine"},darius:{name:"Captain E. Dominic Darius"},haley1:{name:"Captain Victoria Haley"},haley2:{name:"Major Victoria Haley"},kraye:{name:"Captain Jeremiah Kraye"},nemo1:{name:"Commander Adept Sebastian Nemo"},nemo2:{name:"General Adept Sebastian Nemo"},
nemo3:{name:"Artificer General Nemo"},sloan:{name:"Captain Kara Sloan"},stryker1:{name:"Commander Coleman Stryker"},stryker2:{name:"Lord Commander Stryker"},sturgis1:{name:"Commander Dalin Sturgis"}},icon:"cygnar.png"},menoth:{name:"The Protectorate of Menoth",casters:{kreoss1:{name:"High Exemplar Kreoss"},kreoss2:{name:"Grand Exemplar Kreoss"},kreoss3:{name:"Intercessor Kreoss"},reclaimer:{name:"High Reclaimer"},testament:{name:"Testament of Menoth"},severius1:{name:"Grand Scrutator Severius"},severius2:{name:"Hierarch Severius"},
feora1:{name:"Feora,  Priestess of the Flame"},feora2:{name:"Feora,  Protector of the Flame"},amon:{name:"High Allegiant Amon Ad'Raza"},harbinger:{name:"Harbinger of Menoth"},reznik:{name:"High Executioner Servath Reznik"},vindictus:{name:"Vice Scrutator Vindictus"},thyra:{name:"Thyra,  Flame of Sorrow"}},icon:"menoth.png"},khador:{name:"Khador",casters:{butcher1:{name:"Orsus Zoktavir,  Butcher of Khardov"},butcher2:{name:"Kommander Orsus Zoktavir"},sorscha1:{name:"Kommander Sorscha Kratikoff"},sorscha2:{name:"Forward Kommander Sorscha Kratikoff"},
vlad1:{name:"Vladimir Tzepesci,  The Dark Prince"},vlad2:{name:"Vladimir Tzepesci,  The Dark Champion"},vlad3:{name:"Vladimir Tzepesci,  Great Prince of Umbrey"},irusk1:{name:"Kommandant Irusk"},irusk2:{name:"Supreme Kommandant Irusk"},zerkova:{name:"Koldun Kommander Aleksandra Zerkova"},karchev:{name:"Karchev the Terrible"},"the old witch":{name:"Zevanna Agha,  Old Witch of Khador"},strakhov:{name:"Kommander Strakhov"},harkevich:{name:"Kommander Harkevich,  The Iron Wolf"},butcher3:{name:"Kommander Zoktavir,  The Butcher Unleashed"}},
icon:"khador.png"},cryx:{name:"Cryx",casters:{asphyxious1:{name:"Iron Lich Asphyxious"},asphyxious2:{name:"Lich Lord Asphyxious"},asphyxious3:{name:"Asphyxious the Hellbringer"},deneghra1:{name:"War Witch Deneghra"},deneghra2:{name:"Wraith Witch Deneghra"},goreshade1:{name:"Goreshade the Bastard"},goreshade2:{name:"Goreshade the Cursed"},mortenebra:{name:"Master Necrotech Mortenebra"},scaverous:{name:"Lord Exhumator Scaverous"},skarre1:{name:"Skarre,  the Pirate Queen"},skarre2:{name:"Skarre,  Queen of the Broken Coast"},
terminus:{name:"Lich Lord Terminus"},venethrax:{name:"Lich Lord Venethrax"},"witch coven":{name:"The Witch Coven of Garlghast"},sturgis2:{name:"Sturgis the Corrupted"}},icon:"cryx.png"},scyrah:{name:"Retribution of Scyrah",casters:{garryth:{name:"Garryth,  Blade of Retribution"},kaelyssa:{name:"Kaelyssa,  Night's Whisper"},ossyan:{name:"Lord Arcanist Ossyan"},rahn:{name:"Adeptis Rahn"},ravyn:{name:"Ravyn,  Eternal Light"},vyros1:{name:"Dawnlord Vyros"},vyros2:{name:"Vyros,  Incissar of the Dawnguard"},
issyria:{name:"Issyria,  Sibyl of Dawn"}},icon:"scyrah.png"},highborn:{name:"Highborn Covenant",casters:{ashlynn:{name:"Ashlynn D'Elyse"},bartolo:{name:"Captain Bartolo Montador"},damiano:{name:"Captain Damiano"},blaize:{name:"Constance Blaize,  Knight of the Prophet"},macbain:{name:"Drake MacBain"},madhammer:{name:"Durgen Madhammer"},fiona:{name:"Fiona the Black"},ossrum:{name:"General Ossrum"},gorten:{name:"Gorten Grundback"}},icon:"mercs.png"},seaforge:{name:"Searforge Commission",casters:{madhammer:{name:"Durgen Madhammer"},
ossrum:{name:"General Ossrum"},gorten:{name:"Gorten Grundback"}},icon:"mercs.png"},talion:{name:"Talion Charter",casters:{bartolo:{name:"Captain Bartolo Montador"},fiona:{name:"Fiona the Black"},shae:{name:"Captain Phinneus Shae"}},icon:"mercs.png"},fourstar:{name:"Four Star Syndicate",casters:{bartolo:{name:"Captain Bartolo Montador"},damiano:{name:"Captain Damiano"},macbain:{name:"Drake MacBain"},madhammer:{name:"Durgen Madhammer"},ossrum:{name:"General Ossrum"},gorten:{name:"Gorten Grundback"},
fiona:{name:"Fiona the Black"},magnus1:{name:"Magnus the Traitor"},magnus2:{name:"Magnus the Warlord"}},icon:"mercs.png"},troll:{name:"Trollbloods",casters:{borka:{name:"Borka Kegslayer"},calandra:{name:"Calandra Truthsayer,  Oracle of the Glimmerwood"},grim1:{name:"Grim Angus"},grissel1:{name:"Grissel Bloodsong"},grissel2:{name:"Grissel Bloodsong,  Marshal of the Kriels"},gunnbjorn:{name:"Captain Gunnbjorn"},doomshaper1:{name:"Hoarluk Doomshaper,  Shaman of the Gnarls"},doomshaper2:{name:"Hoarluk Doomshaper,  Rage of Dhunia"},
jarl:{name:"Jarl Skuld,  Devil of the Thornwood"},madrak1:{name:"Chief Madrak Ironhide"},madrak2:{name:"Madrak Ironhide,  World Ender"},grim2:{name:"Hunters Grim"}},icon:"troll.png"},circle:{name:"Circle Orboros",casters:{baldur1:{name:"Baldur the Stonecleaver"},baldur2:{name:"Baldur the Stonesoul"},cassius:{name:"Cassius the Oathkeeper & Wurmwood,  Tree of Fate"},grayle:{name:"Grayle the Farstrider"},kaya1:{name:"Kaya the Wildborne"},kaya2:{name:"Kaya the Moonhunter and Laris"},kromac:{name:"Kromac the Ravenous"},
krueger1:{name:"Krueger the Stormwrath"},krueger2:{name:"Krueger the Stormlord"},mohsar:{name:"Mohsar the Desertwalker"},morvahna1:{name:"Morvahna the Autumnblade"},morvahna2:{name:"Morvahna the Dawnshadow"}},icon:"circle.png"},skorne:{name:"Skorne",casters:{hexeris1:{name:"Lord Tyrant Hexeris"},hexeris2:{name:"Lord Arbiter Hexeris"},makeda1:{name:"Archdomina Makeda"},makeda2:{name:"Supreme Archdomina Makeda"},mordikaar:{name:"Void Seer Mordikaar"},morghoul1:{name:"Master Tormentor Morghoul"},morghoul2:{name:"Lord Assassin Morghoul"},
naaresh:{name:"Master Ascetic Naaresh"},rasheth:{name:"Dominar Rasheth"},xerxis:{name:"Tyrant Xerxis"},zaal:{name:"Supreme Aptimus Zaal"},makeda3:{name:"Makeda & the Exalted Court"}},icon:"skorne.png"},loe:{name:"Legion of Everblight",casters:{absylonia:{name:"Absylonia,  Terror of Everblight"},bethayne:{name:"Bethayne,  Voice of Everblight"},kallus:{name:"Kallus,  Wrath of Everblight"},lylyth1:{name:"Lylyth,  Herald of Everblight"},lylyth2:{name:"Lylyth,  Shadow of Everblight"},rhyas:{name:"Rhyas,  Sigil of Everblight"},
saeryn:{name:"Saeryn,  Omen of Everblight"},thagrosh1:{name:"Thagrosh,  Prophet of Everblight"},thagrosh2:{name:"Thagrosh,  Messiah of Everblight"},vayl1:{name:"Vayl,  Disciple of Everblight"},vayl2:{name:"Vayl,  Consul of Everblight"},lylyth3:{name:"Lylyth,  Reckoning of Everblight"}},icon:"loe.png"},blindwater:{name:"Blindwater Congregation",casters:{barnabas:{name:"Bloody Barnabas"},calaban:{name:"Calaban the Gravewalker"},maelok:{name:"Maelok the Dreadbound"},rask:{name:"Rask"}},icon:"minions.png"},
thornfall:{name:"Thornfall Alliance",casters:{carver:{name:"Lord Carver,  BMMD,  Esq III"},arkadius:{name:"Dr. Arkadius"},"sturm & drang":{name:"Sturm & Drang"},midas:{name:"Midas"}},icon:"minions.png"},mercs:{name:"Mercenary Theme Forces",casters:{ashlynn:{name:"Ashlynn D'Elyse"},bartolo:{name:"Captain Bartolo Montador"},damiano:{name:"Captain Damiano"},shae:{name:"Captain Phinneus Shae"},macbain:{name:"Drake MacBain"},madhammer:{name:"Durgen Madhammer"},ossrum:{name:"General Ossrum"},gorten:{name:"Gorten Grundback"},
fiona:{name:"Fiona the Black"},magnus1:{name:"Magnus the Traitor"},magnus2:{name:"Magnus the Warlord"}},icon:"mercs.png"},minions:{name:"Minion Theme Forces",casters:{barnabas:{name:"Bloody Barnabas"},calaban:{name:"Calaban the Gravewalker"},arkadius:{name:"Dr. Arkadius"},carver:{name:"Lord Carver,  BMMD,  Esq III"},maelok:{name:"Maelok the Dreadbound"},"sturm & drang":{name:"Sturm & Drang"},rask:{name:"Rask"},midas:{name:"Midas"}},icon:"minions.png"},cyriss:{name:"Convergence of Cyriss",casters:{aurora:{name:"Aurora,  Numen of Aerogenesis"},
axis:{name:"Axis,  the Harmonic Enforcer"},directrix:{name:"Iron Mother Directrix & Exponent Servitors"},lucant:{name:"Father Lucant,  Divinity Architect"},syntherion:{name:"Forge Master Syntherion"}},icon:"cyriss.png"}});angular.module("jlogApp.services").factory("filter",[function(){var a=function(a){console.log("save filter in localStorage");localStorage.jlog_filter=JSON.stringify(a)},c=function(a,b){return 0===a?0===b:1===a?0!==b:2===a?-1===b:3===a?1!==b:4===a?1===b:5===a?-1!==b:!1},b=function(a,b){if(void 0===a.tags||!a.tags.active||0===a.tags.value.length)return!0;if(!angular.isArray(b.tags)||0===b.tags.length)return"none"===a.tags.is||"not_all"===a.tags.is;var c,d=!0,l=!1,q;for(c=0;c<a.tags.value.length;c++)q=
0<=b.tags.indexOf(a.tags.value[c]),d=d&&q,l=l||q;switch(a.tags.is){case "any":return l;case "all":return d;case "not_all":return!d;case "none":return!l;default:return!1}},d=function(){var a=new Date;return{date:{active:!1,is:"0",year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()},my_army:{active:!1,is:"true",faction:null,caster:[]},opp_name:{active:!1,is:"true",value:[]},opp_caster:{active:!1,is:"true",faction:null,caster:[]},result:{active:!1,is:"true",value:[]},scenario:{active:!1,is:"true",
name:[]},initiative:{active:!1,is:"true",won_roll:"",started:""},size:{active:!1,is:"0",value:50},event:{active:!1,is:"true",value:[]},tags:{active:!1,is:"any",value:[]}}};return{init:function(){var k={},e;"string"===typeof localStorage.jlog_filter?(console.log("load filter from localStorage"),e=JSON.parse(localStorage.jlog_filter)):(e=d(),a(e));e.match=function(a,e){if(!k.hasOwnProperty(a.index)){var d=k,q=a.index,h;h=this.date.year>a.date.year?1:this.date.year<this.date.year?-1:this.date.month>
a.date.month?1:this.date.month<a.date.month?-1:this.date.day>a.date.day?1:this.date.day<a.date.day?-1:0;var f=parseInt(this.date.is,10);h=c(f,h);if(h=!this.date.active||h)if(h=a.my_army.faction===this.my_army.faction&&(0==this.my_army.caster.length||0<=this.my_army.caster.indexOf(a.my_army.caster)),h=!this.my_army.active||("true"===this.my_army.is?h:!h))if(h=0==this.opp_name.value.length||0<=this.opp_name.value.indexOf(a.opponent.name),h=!this.opp_name.active||("true"===this.opp_name.is?h:!h))if(h=
a.opponent.faction===this.opp_caster.faction&&(0==this.opp_caster.caster.length||0<=this.opp_caster.caster.indexOf(a.opponent.caster)),h=!this.opp_caster.active||("true"===this.opp_caster.is?h:!h))if(h=0==this.result.value.length||0<=this.result.value.indexOf(a.score),h=!this.result.active||("true"===this.result.is?h:!h))if(h=0==this.scenario.name.length||0<=this.scenario.name.indexOf(a.setup.scenario),h=!this.scenario.active||("true"===this.scenario.is?h:!h))if(h=this.size.value>a.setup.size?1:this.size.value<
a.setup.size?-1:0,f=parseInt(this.size.is,10),h=c(f,h),h=!this.size.active||h)if(h=0==this.event.value.length||0<=this.event.value.indexOf(a.setup.event),h=!this.event.active||("true"===this.event.is?h:!h))h=angular.isObject(a.setup.initiative)&&(0==this.initiative.won_roll.length||this.initiative.won_roll===a.setup.initiative.won_roll)&&(0==this.initiative.started.length||this.initiative.started===a.setup.initiative.started),console.log(this.scenario.is+" "+h),h=(!this.initiative.active||("true"===
this.initiative.is?h:!h))&&b(this,a);d[q]=h;console.log("filter battle "+a.index+" "+k[a.index])}return e?!k[a.index]:k[a.index]};e.clearCache=function(a){console.log("filter clearCache "+a);void 0===a?k={}:delete k[a]};e.update=function(){a(this)};return e}}}]);angular.module("jlogApp.services").service("opponents",[function(){var a=function(a){console.log("save opponents in localStorage");localStorage.jlog_opponents=JSON.stringify(a)};return{create:function(c){var b,d,k,e={},p=[];for(b=0;b<c.length;b++)d=c[b],e[d.opponent.name]=!0;for(k in e)p.push(k);c=p.sort();a(c);return c},init:function(a){return"string"===typeof localStorage.jlog_opponents?(console.log("load opponents from localStorage"),JSON.parse(localStorage.jlog_opponents)):this.create(a)},store:a}}]);angular.module("jlogApp.services").value("default_scenarios",{sr14des:{name:"SR14 Destruction"},sr14sad:{name:"SR14 Supply & Demand"},sr14bop:{name:"SR14 Balance of Power"},sr14poe:{name:"SR14 Process of Elimination"},sr14cq:{name:"SR14 Close Quarters"},sr14tf:{name:"SR14 Two Fronts"},sr14inco:{name:"SR14 Incoming"},sr14rp:{name:"SR14 Rally Point"},sr14incu:{name:"SR14 Incursion"},sr14out:{name:"SR14 Outflank"},sr14itb:{name:"SR14 Into the Breach"},sr14fs:{name:"SR14 Fire Support"},sr13des:{name:"SR13 Destruction"},
sr13sad:{name:"SR13 Supply & Demand"},sr13cq:{name:"SR13 Close Quarters"},sr13ar:{name:"SR13 Ammunition Run"},sr13incu:{name:"SR13 Incursion"},sr13cr:{name:"SR13 Chemical Reaction"},sr13out:{name:"SR13 Outflank"},sr13inco:{name:"SR13 Incoming"},sr13itb:{name:"SR13 Into the Breach"},sr13rp:{name:"SR13 Rally Point"},sr13poe:{name:"SR13 Process of elimination"},sr13fs:{name:"SR13 Fire Support"}}).service("scenarios",["default_scenarios",function(a){var c=function(a){console.log("save scenarios in localStorage");
localStorage.jlog_scenarios=JSON.stringify(a)};return{create:function(b){var d;for(d=0;d<b.length;d++)void 0===a[b[d].setup.scenario]&&(a[b[d].setup.scenario]={name:b[d].setup.scenario});c(a);return a},init:function(a){return"string"===typeof localStorage.jlog_scenarios?(console.log("load scenarios from localStorage"),JSON.parse(localStorage.jlog_scenarios)):this.create(a)},store:c}}]);angular.module("jlogApp.services").value("scores",{va:{result:"victory",type:"assassination"},vc:{result:"victory",type:"clock"},vs:{result:"victory",type:"scenario"},dd:{result:"draw",type:"dice down"},da:{result:"defeat",type:"assassination"},dc:{result:"defeat",type:"clock"},ds:{result:"defeat",type:"scenario"}});angular.module("jlogApp.services").factory("selection",[function(){return{full:!1,toggleFull:function(a){var c;for(c=0;c<a.length;c++)a[c].selected=this.full},battles:[],my_army:{},opponent:{},setup:{},tags:[],points:{my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}},reset:function(a){this.full=!1;this.battles=[];this.my_army={};this.opponent={};this.setup={};this.tags=[];this.points={my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}};var c;for(c=0;c<a.length;c++)a[c].selected=
!1},remove:function(a){var c;this.battles.sort();for(c=0;c<this.battles.length;c++)a.splice(this.battles[this.battles.length-c-1],1);a=0<this.battles.length;this.battles=[];return a},update:function(a){this.battles=a.map(function(a){return a.index})},set:function(a,c){if(0===this.battles.length)return!1;var b=!1;switch(a){case "my_army":var d=!1;if("string"===typeof this.my_army.faction&&0<this.my_army.faction.length)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].my_army.faction=this.my_army.faction,
c[this.battles[b]].my_army.caster="";if("string"===typeof this.my_army.caster&&0<this.my_army.caster.length)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].my_army.caster=this.my_army.caster;b=d;break;case "opponent":d=!1;if("string"===typeof this.opponent.name&&0<this.opponent.name.length)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].opponent.name=this.opponent.name;if("string"===typeof this.opponent.faction&&0<this.opponent.faction.length)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].opponent.faction=
this.opponent.faction,c[this.battles[b]].opponent.caster="";if("string"===typeof this.opponent.caster&&0<this.opponent.caster.length)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].opponent.caster=this.opponent.caster;b=d;break;case "points":d=!1;for(b=0;b<this.battles.length;b++)void 0===c[this.battles[b]].points&&(c[this.battles[b]].points={my_army:{scenario:null,army:null},opponents:{scenario:null,army:null}}),void 0===c[this.battles[b]].points.my_army&&(c[this.battles[b]].points.my_army=
{scenario:null,army:null}),void 0===c[this.battles[b]].points.opponent&&(c[this.battles[b]].points.opponent={scenario:null,army:null});if("number"===typeof this.points.my_army.scenario)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].points.my_army.scenario=this.points.my_army.scenario;if("number"===typeof this.points.my_army.army)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].points.my_army.army=this.points.my_army.army;if("number"===typeof this.points.opponent.scenario)for(d=
!0,b=0;b<this.battles.length;b++)c[this.battles[b]].points.opponent.scenario=this.points.opponent.scenario;if("number"===typeof this.points.opponent.army)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].points.opponent.army=this.points.opponent.army;b=d;break;case "date":d=!1;for(b=0;b<this.battles.length;b++)void 0===c[this.battles[b]].date&&(c[this.battles[b]].date={year:2E3,month:1,day:1});if("number"===typeof this.date.year)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].date.year=
this.date.year;if("number"===typeof this.date.month)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].date.month=this.date.month;if("number"===typeof this.date.day)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].date.day=this.date.day;b=d;break;case "scenario":d=!1;for(b=0;b<this.battles.length;b++)void 0===c[this.battles[b]].setup&&(c[this.battles[b]].setup={scenario:null,event:null,size:null,initiative:{won_roll:null,started:null}});if("string"===typeof this.setup.scenario)for(d=
!0,b=0;b<this.battles.length;b++)c[this.battles[b]].setup.scenario=this.setup.scenario;b=d;break;case "size":d=!1;for(b=0;b<this.battles.length;b++)void 0===c[this.battles[b]].setup&&(c[this.battles[b]].setup={scenario:null,event:null,size:null,initiative:{won_roll:null,started:null}});if("number"===typeof this.setup.size)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].setup.size=this.setup.size;b=d;break;case "event":d=!1;for(b=0;b<this.battles.length;b++)void 0===c[this.battles[b]].setup&&
(c[this.battles[b]].setup={scenario:null,event:null,size:null,initiative:{won_roll:null,started:null}});if("string"===typeof this.setup.event)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].setup.event=this.setup.event;b=d;break;case "score":d=!1;if("string"===typeof this.score)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].score=this.score;b=d;break;case "tags":d=!1;if(0<this.tags.length)for(d=!0,b=0;b<this.battles.length;b++)c[this.battles[b]].tags=this.tags.slice(0);b=d;break;
case "addTags":d=!1;if(0<this.tags.length)for(d=!0,b=0;b<this.battles.length;b++){var k;for(k=0;k<this.tags.length;k++)void 0===c[this.battles[b]].tags&&(c[this.battles[b]].tags=[]),0>c[this.battles[b]].tags.indexOf(this.tags[k])&&c[this.battles[b]].tags.push(this.tags[k])}b=d}return b},unset:function(a,c){if(0===this.battles.length)return!1;var b=!1;switch(a){case "my_army":var b=!0,d;for(d=0;d<this.battles.length;d++)this.my_army.faction=null,this.my_army.caster=null,c[this.battles[d]].my_army.faction=
null,c[this.battles[d]].my_army.caster=null;break;case "opponent":b=!0;for(d=0;d<this.battles.length;d++)this.opponent.name=null,this.opponent.faction=null,this.opponent.caster=null,c[this.battles[d]].opponent.name=null,c[this.battles[d]].opponent.faction=null,c[this.battles[d]].opponent.caster=null;break;case "points":b=!0;for(d=0;d<this.battles.length;d++)this.points={my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}},c[this.battles[d]].points={my_army:{scenario:null,army:null},
opponent:{scenario:null,army:null}};break;case "date":b=!0;for(d=0;d<this.battles.length;d++)this.date={year:null,month:null,day:null},c[this.battles[d]].date={year:2E3,month:1,day:1};break;case "scenario":b=!0;for(d=0;d<this.battles.length;d++)this.setup.scenario=null,c[this.battles[d]].setup.scenario=null;break;case "size":b=!0;for(d=0;d<this.battles.length;d++)this.setup.size=null,c[this.battles[d]].setup.size=null;break;case "event":b=!0;for(d=0;d<this.battles.length;d++)this.setup.event=null,
c[this.battles[d]].setup.event=null;break;case "score":b=!0;for(d=0;d<this.battles.length;d++)this.score=null,c[this.battles[d]].score=null;break;case "tags":b=!0;for(d=0;d<this.battles.length;d++)this.tags=[],c[this.battles[d]].tags=[];break;case "addTags":for(b=!0,d=0;d<this.battles.length;d++){var k;for(k=0;k<this.tags.length;k++){var e=c[this.battles[d]].tags.indexOf(this.tags[k]);0<=e&&c[this.battles[d]].tags.splice(e,1)}}}return b}}}]);angular.module("jlogApp.services").value("sort_types",{date:{name:"Date",key:["date.year","date.month","date.day","index"]},my_caster:{name:"My caster",key:["my_army.faction","my_army.caster","index"]},opponent:{name:"Opponent",key:["opponent.name","index"]},opp_caster:{name:"Opp. caster",key:["opponent.faction","opponent.caster","index"]},scenario:{name:"Scenario",key:["setup.scenario","index"]},size:{name:"Size",key:["setup.size","index"]},event:{name:"Event",key:["setup.event","index"]},result:{name:"Result",
key:["score","index"]}}).factory("battle_sort",["sort_types",function(a){return function(){return{types:a,type:"date",reverse:!0,sortBy:function(a){this.type===a?this.reverse=!this.reverse:(this.type=a,this.reverse=!1)}}}}]);angular.module("jlogApp.services").factory("statEntry",[function(){return function(){return{win:{total:0,assassination:0,scenario:0,clock:0},draw:{total:0,assassination:0,scenario:0,clock:0},loss:{total:0,assassination:0,scenario:0,clock:0},toPercent:function(){var a=this.win.total+this.draw.total+this.loss.total,c=this.win.assassination+this.draw.assassination+this.loss.assassination,b=this.win.scenario+this.draw.scenario+this.loss.scenario,d=this.win.clock+this.draw.clock+this.loss.clock,k={total:100*
this.win.total/a>>0,assassination:100*this.win.assassination/c>>0,scenario:100*this.win.scenario/b>>0,clock:100*this.win.clock/d>>0},e={total:100*this.draw.total/a>>0,assassination:100*this.draw.assassination/c>>0,scenario:100*this.draw.scenario/b>>0,clock:100*this.draw.clock/d>>0};return{win:k,draw:e,loss:{total:0===a?0:100-k.total-e.total,assassination:0===c?0:100-k.assassination-e.assassination,scenario:0===b?0:100-k.scenario-e.assassination,clock:0===d?0:100-k.clock-e.clock}}},add:function(a){switch(a){case "va":this.win.assassination++;
this.win.total++;break;case "vc":this.win.clock++;this.win.total++;break;case "vs":this.win.scenario++;this.win.total++;break;case "dd":this.draw.clock++;this.draw.total++;break;case "da":this.loss.assassination++;this.loss.total++;break;case "dc":this.loss.clock++;this.loss.total++;break;case "ds":this.loss.scenario++,this.loss.total++}}}}}]).factory("statCollection",["statEntry",function(a){function c(){}function b(b){void 0===this.all.win&&(this.all=a());this.all.add(b.score)}function d(b){var c=
b.my_army.faction;void 0===this.my_army.faction[c]&&(this.my_army.faction[c]=a());this.my_army.faction[c].add(b.score)}function k(b){var c=b.my_army.faction,e=b.my_army.caster;void 0===this.my_army.caster[e]&&(this.my_army.caster[e]=a(),this.my_army.caster[e].faction=c);this.my_army.caster[e].add(b.score)}function e(b){var c=b.opponent.name;void 0===this.opponent.name[c]&&(this.opponent.name[c]=a());this.opponent.name[c].add(b.score)}function p(b){var c=b.opponent.faction;void 0===this.opponent.faction[c]&&
(this.opponent.faction[c]=a());this.opponent.faction[c].add(b.score)}function n(b){var c=b.opponent.faction,e=b.opponent.caster;void 0===this.opponent.caster[e]&&(this.opponent.caster[e]=a(),this.opponent.caster[e].faction=c);this.opponent.caster[e].add(b.score)}function l(b){var c=b.setup.scenario;void 0===this.scenario[c]&&(this.scenario[c]=a());this.scenario[c].add(b.score)}function q(b){var c=b.setup.initiative;void 0===this.initiative["Roll won"]&&(this.initiative["Roll won"]=a());void 0===this.initiative["Roll lost"]&&
(this.initiative["Roll lost"]=a());void 0===this.initiative["Started first"]&&(this.initiative["Started first"]=a());void 0===this.initiative["Started second"]&&(this.initiative["Started second"]=a());void 0!==c&&(this.initiative["false"===c.won_roll?"Roll lost":"Roll won"].add(b.score),this.initiative["false"===c.started?"Started first":"Started second"].add(b.score))}function h(b){var c=b.setup.event;void 0===this.event[c]&&(this.event[c]=a());this.event[c].add(b.score)}function f(a){for(var b in a)if(a.hasOwnProperty(b))return!1;
return!0}return function(){return{all:{},my_army:{caster:{},faction:{}},opponent:{name:{},faction:{},caster:{}},event:{},scenario:{},initiative:{},reset:function(){this.all={};this.my_army={caster:{},faction:{}};this.opponent={name:{},faction:{},caster:{}};this.event={};this.scenario={};this.initiative={}},toPercent:function(){var a={all:"function"===typeof this.all.toPercent?this.all.toPercent():{},my_army:{caster:{},faction:{}},opponent:{name:{},faction:{},caster:{}},event:{},scenario:{},initiative:{}},
b;for(b in this.my_army.faction)this.my_army.faction.hasOwnProperty(b)&&(a.my_army.faction[b]=this.my_army.faction[b].toPercent());for(b in this.my_army.caster)this.my_army.caster.hasOwnProperty(b)&&(a.my_army.caster[b]=this.my_army.caster[b].toPercent(),a.my_army.caster[b].faction=this.my_army.caster[b].faction);for(b in this.opponent.name)this.opponent.name.hasOwnProperty(b)&&(a.opponent.name[b]=this.opponent.name[b].toPercent());for(b in this.opponent.faction)this.opponent.faction.hasOwnProperty(b)&&
(a.opponent.faction[b]=this.opponent.faction[b].toPercent());for(b in this.opponent.caster)this.opponent.caster.hasOwnProperty(b)&&(a.opponent.caster[b]=this.opponent.caster[b].toPercent(),a.opponent.caster[b].faction=this.opponent.caster[b].faction);for(b in this.event)this.event.hasOwnProperty(b)&&(a.event[b]=this.event[b].toPercent());for(b in this.scenario)this.scenario.hasOwnProperty(b)&&(a.scenario[b]=this.scenario[b].toPercent());for(b in this.initiative)this.initiative.hasOwnProperty(b)&&
(a.initiative[b]=this.initiative[b].toPercent());return a},refresh:function(a,g,m,r){var t;this.refreshAll=r.all&&void 0===this.all.win?b:c;this.refreshMyFaction=r.my_army.faction&&f(this.my_army.faction)?d:c;this.refreshMyCaster=r.my_army.caster&&f(this.my_army.caster)?k:c;this.refreshOppName=r.opponent.name&&f(this.opponent.name)?e:c;this.refreshOppFaction=r.opponent.faction&&f(this.opponent.faction)?p:c;this.refreshOppCaster=r.opponent.caster&&f(this.opponent.caster)?n:c;this.refreshScenario=r.scenario&&
f(this.scenario)?l:c;this.refreshEvent=r.event&&f(this.event)?h:c;this.refreshInitiative=r.initiative&&f(this.initiative)?q:c;for(t=0;t<a.length;t++)r=a[t],g.match(r,m)&&(this.refreshAll(r),this.refreshMyFaction(r),this.refreshMyCaster(r),this.refreshOppName(r),this.refreshOppFaction(r),this.refreshOppCaster(r),this.refreshScenario(r),this.refreshInitiative(r),this.refreshEvent(r))}}}}]).factory("stats",["statCollection",function(a){function c(a,b){var c;c=a+(","+b.win.total);c+=","+b.draw.total;
c+=","+b.loss.total;c+=","+b.win.assassination;c+=","+b.draw.assassination;c+=","+b.loss.assassination;c+=","+b.win.scenario;c+=","+b.draw.scenario;c+=","+b.loss.scenario;c+=","+b.win.clock;c+=","+b.draw.clock;c+=","+b.loss.clock;return c+="\r\n"}function b(a,b){var c;c="[tr]"+("[td colspan=2]"+a+"[/td]")+("[td]"+b.win.total+"[/td]");c+="[td]"+b.draw.total+"[/td]";c+="[td]"+b.loss.total+"[/td]";c+="[td]"+b.win.assassination+"[/td]";c+="[td]"+b.draw.assassination+"[/td]";c+="[td]"+b.loss.assassination+
"[/td]";c+="[td]"+b.win.scenario+"[/td]";c+="[td]"+b.draw.scenario+"[/td]";c+="[td]"+b.loss.scenario+"[/td]";c+="[td]"+b.win.clock+"[/td]";c+="[td]"+b.draw.clock+"[/td]";c+="[td]"+b.loss.clock+"[/td]";return c+="[/tr]\r\n"}var d={match:function(){return!0}};return{show:{all:!1,my_army:{caster:!1,faction:!1,casters:{},factions:{}},opponent:{name:!1,caster:!1,faction:!1,names:{},casters:{},factions:{}},event:!1,events:{},scenario:!1,scenarios:{},initiative:!1,initiatives:{}},percent:!1,raw:a(),filtered:a(),
reset:function(){this.raw.reset();this.filtered.reset()},refresh:function(a,b,c,n){var l=c?this.filtered:this.raw;l.refresh(a,c?b:d,n,this.show);l.percent=l.toPercent();this.active_percent=l.percent;this.active=this.percent?l.percent:l},"export":function(a){var e="",d=this.active;switch(a){case "csv":var n=e;a=this.show;e="type,win total,draw total";e+=",loss total";e+=",win assassination";e+=",draw assassination";e+=",loss assassination";e+=",win scenario";e+=",draw scenario";e+=",loss scenario";
e+=",win clock";e+=",draw clock";e+=",loss clock";e+="\r\n";e=""+e;a.all&&(e+=c("all",d.all));var l;if(a.my_army.faction)for(l in d.my_army.faction)e+=c(l,d.my_army.faction[l]);if(a.my_army.caster)for(l in d.my_army.caster)e+=c(l,d.my_army.caster[l]);if(a.opponent.name)for(l in d.opponent.name)e+=c(l,d.opponent.name[l]);if(a.opponent.faction)for(l in d.opponent.faction)e+=c(l,d.opponent.faction[l]);if(a.opponent.caster)for(l in d.opponent.caster)e+=c(l,d.opponent.caster[l]);if(a.scenario)for(l in d.scenario)e+=
c(l,d.scenario[l]);if(a.initiative)for(l in d.initiative)e+=c(l,d.initiative[l]);if(a.event)for(l in d.event)e+=c(l,d.event[l]);e=n+e;break;case "bb":l=e;a=this.show;e="[tr][th][/th][th]win\r\ntotal[/th]";e+="[th]draw\r\ntotal[/th]";e+="[th]loss\r\ntotal[/th]";e+="[th]win\r\nassassination[/th]";e+="[th]draw\r\nassassination[/th]";e+="[th]loss\r\nassassination[/th]";e+="[th]win\r\nscenario[/th]";e+="[th]draw\r\nscenario[/th]";e+="[th]loss\r\nscenario[/th]";e+="[th]win\r\nclock[/th]";e+="[th]draw\r\nclock[/th]";
e+="[th]loss\r\nclock[/th]";e+="[/tr]\r\n";e="[table]\r\n"+e;a.all&&(e+=b("all",d.all));if(a.my_army.faction)for(n in d.my_army.faction)e+=b(n,d.my_army.faction[n]);if(a.my_army.caster)for(n in d.my_army.caster)e+=b(n,d.my_army.caster[n]);if(a.opponent.name)for(n in d.opponent.name)e+=b(n,d.opponent.name[n]);if(a.opponent.faction)for(n in d.opponent.faction)e+=b(n,d.opponent.faction[n]);if(a.opponent.caster)for(n in d.opponent.caster)e+=b(n,d.opponent.caster[n]);if(a.scenario)for(n in d.scenario)e+=
b(n,d.scenario[n]);if(a.initiative)for(n in d.initiative)e+=b(n,d.initiative[n]);if(a.event)for(n in d.event)e+=b(n,d.event[n]);e=l+(e+"[/table]\r\n");break;case "json":e+=JSON.stringify(d);break;default:console.log("displayBattleListExport unknown format "+a)}console.log(e);return e}}}]);angular.module("jlogApp.services").service("tags",[function(){var a=function(a){console.log("save tags in localStorage");localStorage.jlog_tags=JSON.stringify(a)};return{create:function(c){var b,d,k={},e=[];for(b=0;b<c.length;b++)if(angular.isArray(c[b].tags))for(d=0;d<c[b].tags.length;d++)k[c[b].tags[d]]=!0;for(tag in k)e.push(tag);c=e.sort();a(c);return c},init:function(a){return"string"===typeof localStorage.jlog_tags?(console.log("load tags from localStorage"),JSON.parse(localStorage.jlog_tags).sort()):
this.create(a)},store:a}}]);
