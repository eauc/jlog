"use strict";angular.module("jlogApp.services",[]),angular.module("jlogApp.filters",[]),angular.module("jlogApp.controllers",[]),angular.module("jlogApp.directives",[]),angular.module("jlogApp",["ui.router","jlogApp.controllers","jlogApp.filters","jlogApp.services","jlogApp.directives"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/battle"),a.state("battle",{url:"/battle",views:{"page@":{templateUrl:"partials/battle_list.html",controller:"listCtrl"},"bottom-bar@":{templateUrl:"partials/battle_list_menu.html",controller:"listBottomCtrl"}},data:{}}).state("battle.view",{url:"/view/:index",views:{"page@":{templateUrl:"partials/battle_view.html",controller:"listViewCtrl"},"bottom-bar@":{templateUrl:"partials/battle_view_menu.html",controller:"listViewBottomCtrl"}},data:{}}).state("battle.edit",{url:"/edit/:index",views:{"page@":{templateUrl:"partials/battle_edit.html",controller:"listEditCtrl"},"bottom-bar@":{templateUrl:"partials/battle_edit_menu.html",controller:"listEditBottomCtrl"}},data:{}}).state("info",{url:"/info",views:{page:{templateUrl:"partials/info.html"}}})}]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]),angular.module("jlogApp.controllers").controller("backupCtrl",["$scope","backup","battles","storage",function(a,b,c,d){a.bottom_bar.show=!1,a.backup=b,a.readBackupFile=function(c){a.backup.read(c,function(c){d.clearJLogKeys(),a.$emit("newBattles",c),b.generate(a.battles.list),a.$apply("backup.read_result = 'loaded file'")},function(b){a.$apply("backup.read_result = '"+b+"'")})},a.uploadData=function(){b.upload(c.list)},a.downloadData=function(){!_.isString(b.download.id)||0>=b.download.id.length||b.download().then(function(c){d.clearJLogKeys(),a.$emit("newBattles",c),b.generate(a.battles.list)})},a.onClearStorage=function(){d.clearJLogKeys()},b.statusReset(),b.generate(a.battles.list)}]),angular.module("jlogApp.controllers").controller("filterEditCtrl",["$scope","filter",function(a,b){a.bottom_bar.show=!0,a.$watch("filter",function(){b.clearCache(),b.update()},!0)}]).controller("filterEditBottomCtrl",["$scope","$state",function(a,b){a.onBack=function(){b.go(a.filter_state.previous)}}]),angular.module("jlogApp.controllers").controller("listCtrl",["$scope",function(a){a.doViewBattle=function(b){a.stateGo("battle.view",{index:b})}}]).controller("listBottomCtrl",["$scope","battles",function(a,b){a.doAddBattle=function(){a.stateGo("battle.edit",{index:a.battles.display_list.length})},a.doSortBy=function(c){a.battles.sort=b.updateSortBy(a.sort_types,a.battles.sort,c),a.updateBattles()}}]),angular.module("jlogApp.controllers").controller("listEditCtrl",["$scope","$state","$stateParams","$window","battle","events","opponents","scenarios","tags",function(a,b,c,d,e,f,g,h,i){var j=parseFloat(c.index);a.battle=j<a.battles.display_list.length?_.snapshot(a.battles.display_list[j]):e.create({index:j}),b.current.data.index=j,b.current.data.battle=a.battle,b.current.data.save_enable=!1,a.$watch("battle_edit.$valid",function(a){b.current.data.save_enable=a});var k={opponent:g,event:f,scenario:h},l={opponent:["opponent","name"],event:["setup","event"],scenario:["setup","scenario"]};a.doAdd=function(c){var e=d.prompt("Enter new "+c+" name :");_.exists(e)&&(e=s(e).clean().toLowerCase().value(),s.isBlank(e)||(a.battles[c+"s"]=k[c].add(a.battles[c+"s"],e),a.battle=_.setPath(a.battle,e,l[c],{}),b.current.data.battle=a.battle))},a.doDelete=function(c){var e=_.getPath(a.battle,l[c]);if(_.exists(e)){var f=d.confirm("All references to "+e+" will be deleted.");f&&(a.battles[c+"s"]=k[c].drop(a.battles[c+"s"],e),a.battle=_.setPath(a.battle,null,l[c],{}),b.current.data.battle=a.battle)}},a.doAddTag=function(){var c=d.prompt("Enter new tag name :");_.exists(c)&&(c=s(c).clean().toLowerCase().value(),s.isBlank(c)||(a.battles.tags=i.add(a.battles.tags,c),a.battle=e.addTag(a.battle,c),b.current.data.battle=a.battle))},a.doDeleteTag=function(){var b=a.battle.tags;if(!_.isEmpty(b)){var c=d.confirm("All references to "+b.join(",")+" will be deleted.");c&&(a.battles.tags=i.drop(a.battles.tags,b),a.battle.tags=[])}}}]).controller("listEditBottomCtrl",["$scope","$state","battles",function(a,b,c){a.state=b.current.data,a.doSave=function(){a.setBattles(c.save(a.battles.display_list,b.current.data.index,b.current.data.battle)),a.doClose()},a.doClose=function(){a.stateGo("battle")}}]),angular.module("jlogApp.controllers").controller("listViewCtrl",["$scope","$stateParams",function(a,b){a.battle=a.battles.display_list[b.index]}]).controller("listViewBottomCtrl",["$scope","$stateParams","$window","battles",function(a,b,c,d){a.doEditBattle=function(){a.stateGo("battle.edit",{index:b.index})},a.doDeleteBattle=function(){var e=c.confirm("You sure you wanna delete this battle ?");e&&(a.setBattles(d.drop(a.battles.display_list,parseFloat(b.index))),a.doClose())},a.doClose=function(){a.stateGo("battle")}}]),angular.module("jlogApp.controllers").controller("mainCtrl",["$scope","$state","$q","scores","factions","scenarios","battles","events","opponents","tags",function(a,b,c,d,e,f,g,h,i,j){a.stateIs=_.bind(b.is,b),a.stateGo=_.bind(b.go,b),a.battles={list:[],display_list:[],events:[],opponents:[],scenarios:[],tags:[],sort:{type:"date",reverse:!0}},a.updateBattles=function(){a.battles.display_list=g.sort(a.battles.list,a.sort_types,a.battles.sort.type,a.battles.sort.reverse)},a.setBattles=function(b){a.battles.list=g.buildIndex(b),a.updateBattles()},c.when(d.data()).then(function(b){return a.scores=b,c.when(e.data())}).then(function(b){return a.factions=b,c.when(f.data())}).then(function(b){return a.battles.scenarios=b,c.when(g.sortTypes())}).then(function(b){a.sort_types=b}).then(function(){a.battles.opponents=i.fromBattles(a.battles.display_list),a.battles.events=h.fromBattles(a.battles.display_list),a.battles.tags=j.fromBattles(a.battles.display_list)})}]),angular.module("jlogApp.controllers").controller("statsCtrl",["$scope","$state","stats",function(a,b,c){a.bottom_bar.show=!0,a.filter_state.previous="stats",a.resetListDisplay(),b.current.data.state={entry:"result",selector:"my_caster",setEntry:function(a){this.entry=a,this.doGenerate()},setSelector:function(a){this.selector!=a&&(d=null),this.selector=a,this.doGenerate()},doGenerate:function(){c.generate(this.entry,this.selector)}},a.stats=c,a.stats.collections={},a.state=b.current.data.state,a.state.doGenerate(),a.$on("battles_reset",function(){c.collections={},a.state.doGenerate()});var d=null;a.doShow=function(a){d=a},a.show=function(a){return d==a}}]).controller("statsBottomCtrl",["$scope","$state","stats",function(a,b,c){a.stats=c,a.state=b.current.data.state}]),angular.module("jlogApp.directives").factory("appCache",["$window","$rootScope",function(a){function b(a){var b="progress"===a.type;c.progress=b?(c.progress+1)%100:0,c.onProgress(b)}var c={progress:0,onProgress:function(){},onUpdateReady:function(){}},d=a.applicationCache;return d.addEventListener("cached",b,!1),d.addEventListener("checking",b,!1),d.addEventListener("downloading",b,!1),d.addEventListener("error",b,!1),d.addEventListener("noupdate",b,!1),d.addEventListener("obsolete",b,!1),d.addEventListener("progress",b,!1),d.addEventListener("updateready",function(a){d.status===d.UPDATEREADY&&c.onUpdateReady(),c.progress=0,c.onProgress(!1)},!1),c}]).directive("appCacheProgressBar",function(){return{restrict:"E",template:'<div class="appcache-progress"     ng-show="appCache.progress != 0">  <div class="appcache-progress-bar"       ng-style="{\'width\': appCache.progress + \'%\' }"></div></div>',controller:["$scope","$window","appCache",function(a,b,c){a.appCache=c,c.onProgress=function(){a.$apply()},c.onUpdateReady=function(){b.confirm("A new version of this site is available. Load it?")&&b.location.reload()}}],link:function(){}}}),angular.module("jlogApp.directives").directive("collapse",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.collapse,function(a){a?b.addClass("collapse"):b.removeClass("collapse")})}}}),angular.module("jlogApp.directives").directive("exportLink",function(){return{restrict:"A",transclude:!0,scope:{name:"@",type:"@",source:"="},template:'<a> </a> <a class="clickable" ng-click="exportSource()" ng-transclude> </a>',controller:["$scope","$window",function(a,b){a.file_url=null,a.file_name=a.name+"."+a.type,a.exportSource=function(){var c=a.source["export"](a.type),d=a.file_url;a.file_url=null,null!==d&&b.URL.revokeObjectURL(d);var e=new b.Blob([c],{type:"text/plain"});b.URL=b.URL||b.webkitURL;var f=b.URL.createObjectURL(e);a.file_url=f;var g=new Date;a.file_name=a.name+"_"+g.getTime()+"."+a.type,a.launchDownload()}}],link:function(a,b){var c=b.find("a")[0];a.launchDownload=function(){c.href=a.file_url,c.download=a.file_name,c.click()}}}}),angular.module("jlogApp.directives").directive("openDropdown",["$document",function(){return{restrict:"A",link:function(a,b,c){var d=c.openDropdown,e=angular.element(document.getElementById(d));_.exists(e)&&b.on("click",function(){e.toggleClass("open")})}}}]),angular.module("jlogApp.directives").directive("pieChart",["$timeout","$document",function(a,b){function c(a,c,d){var e=b.createElementNS(m,"svg");return e.style.width=c+"px",e.style.height=d+"px",e.style.display="inline-block",a.appendChild(e),e}function d(a){var c=b.createElement("div");return c.style.display="inline-block",c.style.verticalAlign="top",c.style.textAlign="left",c.style.paddingLeft="10px",a.appendChild(c),c}function e(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)b.removeChild(b.firstChild)}function f(a){return _.reduce(a,function(a,b){return a+(_.isNumber(b)?b:0)},0)}function g(a,b,c){var d=[],e=0;return _.each(a,function(a,f){_.isNumber(a)&&a>0&&(d.push({value:a,color:_.isObject(b)?b[f]:l[e%l.length],legend:_.isObject(c)?c[f]:f}),e++)}),d}function h(a,c,d,e){var f=b.createElementNS(m,"circle");f.setAttributeNS(null,"style","stroke: #fff; stroke-width:1.5; fill:"+e.color+";"),f.setAttributeNS(null,"cx",c/2+""),f.setAttributeNS(null,"cy",d/2+""),f.setAttributeNS(null,"r",c/2+""),a.appendChild(f)}function i(a,c,d,e,f,g){var h=2*g.value*Math.PI/e;f.angle+=h;var i=c/2+c/2*Math.sin(f.angle),j=d/2-d/2*Math.cos(f.angle),k=h>=Math.PI?1:0,l=b.createElementNS(m,"path");l.setAttributeNS(null,"style","stroke: #fff; stroke-width:1.5; fill:"+g.color+";"),l.setAttributeNS(null,"d","M"+c/2+","+d/2+" L"+f.portion[0]+","+f.portion[1]+" A"+c/2+","+d/2+" 0 "+k+",1 "+i+","+j+" Z"),a.appendChild(l),f.portion=[i,j]}function j(a,c){var d=b.createElement("div");d.innerHTML='<span style="background-color:'+c.color+';border-radius:1em;width:0.75em;height:0.75em;display:inline-block;vertical-align:middle;">&nbsp;</span> '+c.legend,a.appendChild(d)}function k(a,b,c,d,e){var k=_.isObject(a.values);if(k){var l=null;_.isObject(a.options)&&_.isFunction(a.options.colors)&&(l=a.options.colors(a.values));var m=null;_.isObject(a.options)&&_.isFunction(a.options.legends)&&(m=a.options.legends(a.values));var n=f(a.values),o=g(a.values,l,m);if(1==o.length)return void h(b,d,e,o[0]);var p={angle:0,portion:[d/2,0]};_.each(o,function(a){i(b,d,e,n,p,a),j(c,a)})}}var l=["#2f69bf","#a2bf2f","#bf5a2f","#bfa22f","#772fbf","#bf2f2f","#00327f","#667f00"],m="http://www.w3.org/2000/svg";return{restrict:"A",scope:{values:"=",options:"="},link:function(a,b,f){var g=f.width>>0,h=f.height>>0,i=c(b[0],g,h),j=d(b[0]);k(a,i,j,g,h),a.$watch("values",function(){e(i,j),k(a,i,j,g,h)})}}}]),angular.module("jlogApp.directives").directive("sortBy",["battle_sort",function(a){return{restrict:"A",transclude:!0,scope:{type:"@sortBy"},template:'<span class="clickable" ng-click="sort.sortBy(type)"><span ng-transclude></span><span class="sort-indicator" ng-show="sort.type === type"><span ng-hide="sort.reverse"class="glyphicon glyphicon-collapse-down"></span><span ng-show="sort.reverse"class="glyphicon glyphicon-collapse-up"></span></span></span>',controller:["$scope",function(b){b.sort=a}],link:function(){}}}]),angular.module("jlogApp.directives").directive("statBar",function(){return{restrict:"A",scope:{statBar:"=",type:"@",percent:"="},template:'<div class="bar bar-win" style="width:{{percent.win[type]}}%;"> {{statBar.win[type] ? statBar.win[type] : ""}} </div><div class="bar bar-draw" style="width:{{percent.draw[type]}}%;"> {{statBar.draw[type] ? statBar.draw[type] : ""}} </div><div class="bar bar-loss" style="width:{{percent.loss[type]}}%;"> {{statBar.loss[type] ? statBar.loss[type] : ""}} </div>'}}),angular.module("jlogApp.directives").directive("whenScrolled",function(){return function(a,b,c){var d=b[0],e=function(b){var e=d.getBoundingClientRect();e.bottom===window.innerHeight&&a.$apply(c.whenScrolled)};angular.element(window).bind("scroll load",e)}}),angular.module("jlogApp.filters").filter("battle",["filter",function(a){return function(b,c,d){return c&&_.isArray(b)?b.filter(function(b){return a.match(b,d)}):b}}]),angular.module("jlogApp.filters").filter("capitalise",[function(){return function(a){return"string"==typeof a?a.charAt(0).toUpperCase()+a.slice(1):a}}]),angular.module("jlogApp.filters").filter("initiative",[function(){return function(a){if(!angular.isObject(a)||"string"!=typeof a.won_roll||"string"!=typeof a.started)return"nil";var b="";return b+="true"===a.won_roll?"Won roll, ":"Lost roll, ",b+="true"===a.started?"started game":"chose side"}}]),angular.module("jlogApp.filters").filter("scoreResultColor",[function(){return function(a){return"string"!=typeof a?"":"victory"==a?"text-success":"defeat"==a?"text-danger":"text-warning"}}]).filter("scoreResultClass",[function(){return function(a){var b;switch(a){case"victory":b="text-success";break;case"draw":b="text-warning";break;case"defeat":b="text-danger"}return b}}]).filter("scoreTypeLetter",[function(){return function(a){return"string"==typeof a?a.charAt(0).toUpperCase():a}}]).filter("scoreType",[function(){return function(a){switch(a){case"va":return"Assassination Victory";case"vs":return"Scenario Victory";case"vc":return"Clock Victory";case"vt":return"Tiebreaker Victory";case"dd":return"Dice-down Draw";case"da":return"Assassination Defeat";case"ds":return"Scenario Defeat";case"dc":return"Clock Defeat";case"dt":return"Tiebreaker Defeat"}return""}}]),angular.module("jlogApp.filters").filter("battle",["battle",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("factions",["factions",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("scenarios",["scenarios",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]).filter("scores",["scores",function(a){return function(b,c){var d=_.rest(_.rest(arguments));return a[c].apply(null,_.cons(b,d))}}]),_.mixin({apply:function(a,b){var c=_.rest(_.rest(arguments));return b.apply(null,_.cons(a,c))}}),_.mixin({deepExtend:function a(b,c){return _.each(c,function(c,d){!_.isObject(c)||_.isArray(c)||_.isFunction(c)||!_.isObject(b[d])||_.isArray(b[d])||_.isFunction(b[d])?b[d]=c:a(b[d],c)}),b}}),_.mixin({mapWith:function(a,b){var c=_.rest(_.rest(arguments)),d=_.partial.apply(null,_.cat([b,_],c));return _.map(a,d)}}),_.mixin({spy:function(a){var b=_.rest(arguments);return console.log.apply(console,_.cat(b,[a])),a}}),angular.module("jlogApp.services").factory("backup",["$window","$http","$q",function(a,b,c){return a.URL=a.URL||a.webkitURL,{read_result:null,save_url:null,save_name:"battle_list.txt",read:function(b,c,d){var e="function"==typeof c?c:function(a){},f="function"==typeof d?d:function(a){};this.read_result=null;var g=new a.FileReader;g.onload=function(a){var b;try{b=JSON.parse(a.target.result),e(b)}catch(c){f("invalid file")}},g.onerror=function(){f("error reading file")},g.onabort=function(){f("abort reading file")},g.readAsText(b)},generate:function(b){var c=this.save_url;this.save_url=null,null!==c&&a.URL.revokeObjectURL(c);var d=JSON.stringify(b),e=new a.Blob([d],{type:"text/plain"}),f=a.URL.createObjectURL(e),g=new Date;this.save_name="battle_list_"+g.getTime()+".txt",this.save_url=f},upload:function(a){var d=this;return d.upload.id=null,d.upload.status=null,d.upload.msg="Uploading...",b.post("/api/log",{battles:a},{timeout:2e4}).then(function(a){return d.upload.status=!0,d.upload.msg="data uploaded",d.upload.id=a.data.id,a.data},function(a){return d.upload.status=!1,d.upload.msg="upload failure ("+a.status+")",c.reject(a)})},download:function(){var a=this;return a.download.status=null,a.download.msg="Downloading...",b.get("/api/log/"+a.download.id,{timeout:2e4}).then(function(b){return a.download.status=!0,a.download.msg="data downloaded",b.data.battles},function(b){return a.download.status=!1,a.download.msg="download failure ("+b.status+")",c.reject(b)})},statusReset:function(){this.upload.id=null,this.upload.status=null,this.upload.msg=null,this.download.id=null,this.download.status=null,this.download.msg=null}}}]),angular.module("jlogApp.services").factory("battle",[function(){var a={create:function(a){a=_.exists(a)?a:{};var b=new Date;return _.deepExtend({index:0,date:{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate()},my_army:{faction:null,caster:null},opponent:{name:null,faction:null,caster:null},setup:{size:null,scenario:null,event:null,initiative:{won_roll:null,started:null}},score:null,points:{my_army:{scenario:null,army:null,kill:null},opponent:{scenario:null,army:null,kill:null}},tags:[],comment:null},a)},test:function(a,b,c,d){var e=_.chain(b).shuffle().first().value(),f=_.chain(b).shuffle().first().value();return{index:a,date:{year:_.chain([2012,2014,2013]).shuffle().first().value(),month:_.chain([4,8,9]).shuffle().first().value(),day:_.chain([5,12,19]).shuffle().first().value()},my_army:{faction:e.key,caster:_.chain(e.casters).shuffle().first().value().key},opponent:{name:_.chain(["wood","kevin","fred"]).shuffle().first().value(),faction:f.key,caster:_.chain(f.casters).shuffle().first().value().key},setup:{size:_.chain([15,25,35,50]).shuffle().first().value(),scenario:_.chain(d).shuffle().first().value().key,event:_.chain(["master","amical","wtc"]).shuffle().first().value(),initiative:{won_roll:_.chain(["true","false"]).shuffle().first().value(),started:_.chain(["true","false"]).shuffle().first().value()}},score:_.chain(c).keys().shuffle().first().value(),points:{my_army:{scenario:5*Math.random()>>0,army:50*Math.random()>>0,kill:50*Math.random()>>0},opponent:{scenario:5*Math.random()>>0,army:50*Math.random()>>0,kill:50*Math.random()>>0}},tags:["tiers4","raek spam"],comment:"don't panic"}},addTag:function(a,b){return _.chain(a).clone().apply(function(a){return a.tags=_.chain(a.tags).cat(b).uniq().sort().value(),a}).value()},initRollDescFor:function(a){return"true"===_.getPath(a,"setup.initiative.won_roll")?"Won Roll":"Lost Roll"},initStartDescFor:function(a){return"true"===_.getPath(a,"setup.initiative.started")?"Started Game":"Chose Side"}};return a}]).service("battles",["$http","$q","battle","orderByFilter",function(a,b,c,d){var e,f={buildIndex:function(a){return _.each(a,function(a,b){a.index=b})},save:function(a,b,c){var d=_.clone(a);return d.splice(b,1,c),d},drop:function(a,b){var c=_.clone(a);return c.splice(b,1),c},test:function(a,b,d,e){return _.chain(a).range().map(_.partial(c.test,_,b,d,e)).value()},sortTypes:function(){return _.exists(e)?e:a.get("data/sorts.json").then(function(a){return e=a.data},function(a){return b.reject(a)})},updateSortBy:function(a,b,c){if(!_.exists(a[c]))return b;var d=_.clone(b);return d.type===c?d.reverse=!d.reverse:(d.type=c,d.reverse=a[c].reverse),d},sort:function(a,b,c,e){return d(a,b[c].key,e)}};return f}]),angular.module("jlogApp.services").service("battles_display",["battles","battleFilter","orderByFilter",function(a,b,c){function d(){var a=this.sorted_list.slice(this.last_index,this.last_index+this.slice);this.display_list=this.display_list.concat(a),this.last_index+=this.slice,this.more=this.last_index<this.sorted_list.length}function e(a,d,e){this.sorted_list=b(this.list,a,d),this.sorted_list=c(this.sorted_list,e.types[e.type].key,e.reverse)}return _.extend(a,{sorted_list:[],display_list:[],slice:15,last_index:0,more:!1,reset:function(a,b,c){this.sorted_list=[],this.display_list=[],this.slice=15,this.last_index=0,this.more=!1,e.call(this,a,b,c),d.call(this)},showMore:function(){this.more&&d.call(this)}}),a}]),angular.module("jlogApp.services").service("events",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"setup.event").without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without(a,b)}};return a}]),angular.module("jlogApp.services").service("export_csv",["battle",function(a){function b(a,c,d){return _.isString(c)||(c=""),_.reduce(a,function(a,e,f){return"$"===f[0]||_.isFunction(e)||(d[f]={},a+=!_.isObject(e)||_.isArray(e)?c+f+",":b(e,c+f+".",d[f])),a},"")}function c(a,b){return _.reduce(b,function(b,d,e){return _.has(a,e)&&(_.isArray(a[e])?(_.each(a[e],function(a){b+=a+"::"}),a[e].length>0&&(b=b.slice(0,b.length-2)),b+=","):b+=_.isObject(a[e])?c(a[e],d):a[e]+","),b},"")}return{generate:function(d){var e="",f={};return e+=b(a({}),"",f)+"\r\n",_.reduce(d,function(a,b){return a+=c(b,f)+"\r\n"},e)}}}]).service("export_bb",["battle",function(a){function b(a,c,d){return _.isString(c)||(c=""),_.reduce(a,function(a,e,f){return"$"===f[0]||_.isFunction(e)||(d[f]={},a+=!_.isObject(e)||_.isArray(e)?"[th]"+c+f+"[/th]":b(e,c+f+".",d[f])),a},"")}function c(a,b){return _.reduce(b,function(b,d,e){return a.hasOwnProperty(e)&&(_.isArray(a[e])?(b+="[td]",_.each(a[e],function(a){b+=a+","}),a[e].length>0&&(b=b.slice(0,b.length-1)),b+="[/td]"):b+=_.isObject(a[e])?c(a[e],d):"[td]"+a[e]+"[/td]"),b},"")}return{generate:function(d){var e="[table]\r\n",f={};return e+="[tr]"+b(a({}),"",f)+"[/tr]\r\n",e+=_.reduce(d,function(a,b){return a+="[tr]"+c(b,f)+"[/tr]\r\n"},""),e+="[/table]\r\n"}}}]).service("export",["$window","export_csv","export_bb",function(a,b,c){function d(b,c){var d=this[b+"_url"];this[b+"_url"]=null,null!==d&&a.URL.revokeObjectURL(d);var e=c(),f=new a.Blob([e],{type:"text/plain"}),g=a.URL.createObjectURL(f);this[b+"_url"]=g}return{name:null,bb_url:null,csv_url:null,json_url:null,generate:function(a){var e=new Date;this.name="battle_list_"+e.getTime(),d.call(this,"bb",function(){return c.generate(a)}),d.call(this,"csv",function(){return b.generate(a)}),d.call(this,"json",function(){return JSON.stringify(a)})}}}]),angular.module("jlogApp.services").factory("factions",["$http","$q",function(a,b){function c(a){if(!angular.isString(a))return null;var b=a.charAt(a.length-1);return("0">b||b>"9")&&(a+="1"),a}var d,e={data:function(){return _.exists(d)?d:a.get("data/factions.json").then(function(a){return d=_.chain(a.data).map(function(a,b){return{key:b,name:a.name,icon:a.icon,casters:_.map(a.casters,function(a,b){var d=c(b);return{key:d,name:a.name}})}}).value()},function(a){return b.reject(a)})},nameFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("name").value()},iconFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("icon").apply(function(a){return _.exists(a)?"data/img/"+a:a}).value()},castersFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("casters").value()},casterNameFor:function(a,b,c){return _.chain(a).where({key:b}).first().getPath("casters").where({key:c}).first().getPath("name").value()}};return e}]),angular.module("jlogApp.services").factory("filterMatchSimple",[function(){return function(a,b){return _.extend({active:!1,is:"true",value:[],match:function(a){var c=0===this.value.length||0<=this.value.indexOf(b(a));return!this.active||("true"===this.is?c:!c)}},a)}}]).factory("filterMatchComp",[function(){return function(a,b){return 0===a?0===b:1===a?0!==b:2===a?-1===b:3===a?1!==b:4===a?1===b:5===a?-1!==b:!1}}]).factory("filterMatchDate",["filterMatchComp",function(a){var b=function(a,b){return a.year>b.year?1:a.year<b.year?-1:a.month>b.month?1:a.month<b.month?-1:a.day>b.day?1:a.day<b.day?-1:0};return function(c){var d=new Date;return _.extend({active:!1,is:"0",year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate(),match:function(c){var d=b(this,c.date),e=parseInt(this.is,10),f=a(e,d);return!this.active||f}},c)}}]).factory("filterMatchSize",["filterMatchComp",function(a){var b=function(a,b){return a>b?1:b>a?-1:0};return function(c){return _.extend({active:!1,is:"0",value:50,match:function(c){var d=b(this.value,c.setup.size),e=parseInt(this.is,10),f=a(e,d);return!this.active||f}},c)}}]).factory("filterMatchCaster",[function(){return function(a,b){return _.extend({active:!1,is:"true",faction:null,caster:[],match:function(a){var c=this.faction===b(a).faction&&(0===this.caster.length||0<=this.caster.indexOf(b(a).caster));return!this.active||("true"===this.is?c:!c)}},a)}}]).factory("filterMatchInitiative",[function(){return function(a){return _.extend({active:!1,is:"true",won_roll:"",started:"",match:function(a){var b=!(0!==this.won_roll.length&&this.won_roll!==a.setup.initiative.won_roll||0!==this.started.length&&this.started!==a.setup.initiative.started);return!this.active||("true"===this.is?b:!b)}},a)}}]).factory("filterMatchTags",[function(){return function(a){return _.extend({active:!1,is:"any",value:[],match:function(a){if(!this.active||0===this.value.length)return!0;if(0===a.tags.length)return"none"===this.is||"not_all"===this.is;var b,c=!0,d=!1;switch(_.each(this.value,function(e){b=0<=a.tags.indexOf(e),c=c&&b,d=d||b}),this.is){case"any":return d;case"all":return c;case"not_all":return!c;case"none":return!d;default:return!1}}},a)}}]).factory("filter",["storage","filterMatchSimple","filterMatchDate","filterMatchSize","filterMatchCaster","filterMatchInitiative","filterMatchTags",function(a,b,c,d,e,f,g){var h=function(b){a.setItem(a.KEYS.FILTER,JSON.stringify(b))},i=function(){return JSON.parse(a.getItem(a.KEYS.FILTER))},j=function(){var b=a.getItem(a.KEYS.FILTER);return"string"==typeof b&&0<b.length},k=function(a){return{date:c(_.isObject(a.date)?a.date:{}),my_army:e(_.isObject(a.my_army)?a.my_army:{},function(a){return a.my_army}),opp_name:b(_.isObject(a.opp_name)?a.opp_name:{},function(a){return a.opponent.name}),opp_caster:e(_.isObject(a.opp_caster)?a.opp_caster:{},function(a){return a.opponent}),result:b(_.isObject(a.result)?a.result:{},function(a){return a.score}),scenario:b(_.isObject(a.scenario)?a.scenario:{},function(a){return a.setup.scenario}),initiative:f(_.isObject(a.initiative)?a.initiative:{}),size:d(_.isObject(a.size)?a.size:{}),event:b(_.isObject(a.event)?a.event:{},function(a){return a.setup.event}),tags:g(_.isObject(a.tags)?a.tags:{})}},l={};return{list:null,init:function(){if(j()){var a=i();this.list=k(a)}else this.list=k({}),h(this.list);this.clearCache()},update:function(){h(this.list)},match:function(a,b){return l.hasOwnProperty(a.index)||(l[a.index]=_.reduce(this.list,function(b,c){return b&&c.match(a)},!0)),b?!l[a.index]:l[a.index]},clearCache:function(a){void 0===a?l={}:delete l[a]}}}]),angular.module("jlogApp.services").service("opponents",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"opponent.name").without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without(a,b)}};return a}]),angular.module("jlogApp.services").service("scenarios",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/scenarios.json").then(function(a){return c=_.chain(a.data).map(function(a,b){return{key:b,name:a.name}}).value()},function(a){return b.reject(a)})},add:function(a,b){return _.chain(a).cat({key:b,name:s.capitalize(b)}).filter(function(a){return _.exists(_.getPath(a,"key"))}).uniq(!1,_.partial(_.getPath,_,"key")).value()},drop:function(a,b){return _.filter(a,function(a){return a.key!==b})},nameFor:function(a,b){return _.chain(a).where({key:b}).first().getPath("name").value()}};return d}]),angular.module("jlogApp.services").factory("scores",["$http","$q",function(a,b){var c,d={data:function(){return _.exists(c)?c:a.get("data/scores.json").then(function(a){return c=a.data,a.data},function(a){return b.reject(a)})},letterFor:function(a,b){return _.getPath(a,b+".letter")},typeFor:function(a,b){return _.getPath(a,b+".type")},resultFor:function(a,b){return _.getPath(a,b+".result")},classFor:function(a,b){return _.getPath(a,b+".class")}};return d}]),angular.module("jlogApp.services").factory("selection",[function(){var a=function(a){var b=!1;return"string"==typeof this.my_army.faction&&0<this.my_army.faction.length&&(b=!0,_.each(this.battles,function(b){a[b].my_army.faction=this.my_army.faction,a[b].my_army.caster=""})),"string"==typeof this.my_army.caster&&0<this.my_army.caster.length&&(b=!0,_.each(this.battles,function(b){a[b].my_army.caster=this.my_army.caster})),b},b=function(a){var b,c=!1;if("string"==typeof this.opponent.name&&0<this.opponent.name.length)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].opponent.name=this.opponent.name;if("string"==typeof this.opponent.faction&&0<this.opponent.faction.length)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].opponent.faction=this.opponent.faction,a[this.battles[b]].opponent.caster="";if("string"==typeof this.opponent.caster&&0<this.opponent.caster.length)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].opponent.caster=this.opponent.caster;return c},c=function(a){var b,c=!1;for(b=0;b<this.battles.length;b++)void 0===a[this.battles[b]].points&&(a[this.battles[b]].points={my_army:{scenario:null,army:null},opponents:{scenario:null,army:null}}),void 0===a[this.battles[b]].points.my_army&&(a[this.battles[b]].points.my_army={scenario:null,army:null}),void 0===a[this.battles[b]].points.opponent&&(a[this.battles[b]].points.opponent={scenario:null,army:null});if("number"==typeof this.points.my_army.scenario)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].points.my_army.scenario=this.points.my_army.scenario;if("number"==typeof this.points.my_army.army)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].points.my_army.army=this.points.my_army.army;if("number"==typeof this.points.opponent.scenario)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].points.opponent.scenario=this.points.opponent.scenario;if("number"==typeof this.points.opponent.army)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].points.opponent.army=this.points.opponent.army;return c},d=function(a){var b,c=!1;for(b=0;b<this.battles.length;b++)void 0===a[this.battles[b]].date&&(a[this.battles[b]].date={year:2e3,month:1,day:1});if("number"==typeof this.date.year)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].date.year=this.date.year;if("number"==typeof this.date.month)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].date.month=this.date.month;if("number"==typeof this.date.day)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].date.day=this.date.day;return c},e=function(a){var b,c=!1;for(b=0;b<this.battles.length;b++)void 0===a[this.battles[b]].setup&&(a[this.battles[b]].setup={scenario:null,event:null,size:null,initiative:{won_roll:null,started:null}});if("string"==typeof this.setup.scenario)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].setup.scenario=this.setup.scenario;return c},f=function(a){var b,c=!1;for(b=0;b<this.battles.length;b++)void 0===a[this.battles[b]].setup&&(a[this.battles[b]].setup={scenario:null,event:null,size:null,initiative:{won_roll:null,started:null}});if("number"==typeof this.setup.size)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].setup.size=this.setup.size;return c},g=function(a){var b,c=!1;for(b=0;b<this.battles.length;b++)void 0===a[this.battles[b]].setup&&(a[this.battles[b]].setup={scenario:null,event:null,size:null,initiative:{won_roll:null,started:null}});if("string"==typeof this.setup.event)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].setup.event=this.setup.event;
return c},h=function(a){var b,c=!1;if("string"==typeof this.score)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].score=this.score;return c},i=function(a){var b,c=!1;if(0<this.tags.length)for(c=!0,b=0;b<this.battles.length;b++)a[this.battles[b]].tags=this.tags.slice(0);return c},j=function(a){var b,c=!1;if(0<this.tags.length)for(c=!0,b=0;b<this.battles.length;b++){var d;for(d=0;d<this.tags.length;d++)void 0===a[this.battles[b]].tags&&(a[this.battles[b]].tags=[]),0>a[this.battles[b]].tags.indexOf(this.tags[d])&&a[this.battles[b]].tags.push(this.tags[d])}return c},k=function(a){var b;for(b=0;b<this.battles.length;b++)this.my_army.faction=null,this.my_army.caster=null,a[this.battles[b]].my_army.faction=null,a[this.battles[b]].my_army.caster=null},l=function(a){var b;for(b=0;b<this.battles.length;b++)this.opponent.name=null,this.opponent.faction=null,this.opponent.caster=null,a[this.battles[b]].opponent.name=null,a[this.battles[b]].opponent.faction=null,a[this.battles[b]].opponent.caster=null},m=function(a){var b;for(b=0;b<this.battles.length;b++)this.points={my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}},a[this.battles[b]].points={my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}}},n=function(a){var b;for(b=0;b<this.battles.length;b++)this.date={year:null,month:null,day:null},a[this.battles[b]].date={year:2e3,month:1,day:1}},o=function(a){var b;for(b=0;b<this.battles.length;b++)this.setup.scenario=null,a[this.battles[b]].setup.scenario=null},p=function(a){var b;for(b=0;b<this.battles.length;b++)this.setup.size=null,a[this.battles[b]].setup.size=null},q=function(a){var b;for(b=0;b<this.battles.length;b++)this.setup.event=null,a[this.battles[b]].setup.event=null},r=function(a){var b;for(b=0;b<this.battles.length;b++)this.score=null,a[this.battles[b]].score=null},s=function(a){var b;for(b=0;b<this.battles.length;b++)this.tags=[],a[this.battles[b]].tags=[]},t=function(a){var b;for(b=0;b<this.battles.length;b++){var c;for(c=0;c<this.tags.length;c++){var d=a[this.battles[b]].tags.indexOf(this.tags[c]);d>=0&&a[this.battles[b]].tags.splice(d,1)}}};return{full:!1,toggleFull:function(a){var b;for(b=0;b<a.length;b++)a[b].selected=this.full},battles:[],my_army:{},opponent:{},setup:{},tags:[],points:{my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}},reset:function(a){this.full=!1,this.battles=[],this.my_army={},this.opponent={},this.setup={},this.tags=[],this.points={my_army:{scenario:null,army:null},opponent:{scenario:null,army:null}};var b;for(b=0;b<a.length;b++)a[b].selected=!1},remove:function(a){var b;for(this.battles.sort(),b=0;b<this.battles.length;b++)a.splice(this.battles[this.battles.length-b-1],1);var c=0<this.battles.length;return this.battles=[],c},update:function(a){this.battles=a.map(function(a){return a.index})},set:function(k,l){if(0===this.battles.length)return!1;var m=!1;switch(k){case"my_army":m=a.call(this,l);break;case"opponent":m=b.call(this,l);break;case"points":m=c.call(this,l);break;case"date":m=d.call(this,l);break;case"scenario":m=e.call(this,l);break;case"size":m=f.call(this,l);break;case"event":m=g.call(this,l);break;case"score":m=h.call(this,l);break;case"tags":m=i.call(this,l);break;case"addTags":m=j.call(this,l)}return m},unset:function(a,b){if(0===this.battles.length)return!1;var c=!1;switch(a){case"my_army":c=!0,k.call(this,b);break;case"opponent":c=!0,l.call(this,b);break;case"points":c=!0,m.call(this,b);break;case"date":c=!0,n.call(this,b);break;case"scenario":c=!0,o.call(this,b);break;case"size":c=!0,p.call(this,b);break;case"event":c=!0,q.call(this,b);break;case"score":c=!0,r.call(this,b);break;case"tags":c=!0,s.call(this,b);break;case"addTags":c=!0,t.call(this,b)}return c}}}]),angular.module("jlogApp.services").value("sort_types",{date:{name:"Date",key:["date.year","date.month","date.day","index"]},my_caster:{name:"My caster",key:["my_army.faction","my_army.caster","index"]},opponent:{name:"Opponent",key:["opponent.name","index"]},opp_caster:{name:"Opp. caster",key:["opponent.faction","opponent.caster","index"]},scenario:{name:"Scenario",key:["setup.scenario","index"]},size:{name:"Size",key:["setup.size","index"]},event:{name:"Event",key:["setup.event","index"]},result:{name:"Result",key:["score","index"]}}).factory("battle_sort",["sort_types",function(a){return{types:a,type:"date",reverse:!0,sortBy:function(a){this.types.hasOwnProperty(a)&&(this.type===a?this.reverse=!this.reverse:(this.type=a,this.reverse=!1))}}}]),angular.module("jlogApp.services").service("statEntryMyCaster",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.my_army.faction+"|"+b.my_army.caster;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntryOppName",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.opponent.name;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntryOppCaster",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.opponent.faction;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntryEvent",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.setup.event;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntryEvent",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.setup.event;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntryScenario",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.setup.scenario;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntrySize",[function(){var a=function(){var a={};return a.addBattle=function(b){var c=b.setup.size;a[c]=a[c]||0,a[c]++},a};return a}]).service("statEntryInit",[function(){var a=function(){var a={rw:0,rl:0,pf:0,ps:0};return a.addBattle=function(b){"true"===b.setup.initiative.won_roll&&a.rw++,"false"===b.setup.initiative.won_roll&&a.rl++,"true"===b.setup.initiative.started&&a.pf++,"false"===b.setup.initiative.started&&a.ps++},a};return a.legends=function(){return{rw:"Won Roll",rl:"Lost Roll",pf:"First Player",ps:"Second Player"}},a.colors=function(){return{rw:"#0C0",rl:"#C00",pf:"#06C",ps:"#048"}},a}]).service("statEntryResult",[function(){var a=function(){var a={va:0,vc:0,vs:0,vt:0,dd:0,da:0,dc:0,ds:0,dt:0};return a.addBattle=function(b){a[b.score]++},a};return a.legends=function(){return{va:"Assassination Victory",vc:"Clock Victory",vs:"Scenario Victory",vt:"Tiebreakers Victory",dd:"Dice Down Draw",da:"Assassination Defeat",dc:"Clock Defeat",ds:"Scenario Defeat",dt:"Tiebreakers Defeat"}},a.colors=function(){return{va:"#0C0",vc:"#0A0",vs:"#080",vt:"#060",dd:"#CC0",da:"#C00",dc:"#A00",ds:"#800",dt:"#600"}},a}]).service("statEntryPointScenario",[function(){var a=function(){var a={my_army:0,opponent:0};return a.addBattle=function(b){_.isNumber(b.points.my_army.scenario)&&_.isNumber(b.points.opponent.scenario)&&(a.my_army+=b.points.my_army.scenario,a.opponent+=b.points.opponent.scenario)},a};return a}]).service("statEntryPointArmy",[function(){var a=function(){var a={my_army:0,opponent:0};return a.addBattle=function(b){_.isNumber(b.points.my_army.army)&&_.isNumber(b.points.opponent.army)&&(a.my_army+=b.points.my_army.army,a.opponent+=b.points.opponent.army)},a};return a}]).service("statEntryPointKill",[function(){var a=function(){var a={my_army:0,opponent:0};return a.addBattle=function(b){_.isNumber(b.points.my_army.kill)&&_.isNumber(b.points.opponent.kill)&&(a.my_army+=b.points.my_army.kill,a.opponent+=b.points.opponent.kill)},a};return a}]).service("statEntryTag",[function(){var a=function(){var a={};return a.addBattle=function(b){_.each(b.tags,function(b){a[b]=a[b]||0,a[b]++})},a};return a}]),angular.module("jlogApp.services").service("statSelectorMyCaster",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.my_army.faction,e=a.my_army.caster;void 0===c[d]&&(c[d]={all:b(),casters:{}}),void 0===c[d].casters[e]&&(c[d].casters[e]=b()),c[d].all.addBattle(a),c[d].casters[e].addBattle(a)}),c}}]).service("statSelectorOppName",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.opponent.name;void 0===c[d]&&(c[d]=b()),c[d].addBattle(a)}),c}}]).service("statSelectorOppCaster",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.opponent.faction,e=a.opponent.caster;void 0===c[d]&&(c[d]={all:b(),casters:{}}),void 0===c[d].casters[e]&&(c[d].casters[e]=b()),c[d].all.addBattle(a),c[d].casters[e].addBattle(a)}),c}}]).service("statSelectorEvent",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.setup.event;void 0===c[d]&&(c[d]=b()),c[d].addBattle(a)}),c}}]).service("statSelectorScenario",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.setup.scenario;void 0===c[d]&&(c[d]=b()),c[d].addBattle(a)}),c}}]).service("statSelectorSize",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.setup.size+"pts";void 0===c[d]&&(c[d]=b()),c[d].addBattle(a)}),c}}]).service("statSelectorInit",[function(){return function(a,b){var c={rw:b(),rl:b(),pf:b(),ps:b()};return _.each(a,function(a){"true"===a.setup.initiative.won_roll&&c.rw.addBattle(a),"false"===a.setup.initiative.won_roll&&c.rl.addBattle(a),"true"===a.setup.initiative.started&&c.pf.addBattle(a),"false"===a.setup.initiative.started&&c.ps.addBattle(a)}),c}}]).service("statSelectorResult",[function(){return function(a,b){var c={};return _.each(a,function(a){var d=a.score;void 0===c[d]&&(c[d]=b()),c[d].addBattle(a)}),c}}]).service("statSelectorTag",[function(){return function(a,b){var c={};return _.each(a,function(a){_.each(a.tags,function(d){void 0===c[d]&&(c[d]=b()),c[d].addBattle(a)})}),c}}]),angular.module("jlogApp.services").service("stats",["statEntryMyCaster","statEntryOppName","statEntryOppCaster","statEntryEvent","statEntryScenario","statEntrySize","statEntryInit","statEntryResult","statEntryPointScenario","statEntryPointArmy","statEntryPointKill","statEntryTag","statSelectorMyCaster","statSelectorOppName","statSelectorOppCaster","statSelectorEvent","statSelectorScenario","statSelectorSize","statSelectorInit","statSelectorResult","statSelectorTag","battles_display",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(a,b){var c=b();return _.each(a,function(a){c.addBattle(a)}),c}return{ENTRIES:{my_caster:{desc:"My Caster",factory:a},opp_name:{desc:"Opp. Name",factory:b},opp_caster:{desc:"Opp. Caster",factory:c},event:{desc:"Event",factory:d},scenario:{desc:"Scenario",factory:e},size:{desc:"Size",factory:f},initiative:{desc:"Initiative",factory:g},result:{desc:"Result",factory:h},point_scenario:{desc:"Scenario Points",factory:i},point_army:{desc:"Army Points",factory:j},point_Kill:{desc:"Kill Points",factory:k},tag:{desc:"Tag",factory:l}},SELECTORS:{my_caster:{desc:"My Caster",factory:m},opp_name:{desc:"Opp. Name",factory:n},opp_caster:{desc:"Opp. Caster",factory:o},event:{desc:"Event",factory:p},scenario:{desc:"Scenario",factory:q},size:{desc:"Size",factory:r},init:{desc:"Initiative",factory:s},result:{desc:"Result",factory:t},tag:{desc:"Tag",factory:u}},collections:{},legends:{},colors:{},generate:function(a,b){_.has(this.ENTRIES,a)&&_.has(this.SELECTORS,b)&&(this.collections[a]=this.collections[a]||{},this.collections[a].all=this.collections[a].all||w(v.sorted_list,this.ENTRIES[a].factory),this.collections[a][b]=this.collections[a][b]||this.SELECTORS[b].factory(v.sorted_list,this.ENTRIES[a].factory))}}}]),angular.module("jlogApp.services").factory("storage",["$window",function(a){var b={setItem:function(){return a.localStorage.setItem.apply(a.localStorage,arguments)},getItem:function(){return a.localStorage.getItem.apply(a.localStorage,arguments)},KEYS:{BATTLES:"jlog_battles",OPPONENTS:"jlog_opponents",EVENTS:"jlog_events",SCENARIOS:"jlog_scenarios",TAGS:"jlog_tags",FILTER:"jlog_filter"},clearJLogKeys:function(){_.each(b.KEYS,function(a){b.setItem(a,"")})}};return b}]),angular.module("jlogApp.services").service("tags",[function(){var a={fromBattles:function(a){return _.chain(a).mapWith(_.getPath,"tags").flatten().without(null,void 0).uniq().sort().value()},add:function(a,b){return _.chain(a).cat(b).without(null,void 0).uniq().sort().value()},drop:function(a,b){return _.without.apply(null,_.cat([a],b))}};return a}]);